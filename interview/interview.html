<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础篇 | luomu</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="luomu">
    
    <link rel="preload" href="/learn-vuepress/assets/css/0.styles.216a5ded.css" as="style"><link rel="preload" href="/learn-vuepress/assets/js/app.ef882cb7.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/6.0c5ddd61.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/1.a3f35cab.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/17.de597ac3.js" as="script"><link rel="prefetch" href="/learn-vuepress/assets/js/10.e64b2106.js"><link rel="prefetch" href="/learn-vuepress/assets/js/11.acfcb00e.js"><link rel="prefetch" href="/learn-vuepress/assets/js/12.6cdca1ad.js"><link rel="prefetch" href="/learn-vuepress/assets/js/13.ed4c5228.js"><link rel="prefetch" href="/learn-vuepress/assets/js/14.dc698bff.js"><link rel="prefetch" href="/learn-vuepress/assets/js/15.dc24ae96.js"><link rel="prefetch" href="/learn-vuepress/assets/js/16.a74a9aad.js"><link rel="prefetch" href="/learn-vuepress/assets/js/18.86885f1c.js"><link rel="prefetch" href="/learn-vuepress/assets/js/3.3e8cb02f.js"><link rel="prefetch" href="/learn-vuepress/assets/js/4.c228b26e.js"><link rel="prefetch" href="/learn-vuepress/assets/js/5.8a47e0a1.js"><link rel="prefetch" href="/learn-vuepress/assets/js/7.1339d2bf.js"><link rel="prefetch" href="/learn-vuepress/assets/js/8.847a5e69.js"><link rel="prefetch" href="/learn-vuepress/assets/js/9.fb445241.js">
    <link rel="stylesheet" href="/learn-vuepress/assets/css/0.styles.216a5ded.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>luomu</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>luomu</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">luomu</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-vuepress/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      luomu的 Java 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/luomu888" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>8</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/learn-vuepress/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      luomu的 Java 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/luomu888" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机底层</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>面经</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-vuepress/interview/interview.html" aria-current="page" class="active sidebar-link">面试必备</a></li><li><a href="/learn-vuepress/interview/Java基础面试题.html" class="sidebar-link">Java基础面试题</a></li><li><a href="/learn-vuepress/interview/牛客面经.html" class="sidebar-link">牛客面经</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">基础篇</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="基础篇"><a href="#基础篇" class="header-anchor">#</a> 基础篇</h1> <blockquote><p>算法、设计模式、八股文</p></blockquote> <h2 id="二分查找"><a href="#二分查找" class="header-anchor">#</a> 二分查找</h2> <blockquote><p>奇数二分取中间，<code>偶数</code>二分取中间靠<code>左</code></p></blockquote> <ul><li>中间值：
<ul><li><code>left +</code> (right - left) / 2
<ul><li>减法，避免超出</li></ul></li> <li>(left + right) <code>&gt;&gt;&gt;</code> 1
<ul><li>无符号右移</li></ul></li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 二分查找</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> right <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 方法一</span>
            <span class="token comment">// int mid = left + (right - left) / 2;</span>
            <span class="token comment">// 方法二</span>
            <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                right <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> mid<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="冒泡排序-找最大到末尾"><a href="#冒泡排序-找最大到末尾" class="header-anchor">#</a> 冒泡排序（找最大到末尾）</h2> <blockquote><p>记录最后一次交换位置，即下次结束位置</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 冒泡排序（一次冒泡，一个最大值在末尾排好）</span>
        <span class="token function">bubblingSort</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">bubblingSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 默认没有交换</span>
            <span class="token keyword">int</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    last <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 只需到末尾最大值前一个元素即可</span>
            n <span class="token operator">=</span> last<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="选择排序-找最小放开头"><a href="#选择排序-找最小放开头" class="header-anchor">#</a> 选择排序（找最小放开头）</h2> <blockquote><p>选择不稳定，<code>冒泡稳定</code></p> <p>稳定：</p> <ul><li><code>相同值</code>顺序不被打乱</li> <li>例：打牌，相同的2，不同花色</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[[♠7], [♠2], [♠4], [♠5], [♥2], [♥5]]
[[♠7], [♠5], [♥5], [♠4], [♥2], [♠2]]
</code></pre></div></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 选择排序，找最小放到开头</span>
        <span class="token function">selectSort</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">selectSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> min <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token comment">// 找最小</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>min<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    min <span class="token operator">=</span> j<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">!=</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> min<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>min<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>min<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="插入排序-边放最小到开头边插入"><a href="#插入排序-边放最小到开头边插入" class="header-anchor">#</a> 插入排序（边放最小到开头边插入）</h2> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 插入排序，边找最小边插入到开头</span>
        <span class="token function">insertSort</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">insertSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 目标值</span>
            <span class="token keyword">int</span> target <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 已插入（已排序）的末尾元素</span>
            <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token comment">// 遍历之前已插入（已排序）</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 当前元素比排序好末尾元素小</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> target<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="希尔排序-间隔分后插入排序"><a href="#希尔排序-间隔分后插入排序" class="header-anchor">#</a> 希尔排序(间隔分后插入排序)</h2> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 希尔排序，按间隔查找，大的在左边，小的在右边</span>
        <span class="token function">hillSort</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">hillSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// 间隔gap</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> gap <span class="token operator">=</span> len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> gap <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> gap <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 插入排序</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> gap<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 需要插入的 值</span>
                <span class="token keyword">int</span> target <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> k <span class="token operator">=</span> j<span class="token punctuation">;</span>
                <span class="token comment">// 和 k 有关，j 没有关系</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">&gt;=</span> gap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>k <span class="token operator">-</span> gap<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>k <span class="token operator">-</span> gap<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        k <span class="token operator">-=</span> gap<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> target<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="快速排序"><a href="#快速排序" class="header-anchor">#</a> 快速排序</h2> <h3 id="单边循环快排"><a href="#单边循环快排" class="header-anchor">#</a> 单边循环快排</h3> <blockquote><p>指针i,j初始 left</p> <ul><li>j变化找最小</li> <li><code>i</code>负责<code>交换</code>找到的值（下标没换）</li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 单边循环快速排序，分左右，基准值 默认从最右边</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> partition <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> partition <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> partition <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> target <span class="token operator">=</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 指针i,j初始 left</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> left<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 值 交换，下标没变</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 值交换</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 返回下标（下一次的分界值）</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="双边循环快排"><a href="#双边循环快排" class="header-anchor">#</a> 双边循环快排</h3> <blockquote><p>分左右，两个指针，一个在左边，一个在右边</p></blockquote> <p>⚒注意：</p> <ul><li>先<code>右往左</code>，找<code>小</code>的，其次<code>左往右</code>，找<code>大</code>的</li> <li>不能颠倒顺序</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 双边循环快速排序，分左右，两个指针，一个在左边，一个在右边</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> partition <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> partition <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> partition <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> base <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> left<span class="token operator">=</span>i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> right<span class="token operator">=</span>j<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 右往左，找小的</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right <span class="token operator">&amp;&amp;</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> base<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                right<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 左往右，找大的</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right <span class="token operator">&amp;&amp;</span> array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> base<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                left<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 找到</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span>i<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> array<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="arraylist"><a href="#arraylist" class="header-anchor">#</a> ArrayList</h2> <blockquote><p>扩容</p></blockquote> <ol><li><code>无参</code>构造：容量为零</li> <li>有参构造：指定容量数组</li> <li><code>add</code>：首次容量<code>10</code>，下次<code>1.5倍</code></li> <li>addAll：
<ul><li>没有元素：Math.max(10，实际元素个数)</li> <li>有元素：Math.max(原容量1.5倍，实际元素个数)</li></ul></li></ol> <h2 id="iterator"><a href="#iterator" class="header-anchor">#</a> Iterator</h2> <blockquote><p>fail-fast、fail-safe</p></blockquote> <ul><li><code>fail-fast</code>（ArrayList）：遍历同时不能修改，<code>立刻报错</code></li> <li><code>fail-safe</code>（CopyOnWriteArrayList）：遍历同时可以修改，但本次遍历数据还是使用之前</li></ul> <h2 id="linkedlist"><a href="#linkedlist" class="header-anchor">#</a> LinkedList</h2> <blockquote><p>LinkedList和ArrayList区别</p></blockquote> <ul><li><code>LinkedList</code>：
<ul><li>双向<code>链表</code></li> <li>随机访问慢（遍历链表，沿着路线）</li> <li>占用内存多（记录前后节点）</li></ul></li> <li><code>ArrayList</code>：
<ul><li><code>数组</code></li> <li>随机访问快（下标）</li> <li>利用<code>cpu缓存</code>，局部性原理（例：1 2 3 4 5 6 7 8）</li></ul></li></ul> <h2 id="hashmap"><a href="#hashmap" class="header-anchor">#</a> HashMap</h2> <blockquote><p>null 作为键只能有一个，null 作为值可以有多个</p></blockquote> <h3 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h3> <ul><li>1.7(头插法)：<code>数组+链表</code></li> <li>1.8(尾插法)：<code>数组+（链表 | 红黑树）</code></li></ul> <h3 id="树化和退化"><a href="#树化和退化" class="header-anchor">#</a> 树化和退化</h3> <ul><li><code>树化</code>意义：
<ul><li>红黑树避免<code>DDOS</code>攻击，防止链表超长</li> <li>负载因子<code>0.75</code> <ul><li>16*3/4=12</li> <li>超过12，扩容，即32（原来的一倍）</li></ul></li> <li>链表超过8概率：0.000000006</li></ul></li> <li>树化规则：
<ul><li>链表<code>长度超过8</code>：
<ul><li>先<code>扩容</code>减少链表长度</li> <li>数组容量<code>&gt;=64</code>，树化</li></ul></li></ul></li> <li>退化规则：
<ul><li>情况1：<code>扩容</code>时，导致红黑树个数&lt;=6</li> <li>情况2：<code>remove</code>树节点，以下当中有一个为null
<ul><li>root</li> <li>root.left</li> <li>root.right</li> <li>root.left.left</li></ul></li></ul></li></ul> <h3 id="索引计算"><a href="#索引计算" class="header-anchor">#</a> 索引计算</h3> <blockquote><p>Hashtable</p></blockquote> <ul><li>计算方法：
<ol><li><code>hashcode</code>()</li> <li>二次哈希：HashMap的<code>hash</code>()方法
<ul><li>作用：哈希分布均匀</li></ul></li> <li>索引：<code>&amp; (capacity-1)</code></li></ol></li> <li>数组容量2的n次幂：
<ul><li>没扩容计算索引：位运算 替代 &amp;</li> <li>扩容计算索引位置：
<ul><li>不变：hash &amp; oldCap=0</li> <li>变：新=老+oldCap</li></ul></li></ul></li></ul> <h3 id="put与扩容"><a href="#put与扩容" class="header-anchor">#</a> put与扩容</h3> <ul><li><p>put：</p> <ol><li>首次使用才创建数组</li> <li>计算索引（桶下标）</li> <li>没有占用，创建node占位</li> <li>被占用：
<ul><li>TreeNode，走红黑树</li> <li>普通Node，走链表，如果链表长度超过阈值（即8），走树化或扩容（&lt;=64）</li></ul></li> <li>返回前检测容量超过阈值，超过扩容</li></ol></li> <li><p>1.7和1.8：</p> <ul><li>插入节点：
<ul><li>1.7：<code>头</code>插法</li> <li>1.8：<code>尾</code>插法</li></ul></li> <li>扩容：
<ul><li>1.7：大于阈值<code>没有空位才扩容</code>，即不能在节点下添加节点形成链表</li> <li>1.8：大于阈值就扩容</li></ul></li> <li>1.8扩容计算索引有优化
<ul><li>不变：hash &amp; oldCap=0</li> <li>变：新=老+oldCap</li></ul></li></ul></li> <li><p>扩容加载因子默认0.75：</p> <ol><li><code>空间</code>占用和查询<code>时间</code>权衡</li> <li><code>大于</code>：空间节省，时间长</li> <li><code>小于</code>：扩容频繁，空间占用多</li></ol></li></ul> <h3 id="并发问题"><a href="#并发问题" class="header-anchor">#</a> 并发问题</h3> <ul><li><p>初始状态：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220415084335031.png" alt="image-20220415084335031"></p></li> <li><p>线程二执行：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220415084443029.png" alt="image-20220415084443029"></p></li> <li><p>线程1执行：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220415084632751.png" alt="image-20220415084632751"></p></li></ul> <h3 id="key设计"><a href="#key设计" class="header-anchor">#</a> key设计</h3> <ol><li><p><code>HashMap</code>的key可以为<code>null</code>，其他Map实现不行</p></li> <li><p>key是对象（特殊），例student：</p> <ul><li>必须实现<code>hashCode</code>和<code>equals</code></li> <li>key的内容不可变，例年龄不可变</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMapMutableKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>stu<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 注意：不可变</span>
        stu<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">int</span> age<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">return</span> age <span class="token operator">==</span> student<span class="token punctuation">.</span>age <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> student<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>String对象的hashCode()</p> <ul><li>均匀散列</li> <li>计算：$32*h$----&gt;$h≪5$</li></ul> <h2 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h2> <h3 id="饿汉式-runtime"><a href="#饿汉式-runtime" class="header-anchor">#</a> 饿汉式（Runtime）</h3> <blockquote><ul><li><code>private</code>Singleton1()：
<ul><li>抛出异常防止反射破坏单例</li></ul></li> <li><code>readResolve()</code>：
<ul><li>防止反序列化</li></ul></li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton1</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;单例对象不能重复创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private Singleton1()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton1</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton1</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">otherMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;otherMethod()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="枚举饿汉式-naturalordercomparator"><a href="#枚举饿汉式-naturalordercomparator" class="header-anchor">#</a> 枚举饿汉式（NaturalOrderComparator）</h3> <blockquote><p>天然防反射、序列化</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Singleton2</span> <span class="token punctuation">{</span>
    INSTANCE<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private Singleton2()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;@&quot;</span> <span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton2</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">otherMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;otherMethod()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="懒汉式"><a href="#懒汉式" class="header-anchor">#</a> 懒汉式</h3> <blockquote><p>public static synchronized Singleton3 getInstance()：</p> <ul><li>理想：首次创建单例对象才需要同步</li> <li>实际：每次调用都同步（synchronized 笨重）</li> <li>解决：双检锁懒汉式</li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton3</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private Singleton3()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton3</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// Singleton3.class</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton3</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">otherMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;otherMethod()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="双检锁懒汉式-console"><a href="#双检锁懒汉式-console" class="header-anchor">#</a> 双检锁懒汉式（Console）</h3> <blockquote><p>解决懒汉式问题</p> <p>必须加volatile：</p> <ul><li><code>INSTANCE = new Singleton4()</code> 不是原子的</li> <li>加volatile顺序：
<ol><li><code>创建</code>对象</li> <li>调用<code>构造</code></li> <li>静态遍历<code>赋值</code></li></ol></li> <li>不加volatile顺序：
<ul><li>可能<code>先赋值</code>，再调用<code>构造</code>（成员变量赋值）</li></ul></li> <li>结果：
<ul><li>线程1赋值</li> <li>线程2
<ul><li>第一个if (INSTANCE == null) ，不为null</li> <li>返回未完全赋值对象，即<code>静态变量有值，而成员变量没有</code></li></ul></li></ul></li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton4</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private Singleton4()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton4</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 可见性，有序性</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton4</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton4</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">otherMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;otherMethod()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="内部类懒汉式-集合"><a href="#内部类懒汉式-集合" class="header-anchor">#</a> 内部类懒汉式（集合）</h3> <blockquote><p>内部类可以调用该类的私有方法，原因内部类在该类中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton5</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private Singleton5()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Holder</span> <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token class-name">Singleton5</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton5</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Holder</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">otherMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;otherMethod()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jdk中的单例"><a href="#jdk中的单例" class="header-anchor">#</a> JDK中的单例</h3> <ol><li><code>Runtime</code>：饿汉式</li> <li><code>Console</code>：双检锁懒汉式</li> <li>Collections.<code>EmptyNavigableSet</code>：内部类懒汉式</li> <li>Collections.ReverseComparator.<code>REVERSE_ORDER</code>：内部类懒汉式</li> <li>Comparators.<code>NaturalOrderComparator</code>.INSTANCE：枚举饿汉式</li></ol> <h1 id="并发篇"><a href="#并发篇" class="header-anchor">#</a> 并发篇</h1> <h2 id="线程状态"><a href="#线程状态" class="header-anchor">#</a> 线程状态</h2> <blockquote><p>五种和六种区别</p> <p>interrupt、park、unpark：：打断等待、有限等待，恢复成可运行</p></blockquote> <p>🔨六种：</p> <ol><li><code>新建</code>：
<ul><li>对象被创建，未调用start方法</li> <li>未与操作系统底层关联</li></ul></li> <li><code>可运行</code>：
<ul><li>调用start方法，进入可运行</li> <li>与底层关联</li></ul></li> <li><code>终结</code>：
<ul><li>代码执行完毕</li> <li>取消与底层线程关联</li></ul></li> <li><code>阻塞</code>：
<ul><li>获取<code>锁失败</code>：可运行-&gt;阻塞，不占用cpu时间</li> <li>持锁线程释放锁，阻塞线程进入可运行</li></ul></li> <li><code>等待</code>：
<ul><li>获取<code>锁</code>，<code>条件不满足</code>，调用<code>wait</code></li> <li>持锁线程调用<code>notify</code>或notifyall，唤醒等待线程</li></ul></li> <li><code>有限时等待</code>：
<ul><li>情况一：
<ul><li>获取锁后，条件不满足，调用<code>wait(long)</code>，有时限等待</li> <li>持锁线程调用<code>notify</code>、notifyall或等待<code>超时</code>，唤醒等待线程</li></ul></li> <li>情况二：
<ul><li><code>sleep(long)</code></li></ul></li></ul></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220415224823686.png" alt="image-20220415224823686"></p> <p>🔨五种：</p> <blockquote><p>参考操作系统划分</p></blockquote> <ol><li>运行：执行代码</li> <li>就绪：<code>有资格</code>分到cpu，但未轮到它</li> <li>阻塞：<code>没资格</code>分到cpu
<ul><li>阻塞、等待、有限等待</li> <li>阻塞I/o</li></ul></li> <li>新建和终结：和六种中的一样</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220416110721954.png" alt="image-20220416110721954"></p> <h2 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h2> <blockquote><p>7大参数</p> <p>核心-&gt;队列-&gt;救急-&gt;策略</p> <p>模式</p> <ul><li>核心：正式员工</li> <li>救急：外包员工</li> <li>生存时间：项目完成，外包回家</li> <li>策略：没有外包了</li></ul></blockquote> <ol><li><p><code>corePoolSize</code>：核心线程数目</p></li> <li><p><code>maximunPoolSize</code>：总线程数目，即核心+救急</p></li> <li><p>救急：</p> <ul><li><p><code>keepAliveTime</code>：救急生存时间</p></li> <li><p><code>unit</code>：救急时间单位，例秒、毫秒</p></li></ul></li> <li><p><code>workQueue</code>：没有核心线程，新任务到此队列</p></li> <li><p><code>threadFactory</code>：设置线程名字</p></li> <li><p><code>handler</code>：核心+队列+救急慢后策略：</p> <ul><li>抛异常 java.util.concurrent.ThreadPoolExecutor.<code>AbortPolicy</code></li> <li>调用者执行任务 java.util.concurrent.ThreadPoolExecutor.<code>CallerRunsPolicy</code></li> <li>丢弃任务 java.util.concurrent.ThreadPoolExecutor.<code>DiscardPolicy</code></li> <li>丢弃最早排队任务 java.util.concurrent.ThreadPoolExecutor.<code>DiscardOldestPolicy</code></li></ul></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220416153917590.png" alt="image-20220416153917590"></p> <h2 id="wait和sleep"><a href="#wait和sleep" class="header-anchor">#</a> wait和sleep</h2> <ul><li>共同：
<ul><li>wait()、wait(long)、sleep(long)，放弃cpu，进入阻塞</li></ul></li> <li>不同：
<ul><li>方法归属：
<ul><li>sleep(long)：<code>Thread</code>静态方法</li> <li>wait()、wait(long)：<code>Object</code>成员方法</li></ul></li> <li>醒来时机：
<ul><li>sleep(long)、wait(long)：时间过期后</li> <li>wait()<code>不唤醒，一直等</code></li></ul></li> <li>锁特性（<code>重点</code>）：
<ul><li>调用<code>wait</code>方法，需要<code>对象的锁</code>，sleep不需要</li> <li><code>wait方法释放锁</code>，其他线程可以用锁</li></ul></li></ul></li></ul> <h2 id="lock和synchronized"><a href="#lock和synchronized" class="header-anchor">#</a> lock和synchronized</h2> <blockquote><ul><li>lock和synchronized的区别</li> <li>reentrantLock的公平、非公平锁</li> <li>reentrantLock条件变量</li></ul></blockquote> <p>🔨区别：</p> <ul><li>语法：
<ul><li>synchronized关键字：
<ul><li><code>c++</code>实现</li> <li>退出自动释放</li></ul></li> <li>Lock<code>接口</code>：
<ul><li><code>Java</code>实现</li> <li>手动调用<code>unlock</code>释放</li></ul></li></ul></li> <li>功能：
<ul><li>两者属于<code>悲观锁</code>，互斥、同步、锁重入</li> <li>Lock：
<ul><li>获取等待状态</li> <li>公平锁</li> <li>可打断</li> <li>可超时</li> <li>多条件变量</li></ul></li> <li>Lock场景：
<ul><li>xReentrantLock</li> <li>ReentrantReadWriteLock</li></ul></li></ul></li> <li>性能：
<ul><li>没有竞争：synchronized（偏向锁、轻量级锁）</li> <li>有竞争：Lock</li></ul></li></ul> <p>🔨公平、非公平锁：</p> <ul><li>公平锁：指未处于阻塞队列线程竞争锁，老实排队</li> <li><code>非公平锁</code>：指未处于阻塞队列线程竞争锁，和<code>队列头唤醒</code>的竞争</li> <li>注意：<code>公平锁（不用）</code>降低吞吐量</li></ul> <p>🔨条件变量：</p> <ul><li><p><code>reentrantLock</code></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220417112548809.png" alt="image-20220417112548809"></p></li></ul> <h2 id="volatile"><a href="#volatile" class="header-anchor">#</a> volatile</h2> <blockquote><p>线程安全三个问题：</p> <ul><li>原子性</li> <li>可见性</li> <li>有序性</li></ul></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220416213335407.png" alt="image-20220416213335407"></p> <p>✔️原子性：</p> <ul><li>问题：<code>多线程</code>下指令发生交错，共享变量读写混乱</li> <li>解决：悲观锁和乐观锁，<code>volatile不能</code></li></ul> <p>✔️可见性：</p> <ul><li>问题：<code>编译器</code>优化、<code>缓存</code>优化或<code>CPU指令重排</code>序优化，导致共享变量修改其他<code>不可见</code></li> <li>解决：volatile修饰变量</li></ul> <p>✔️有序性：</p> <ul><li><p>问题：编译器优化、缓存优化或CPU指令重排序优化，指令<code>顺序</code>不一致</p></li> <li><p>解决：volatile修饰变量读写加入屏障</p></li> <li><p>注意：</p> <ul><li><p>写：volatile修饰的放到<code>最后写</code>，其他变量不能向下越</p></li> <li><p>读：volatile修饰的放到<code>开头读</code>，其他变量不能向上越</p></li> <li><p>只能防止同一个线程指令重排</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220417211229488.png" alt="image-20220417211229488"></p></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220417211240588.png" alt="image-20220417211240588"></p> <h2 id="悲观锁和乐观锁"><a href="#悲观锁和乐观锁" class="header-anchor">#</a> 悲观锁和乐观锁</h2> <ul><li>悲观锁：<code>synchronized</code>、<code>lock</code> <ul><li>核心：线程占有锁，才能修改共享变量</li> <li>运行-阻塞-唤醒，<code>线程上下文切换</code></li></ul></li> <li>乐观锁：<code>atomicInteger</code> <ul><li>核心：<code>无需加锁</code>，只能一个线程修改共享变量，其他失败<code>不断重试</code>（很乐观）</li> <li><code>cas</code>保证原子性</li> <li>一直运行，<code>不涉及阻塞</code>，不需要线程上下文切换</li> <li>需要<code>多核cpu支持</code></li></ul></li></ul> <h2 id="hashtable和concurrenthashmap"><a href="#hashtable和concurrenthashmap" class="header-anchor">#</a> Hashtable和ConcurrentHashMap</h2> <blockquote><p>区别</p> <p>ConcurrentHashMap不同版本实现</p></blockquote> <p>✔️区别：</p> <ul><li>线程<code>安全</code>的Map集合</li> <li><code>Hashtable</code>并发度低：一把锁，同一时刻只有一个线程</li> <li><code>ConcurrentHashMap</code>并发度高，多把锁</li></ul> <p>✔️ConcurrentHashMap1.7：</p> <ul><li><p>结构：<code>Segment</code>（大数组）+<code>HashEntry</code>（小数组）+链表，每个segment对应一把锁</p></li> <li><p>并发度(segment大小)：<code>segment数组不能扩容</code>，意味并发度创建时固定</p></li> <li><p>索引：</p> <ul><li>大数组(Segment)$2^m$，key的二次hash值的高m位</li> <li>小数组$2^n$，key的二次hash值的低n位</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220420183115633.png" alt="image-20220420183115633"></p></li> <li><p>扩容：小数组(HashEntry)超过扩容因子(<code>3/4</code>)，<code>扩容翻倍</code>。不影响其他小数组</p></li> <li><p>segment[0]原型：</p> <ul><li>创建小数组，以原型为依据</li> <li>例：数组大小、扩容因子</li></ul></li></ul> <p>✔️ConcurrentHashMap1.8：</p> <ul><li><p>结构：<code>Node 数组+链表或红黑树</code>，锁冲突，利用cas非synchronized</p></li> <li><p>并发度：Node数组多大并发度多大，区别在于<code>Node可以扩容</code></p></li> <li><p>扩容：Node满<code>3/4</code></p> <ul><li><p>并发get：</p> <ul><li><code>ForwardingNode</code>：决定在新数组或旧数组查找</li> <li>链表长度<code>超过1</code>，对节点复制，怕节点迁移后<code>指向</code>发生变化</li> <li>扩容后索引不变，节点无需复制</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220420195041794.png" alt="image-20220420195041794"></p></li> <li><p>并发put：</p> <ul><li>操作同一个，put<code>阻塞</code></li> <li>头节点不是<code>ForwardingNode</code>，并发执行</li> <li>头节点是ForwardingNode，<code>协助</code>扩容</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220420195742955.png" alt="image-20220420195742955"></p></li></ul></li> <li><p>扩容单位：<code>后往前</code>前移链表，处理过(迁移)的标记<code>ForwardingNode</code></p></li> <li><p>容量(贴近$2^n$)：capacity(需要放的容量)/factory(因子)</p></li> <li><p>懒惰初始化</p></li></ul> <h2 id="threadlocal"><a href="#threadlocal" class="header-anchor">#</a> ThreadLocal</h2> <blockquote><p>作用和原理</p> <p>内存释放时机</p></blockquote> <p>✔️作用：</p> <ul><li>每个线程各用各的<code>资源对象(value)</code></li> <li>线程内<code>资源共享(Map中)</code></li></ul> <p>✔️原理：</p> <ul><li>ThreadLocalMap存储资源对象</li> <li>set：
<ul><li>key：ThreadLocal</li> <li>value：资源对象</li> <li>放到ThreadLocalMap</li></ul></li> <li>get和remove：和Map使用一样，例：get(ThreadLocal)和remove(ThreadLocal)</li></ul> <p>✔️<code>ThreadLocalMap</code>特点：</p> <ul><li><p>key：</p> <ul><li>hash值统一分配</li> <li>弱引用，GC释放内存</li></ul></li> <li><p>容量<code>16</code>，扩容因子<code>2/3</code>，扩容后容量<code>翻倍</code></p></li> <li><p>key索引冲突后用<code>开放寻址法</code></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220420182321795.png" alt="image-20220420182321795"></p></li></ul> <p>✔️内存释放时机：</p> <ul><li>GC释放key：
<ul><li>释放key，value不释放</li></ul></li> <li>释放value：
<ul><li><code>get</code>key：key为空，释放value</li> <li><code>set</code>key：清除<code>附近</code>的null key的value值</li></ul></li> <li><code>remove</code>释放key和value(推荐)：
<ul><li>也会清除附近的<code>null key的value值</code></li></ul></li></ul> <h1 id="虚拟机篇"><a href="#虚拟机篇" class="header-anchor">#</a> 虚拟机篇</h1> <h2 id="jvm内存结构"><a href="#jvm内存结构" class="header-anchor">#</a> JVM内存结构</h2> <blockquote><ul><li><p>内存结构划分</p></li> <li><p>方法区、永久代、元空间关系</p></li></ul></blockquote> <p>🔨内存结构划分：</p> <ul><li>javac：源代码(source)-&gt;字节码(class)</li> <li>执行
<ol><li>类加载子系统：加载class</li> <li><code>方法区</code>：<code>类</code>的信息、静态变量</li> <li>JVM虚拟机<code>栈</code>：执行main，局部<code>变量</code>、<code>方法参数</code>、对象引用等</li> <li><code>堆</code>：存储<code>对象</code></li> <li>垃圾回收器：<strong>回收不用的对象</strong></li> <li>解释器：字节码-&gt;机器码</li> <li>程序计数器：线程切换，恢复后继续</li> <li>本地方法栈：非Java实现的方法调用</li> <li>JIT即时编译器：将频繁使用代码-&gt;机器码缓存</li></ol></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421200532160.png" alt="image-20220421200532160"></p> <p>🔨内存溢出：</p> <ul><li>不会：程序计数器</li> <li><code>OutOfMemoryError</code>：
<ul><li><code>堆</code>耗尽：对象越来越多，一直用</li> <li><code>方法区</code>耗尽：加载类越来越多，框架运行期间动态生成类</li> <li>虚拟机栈：线程个数</li></ul></li> <li><code>StackOverflowError</code>：
<ul><li>方法递归未结束</li></ul></li></ul> <p>🔨方法区、永久代、元空间：</p> <ul><li>方法区：存类、方法字节码</li> <li>永久代：1.8之前</li> <li>元空间：1.8之后</li> <li>执行流程：
<ul><li>类加载器将class加载并存储到元空间</li> <li>元空间无法直接访问，X.class，Y.class间接访问</li> <li>不用时，GC释放</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421204128650.png" alt="image-20220421204128650"></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421205454681.png" alt="image-20220421205454681"></p> <h2 id="jvm内存参数"><a href="#jvm内存参数" class="header-anchor">#</a> JVM内存参数</h2> <blockquote><p>熟悉和大小相关的JVM参数</p></blockquote> <p>🔨堆内存，大小：</p> <ul><li><code>-Xms</code>：最小堆内存（新时代和老年代)</li> <li><code>-Xmx</code>：最大堆内存（新时代和老年代)</li> <li>建议-Xms和-Xmx相等</li> <li>-XX:NewSize和-XX:MaxNewSize（默认，无需修改）：新生代最小和最大值</li> <li><code>-Xmn</code>：新生代大小，即设置最大和最小相等</li> <li>保留：指一开始不占用过多</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421205625549.png" alt="image-20220421205625549"></p> <p>🔨比例：</p> <ul><li>-XX:NewRatio=2:1
<ul><li>老：2</li> <li>新：1</li></ul></li> <li>-XX:SurvivorRatio=4:1
<ul><li>伊甸园：4</li> <li>form或to：1</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421210153192.png" alt="image-20220421210153192"></p> <p>🔨元空间内存：</p> <ul><li>class space：类的基本信息</li> <li>non-class space：基本之外（方法字节码、注解）</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421211347476.png" alt="image-20220421211347476"></p> <h2 id="jvm垃圾回收"><a href="#jvm垃圾回收" class="header-anchor">#</a> JVM垃圾回收</h2> <blockquote><ul><li>掌握算法</li> <li>掌握思想</li> <li>理解三色标记及漏标</li> <li>了解常见垃圾回收器</li></ul></blockquote> <p>🔨算法</p> <ul><li><p>标记<code>清除</code>：</p> <ol><li>找GC Root（一定不会回收）</li> <li>标记：沿着根标记</li> <li>清除：除去未标记</li> <li>缺点：内存碎片</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421211812744.png" alt="image-20220421211812744"></p></li> <li><p>标记<code>整理</code>：</p> <ul><li>缺点：性能慢，多了整理</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421212032510.png" alt="image-20220421212032510"></p></li> <li><p>标记<code>复制</code>：</p> <ol><li>内存分两块
<ul><li>to：总是空闲</li> <li>from：存新对象</li></ul></li> <li>复制：from活的到to</li> <li>交换from和to，保证to一直空</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421212130369.png" alt="image-20220421212130369"></p></li></ul> <p>🔨GC和分代回收</p> <ul><li><p>GC：实现内存自动释放，减少碎片</p></li> <li><p>GC要点：</p> <ul><li>区域：<code>堆内存</code></li> <li>判断对象存活：<code>可达性</code>分析、<code>三色</code>标记法</li> <li>思想：分代回收
<ul><li>新生代：标记复制</li> <li>老年代：标记整理</li></ul></li> <li>方法：
<ul><li>Minor GC：新生代，时间短</li> <li>Mixed GC(G1)：新生代+老年代（部分）</li> <li>Full GC：新生代+老年代（完整），时间长</li></ul></li></ul></li> <li><p>分代回收：</p> <ol><li><p><code>新生代</code>：伊甸园和幸存区</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421223458496.png" alt="image-20220421223458496"></p></li> <li><p>伊甸园内存不足，标记Eden和from存活对象</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421223809619.png" alt="image-20220421223809619"></p></li> <li><p>复制存活对象到to</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421223823147.png" alt="image-20220421223823147"></p></li> <li><p>from和to交换位置</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421223723303.png" alt="image-20220421223723303"></p></li> <li><p>老年代：幸存区内存不足或大对象导致提前晋升</p></li></ol></li></ul> <p>🔨三色标记：</p> <ul><li><p>黑色-已标记</p></li> <li><p>灰色-标记中</p></li> <li><p>白色-未标记</p></li> <li><p>步骤：</p> <ol><li><p>起始</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421224445665.png" alt="image-20220421224445665"></p></li> <li><p>黑色引用的对象变为灰色</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421224531761.png" alt="image-20220421224531761"></p></li> <li><p>依次类推，白色为垃圾：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421224618906.png" alt="image-20220421224618906"></p></li></ol></li></ul> <p>🔨并发漏标问题：</p> <ol><li>标记还未完成阶段</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421224816405.png" alt="image-20220421224816405"></p> <ol start="2"><li><p>用户线程修改对象之间引用</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421224938571.png" alt="image-20220421224938571"></p></li> <li><p>其他用户线程<strong>建立新的引用</strong>，因为之前默认处理过，产生漏标</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421225118738.png" alt="image-20220421225118738"></p></li> <li><p><strong>新增对象</strong>，一样漏标</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220421225305180.png" alt="image-20220421225305180"></p></li></ol> <p>🔨解决漏标：</p> <ol><li><code>incremental update</code> 增量更新法(CMS)：
<ul><li>监听赋值动作</li></ul></li> <li><code>snapshot at the beginning</code>(SATB，G1) 原始快照法
<ul><li>新加对象记录</li> <li>被删除引用记录</li> <li>监听赋值动作</li></ul></li></ol> <p>🔨垃圾回收器：</p> <ul><li><p><code>Parallel</code>GC：</p> <ul><li>Eden：minor GC</li> <li>old：Full GC</li> <li>吞吐量</li></ul></li> <li><p><code>ConcurrentMarkSweep</code>GC(并发标记清除)：</p> <ul><li>回收跟不上创建，Full GC</li> <li>响应时间</li></ul></li> <li><p><code>G1</code>GC：</p> <ul><li><p>响应和吞吐量兼顾</p></li> <li><p>每个区域：Eden、survivor、old、humongous（大对象）</p></li> <li><p>阶段：<strong>新生代回收、并发标记、混合收集</strong></p></li> <li><p>回收跟不上创建，Full GC</p></li> <li><p>新生代回收步骤：</p> <ol><li><p>创建对象</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422162746605.png" alt="image-20220422162746605"></p></li> <li><p>内存不够，标记复制</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422162944435.png" alt="image-20220422162944435"></p></li> <li><p>复制完成，释放Eden</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163024883.png" alt="image-20220422163024883"></p></li> <li><p>老的晋升老年代</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163151346.png" alt="image-20220422163151346"></p></li></ol></li> <li><p>G1并发标记和混合收集</p> <ol><li><p>老年代过多，触发并发标记</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163445443.png" alt="image-20220422163445443"></p></li> <li><p>并发标记之后进入<code>混合收集</code>（收集部分老年代）</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163621291.png" alt="image-20220422163621291"></p></li> <li><p>复制</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163658138.png" alt="image-20220422163658138"></p></li> <li><p>复制完成，内存释放</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422163718436.png" alt="image-20220422163718436"></p></li></ol></li></ul></li></ul> <h2 id="内存溢出"><a href="#内存溢出" class="header-anchor">#</a> 内存溢出</h2> <ul><li>误用线程池</li> <li>查询数据量太大</li> <li>动态生成类</li></ul> <h2 id="类加载"><a href="#类加载" class="header-anchor">#</a> 类加载</h2> <blockquote><ul><li>类加载阶段</li> <li>类加载器</li> <li>双亲委派</li></ul></blockquote> <p>🔨类加载阶段：</p> <ol><li><p>加载</p> <ul><li>类的字节码载入<code>方法区</code></li> <li>先加载父类</li> <li>懒惰执行</li></ul></li> <li><p>链接</p> <ul><li>验证：类合法性</li> <li>准备：<code>空间</code>，其中final修饰的变量完成赋值</li> <li>解析：常量池的符号引用-&gt;直接引用</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422174409882.png" alt="image-20220422174409882"></p></li> <li><p>初始化</p> <ul><li><code>&lt;cinit&gt;</code>：静态代码块、static变量赋值、static final<code>引用</code>类型赋值</li> <li>懒惰执行</li></ul></li></ol> <blockquote><p>验证：</p> <ul><li><code>jps</code>：查看进程号</li> <li><code>jhsdb</code>：
<ul><li>命令：<code>jhsdb.exe hsdb</code></li> <li>class browser：查看jvm加载的类</li> <li>universe：堆内存范围</li> <li>g1regiondetails ：region详情</li> <li>scanoops start end 对象类型：查找对象地址</li> <li>inspect 地址：地址对应的对象详情</li></ul></li> <li><code>javap</code>：查看类字节码</li></ul></blockquote> <p>🔨1.8类加载器：</p> <table><thead><tr><th>名称</th> <th>加载类</th> <th>描述</th></tr></thead> <tbody><tr><td>Bootstrap ClassLoader</td> <td>JAVA_HOME/jre/lib</td> <td>无法直接访问</td></tr> <tr><td>Extension ClassLoader</td> <td>JAVA_HOME/jre/lib/ext</td> <td>上级Bootstrap</td></tr> <tr><td>Application ClassLoader</td> <td>classpath</td> <td>上级Extension</td></tr> <tr><td>自定义类加载器</td> <td>自定义</td> <td>上级Application</td></tr></tbody></table> <p>🔨双亲委派：</p> <ol><li>上级对下级共享，即类依赖jdk核心类</li> <li>保证核心类优先加载</li> <li><strong>上级找不到，下级接着找</strong></li> <li><code>上到下</code></li> <li>注意：不能自己编写类加载器
<ul><li>假冒的不会执行，优先执行底层（真正）</li> <li>不用双亲委派，加载假冒，还是需要找到父类<code>java.lang.Object</code>（没有委派）找不到</li></ul></li></ol> <h2 id="四种引用"><a href="#四种引用" class="header-anchor">#</a> 四种引用</h2> <blockquote><p>强引用、软引用、弱引用、虚引用</p></blockquote> <ol><li><p>强引用：</p> <ul><li>变量赋值，例A a=new A()</li> <li>回收：GC Root从根找不到</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422204636864.png" alt="image-20220422204636864"></p></li> <li><p>软引用：</p> <ul><li><code>SoftReference</code>a = new SoftReference(new A())</li> <li>回收：首次不收，<code>第二次</code>还不足才回收</li> <li>配合引用队列释放</li> <li>例：<strong>反射</strong>数据</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422204745756.png" alt="image-20220422204745756"></p></li> <li><p>弱引用：</p> <ul><li><code>WeakReference</code>a = new WeakReference(new A())</li> <li>回收：<code>立刻</code>回收</li> <li>配合引用队列释放</li> <li>例：<strong>ThreadLocalMap中的Entry对象</strong></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422204853456.png" alt="image-20220422204853456"></p></li> <li><p>虚引用：</p> <ul><li><code>PhantomReference</code>a = new PhantomReference(new A(), referenceQueue)</li> <li>回收：配合引用队列，<code>Reference</code>Handler将对象入队，对回收进一步处理</li> <li>例：<strong>cleaner释放DirectByteBuffer的直接内存</strong></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422205058275.png" alt=""></p></li></ol> <h2 id="finalize"><a href="#finalize" class="header-anchor">#</a> finalize</h2> <blockquote><p>子类重写：垃圾回收时就会调用</p> <p>资源释放和清理放到finalize不好，Java9后淘汰（@Deprecated）</p></blockquote> <p>🔨原理：</p> <ol><li><p>核心： java.lang.ref.<code>Finalizer</code>(类似引用对象)，有<code>unfinalized</code>(双向链表)，<code>ReferenceQueue</code>(引用队列)</p></li> <li><p>重写finalize对象，都会<strong>包装成Finalizer放到unfinalized</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422205652581.png" alt="image-20220422205652581"></p></li> <li><p>垃圾回收：对象放到引用队列</p></li> <li><p>对象没有立刻被回收：unfinalized-&gt;Finalizer</p></li> <li><p>回收：<code>FinalizerThread</code>从队列取出每个Finalizer对象，真正执行finalize方法</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220422205859571.png" alt="image-20220422205859571"></p></li></ol> <p>🔨缺点：</p> <ol><li>无法保证资源释放：<code>守护</code>线程</li> <li>无法判断错误：执行finalize方法，<code>吞掉异常</code></li> <li>内存释放慢：第一次gc不能，等FinalizerThread调用完finalize</li> <li>finalize串行执行慢</li></ol> <h1 id="框架"><a href="#框架" class="header-anchor">#</a> 框架</h1> <h2 id="spring-refresh-概述"><a href="#spring-refresh-概述" class="header-anchor">#</a> spring refresh 概述</h2> <blockquote><p><code>refresh</code>是abstractApplicationContext的方法，初始化ApplicationContext</p> <p>步骤：</p> <ul><li>1：环境</li> <li>2 3 4 5 6：<code>BeanFactory</code></li> <li>7 8 9 10 12：<code>ApplicationContext</code></li> <li>11：初始化BeanFactory的<code>非延迟Bean</code></li></ul></blockquote> <p>refresh：</p> <ol><li><p>prepareRefresh：准备工作</p></li> <li><p>obtainFreshBeanFactory：创建<code>BeanFactory</code></p></li> <li><p>prepareBeanFactory：准备BeanFactory</p></li> <li><p>postProcessBeanFactory：子类扩展BeanFactory</p></li> <li><p>invokeBeanFactoryPostProcessors：后处理器扩展BeanFactory</p></li> <li><p>registerBeanPostProcessors：准备后处理器</p></li> <li><p>initMessageSource：国际化</p></li> <li><p>initApplicationEventMulticaster：发布器</p></li> <li><p>onRefresh：子类扩展</p></li> <li><p>registerListeners：监听器</p></li> <li><p>finishBeanFactoryInitialization：完成所有bean初始化</p></li> <li><p>finishRefresh：完成refresh，发布contextRefresh事件</p></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220423202613279.png" alt="image-20220423202613279"></p> <ol><li><p>prepareRefresh</p> <ul><li>创建Environment作为Application成员变量</li> <li><code>Environment</code>：
<ul><li><code>@Value</code>：赋值
<ul><li>systemProperties：Java键值</li> <li>systemEnvironment：系统键值</li> <li>*.properties：自定义键值</li></ul></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424102704758.png" alt="image-20220424102704758"></p></li> <li><p>obtainFreshBeanFactory</p> <ul><li>创建BeanFactory作为ApplicationContext成员变量</li> <li><code>BeanFactory</code>：
<ul><li>bean创建、依赖注入、初始化</li> <li><code>BeanDefinition</code>：
<ul><li>bean的设计蓝图：单例多例、依赖关系、初始销魂方法</li> <li>来源：xml、配置类、组件扫描</li> <li>去处：存入BeanFactory的<code>beanDefinitionMap</code></li> <li>BeanFactory-&gt;BeanDefinition</li></ul></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424103225891.png" alt="image-20220424103225891"></p></li> <li><p>prepareBeanFactory</p> <ul><li>完善BeanFactory</li> <li>beanExpressionResolver：解析SpEl</li> <li>propertyEditorRegistrars：完成${}解析</li> <li><code>registerResolvableDependency</code>：注册BeanFactory和ApplicationContext，使他们也能依赖注入</li> <li>beanPostProcessors：bean后处理器（生命周期各个阶段）
<ul><li>ApplicationContextAwareProcessor：解析Aware接口</li> <li>ApplicationListenerDetector：解析ListenerDetector的bean</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424103535658.png" alt="image-20220424103535658"></p></li> <li><p>postProcessBeanFactory</p> <ul><li>模板方法：空实现，子类扩展</li> <li>例：<code>web</code>，注册新的scope，完善BeanFactory</li></ul></li> <li><p>invokeBeanFactoryPostProcessors</p> <ul><li>调用BeanFactory后处理器</li> <li>BeanFactory后处理器：
<ul><li>BeanFactory扩展点</li> <li>常见：
<ul><li><code>ConfigurationClassPostProcessor</code>：解析
<ul><li>@Configuration</li> <li>@Bean</li> <li>@Import</li> <li>@PropertySource</li></ul></li> <li>PropertySourcesPlaceHolderConfigurer：替换BeanDefinition的${}</li> <li><code>MapperSacnnerConfigurer</code>：补充Mapper对应的BeanDefinition</li></ul></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424105009586.png" alt="image-20220424105009586"></p></li> <li><p>registerBeanPostProcessors</p> <ul><li>找后处理放到beanPostProcessors
<ul><li><code>AutowiredAnnotaionBeanPostProcessor</code>：解析@Autowired、@Value</li> <li>CommonAnnotationBeanPostProcessor：解析@Resource、@PostConstruct、@preDestroy</li> <li>AnnotationAwareAspectJAutoProxyCreator：bean自动创建代理</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424105359623.png" alt="image-20220424105359623"></p></li> <li><p>initMessageSource</p> <ul><li>添加messageSource，实现国际化</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424105612604.png" alt="image-20220424105612604"></p></li> <li><p>initApplicationEventMulticaster</p> <ul><li>广播器：applicationContextEventMulticaster</li> <li>作用：<code>发布器</code></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424105812219.png" alt="image-20220424105812219"></p></li> <li><p>onRefresh</p> <ul><li>模板方法：空实现、子类扩展</li> <li>例：SpringBoot准备webserver（<code>内嵌web容器</code>）</li></ul></li> <li><p>registerListeners</p> <ul><li>找监听器放到applicationEventMulticaster</li> <li>监听器：
<ul><li>实现<code>ApplicationListener</code>接口，重写<code>onApplicationEvent</code>方法</li> <li>@EventListener</li> <li>容器中的Bean</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424110039354.png" alt="image-20220424110039354"></p></li> <li><p>finishBeanFactoryInitialization</p> <ul><li>初始化非延迟bean，即<strong>所有bean都完成</strong></li> <li>conversionService：PropertyEditor补充</li> <li>embeddedValueResolvers：内嵌值解析器，解析@Value的${}（借用Environment功能）</li> <li>singletonObjects：缓存单例对象</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424110447509.png" alt="image-20220424110447509"></p></li> <li><p>finishRefresh</p> <ul><li>添加<code>lifecycleProcessor</code>（控制生命周期）</li> <li><strong>context的start</strong>：触发实现LifeCycle接口bean的start</li> <li><strong>context的stop</strong>：触发实现LifeCycle接口bean的stop</li> <li><code>contextRefreshed</code>：整个refresh完成</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220424112016756.png" alt="image-20220424112016756"></p></li></ol> <h2 id="spring-bean生命周期"><a href="#spring-bean生命周期" class="header-anchor">#</a> spring bean生命周期</h2> <ol><li>名称、缓存</li> <li>父子容器</li> <li>dependsOn</li> <li>scope</li> <li>创建bean</li> <li>类型转换处理</li> <li>销毁bean</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220604121221183.png" alt="image-20220604121221183"></p> <ol><li><p>名称、缓存</p> <ul><li>别名-&gt;实际名称</li> <li>缓存
<ul><li><code>singletonFactories</code>：三级缓存，单例<strong>工厂对象</strong></li> <li><code>earlySingletonObjects</code>：二级缓存，单例<strong>工厂产品(多个成品)对象</strong></li> <li><code>singletonObjects</code>：一级缓存，单例<strong>成品对象</strong></li></ul></li></ul></li> <li><p>父子容器</p> <ul><li>父子容器bean可以重复</li></ul></li> <li><p><code>dependsOn</code></p> <ul><li>非显式依赖：bean直接不存在依赖关系</li> <li>作用：指定非显式依赖</li></ul></li> <li><p>scope</p> <ul><li>singleton scope：单例池获取bean</li> <li>prototype scope：每次进入创建</li> <li>自定义 scope：request域获取bean</li></ul></li> <li><p>创建bean</p> <ul><li>bean实例：
<ul><li>autowiredAnnotationBeanPostProcessor
<ul><li>@Autowired</li> <li>唯一的带参构造</li></ul></li> <li>默认构造</li></ul></li> <li>依赖注入：
<ul><li>注意：都封装成<code>InjectionMetadata</code>依赖注入</li> <li>AutowiredAnnotationBeanPostProcessor
<ul><li>@Autowired</li> <li>@Value</li></ul></li> <li>CommonAnnotationBeanPostProcessor
<ul><li>@Resource</li></ul></li> <li>AUTOWIRE_BY_NAME
<ul><li>propertyValues名字</li></ul></li> <li>AUTOWIRE_BY_TYPE
<ul><li>propertyValues类型</li></ul></li> <li>applyPropertyValues
<ul><li><code>&lt;property name ref|value/&gt;</code></li></ul></li></ul></li> <li>初始化：
<ul><li>内置aware接口
<ul><li>BeanNameAware</li> <li>BeanFactoryAware</li></ul></li> <li>扩展aware接口
<ul><li>ApplicationContextAwareProcessor</li></ul></li> <li>@PostConstruct
<ul><li>CommonAnnotationBeanPostProcessor</li></ul></li> <li>InitializingBean</li> <li>initMethod</li> <li>aop代理
<ul><li>AnnotationAwareAspectJAutoProxyCreator</li></ul></li></ul></li> <li>销毁
<ul><li>注意：存储时都封装成<code>DisposableBeanAdapter</code>对销毁适配</li> <li>依据：
<ul><li>实现DisposableBean或AutoCloseable接口</li> <li>自定义destroyMethod</li> <li>@preDestroy</li></ul></li> <li>销毁的bean存储位置
<ul><li>singleton scope：BeanFactory</li> <li>自定义 scope：对象的域</li> <li>prototype scope：不会存储</li></ul></li></ul></li></ul></li> <li><p>类型转换处理</p> <ul><li><code>getBean</code>类型不匹配，尝试类型转换</li></ul></li> <li><p>销毁bean</p> <ul><li>时机：
<ul><li>singleton bean：
<ul><li>ApplicationContext.close</li> <li>找到所有Disposeable</li></ul></li> <li>自定义 scope bean：
<ul><li>生命周期结束</li></ul></li> <li>prototype bean：
<ul><li>手动AutowireCapableBeanFactory.destroy</li></ul></li></ul></li> <li>顺序：
<ol><li>后处理器，例@PreDestroy</li> <li>DisposableBean接口销毁</li> <li>destroyMethod</li></ol></li></ul></li></ol> <h2 id="spring事务失效"><a href="#spring事务失效" class="header-anchor">#</a> spring事务失效</h2> <blockquote><p>八种</p></blockquote> <ol><li><p>抛异常导致事务不能回滚</p> <ul><li>问题：默认回滚非检查异常</li> <li>解决：<code>@Transactional(rollbackFor = Exception.class)</code></li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service1</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> fromBalance <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">findBalanceBy</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fromBalance <span class="token operator">-</span> amount <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>自己try-catch</p> <ul><li>原因：catch自己处理异常，没有抛出</li> <li>解决：catch：throw new RuntimeException(e)</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service2</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> fromBalance <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">findBalanceBy</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fromBalance <span class="token operator">-</span> amount <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>aop切面顺序</p> <ul><li>原因：切面优先级最低，自定义切面在内层（捕获异常后没有抛出）</li> <li>解决：
<ul><li>catch：throw new RuntimeException(e)</li> <li>调整MyAspect 顺序：<code>@Order(Ordered.LOWEST_PRECEDENCE - 1)</code></li></ul></li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service3</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> fromBalance <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">findBalanceBy</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fromBalance <span class="token operator">-</span> amount <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* transfer(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">LoggerUtils</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;log:{}&quot;</span><span class="token punctuation">,</span> pjp<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>非public</p> <ul><li>原因：spring创建代理，添加事务（前提：public）</li> <li>解决：改为public</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service4</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> fromBalance <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">findBalanceBy</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fromBalance <span class="token operator">-</span> amount <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>父子容器</p> <ul><li>原因：
<ul><li>WebConfig子容器</li> <li>APPConfig父容器</li> <li>子容器扫描范围过大</li></ul></li> <li>解决：所有bean放同一容器，不需要父子容器</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">day04<span class="token punctuation">.</span>tx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">Service5</span> service<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        service<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">package</span> <span class="token namespace">day04<span class="token punctuation">.</span>tx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service5</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> fromBalance <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">findBalanceBy</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fromBalance <span class="token operator">-</span> amount <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 父</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;day04.tx.app.service&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... 有事务相关配置</span>
<span class="token punctuation">}</span>

<span class="token comment">// 子</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;day04.tx.app&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... 无事务配置</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>调用本类方法导致传播行为失效</p> <ul><li>原因：本类方法调用不走代理（没有增强）</li> <li>解决：依赖注入自己</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service6</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">LoggerUtils</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRES_NEW<span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">LoggerUtils</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>@<code>transactional</code>没有原子性</p> <ul><li><p>原因：事务原子性仅包含insert、update、delete、select  ... for update</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425174916871.png" alt="image-20220425174916871"></p></li> <li><p>解决：</p> <ul><li><p>注意：synchronized也不行，保证目标方法原子性，外层commit没有保证</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425175045451.png" alt="image-20220425175045451"></p></li> <li><p>解法：select …… for update替换select</p></li></ul></li></ul></li></ol> <h2 id="spring-mvc执行流程"><a href="#spring-mvc执行流程" class="header-anchor">#</a> spring mvc执行流程</h2> <blockquote><ul><li>准备阶段</li> <li>匹配阶段</li> <li>执行阶段</li></ul></blockquote> <p>✔️准备：</p> <ul><li>dispatcherServlet-&gt;init-&gt;refresh-&gt;组件</li></ul> <ol><li>dispatcherServlet：init</li> <li>init：创建spring容器，refresh</li> <li>refresh：组件</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425180658283.png" alt="image-20220425180658283"></p> <p>✔️匹配：</p> <ul><li>用户请求-&gt;DispatcherServlet-&gt;HandlerMapping-&gt;HandlerMethod-&gt;HandlerExecutionChain-&gt;HandlerAdapter</li></ul> <ol><li>匹配路径，能识别@RequestMapping优先级最高</li> <li>HandlerMethod：控制器对象和控制器方法信息</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425181714830.png" alt="image-20220425181714830"></p> <ol start="3"><li>HandlerExecutionChain：HandlerMethod和拦截器</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425181836155.png" alt="image-20220425181836155"></p> <ol start="4"><li>HandlerAdapter</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425181912296.png" alt="image-20220425181912296"></p> <p>✔️调用：</p> <ol><li>拦截器preHandle</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425182040150.png" alt="image-20220425182040150"></p> <ol start="2"><li>HandlerAdapter调用HandlerMethod</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425182116054.png" alt="image-20220425182116054"></p> <ol start="3"><li>第二步没有异常
<ul><li>返回ModelAndView</li> <li>拦截器postHandler</li> <li>解析视图</li></ul></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425182315522.png" alt="image-20220425182315522"></p> <ol start="4"><li>有异常，进入HandlerExceptionResolver</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220425182431548.png" alt="image-20220425182431548"></p> <ol start="5"><li>拦截器afterCompletion</li> <li>@ResponseBody：第二步生成JSON，不走视图解析</li></ol> <h2 id="spring注解"><a href="#spring注解" class="header-anchor">#</a> spring注解</h2> <p>✔️事务注解：</p> <ul><li><code>@EnableTransactionManagement</code>：
<ul><li>事务切面类：BeanFactoryTransactionAttributeSourceAdvisor</li> <li>解析事务属性：TransactionAttributeSource</li> <li>事务拦截器：TransactionInterceptor</li> <li>事务监听工厂：TransactionalEventListenerFactory</li></ul></li> <li><code>@Transactional</code></li></ul> <p>✔️核心：<code>@Order</code></p> <p>✔️切面：</p> <ul><li><code>@EnableAspectJAutoProxy</code> <ul><li>加载AnnotationAwareAspectJAutoProxyCreator：bean后处理器，创建代理</li></ul></li></ul> <p>✔️组件扫描和配置类：</p> <ul><li>@Component</li> <li>@Controller</li> <li>@Service</li> <li>@Repository</li> <li>@ComponentScan</li> <li>@Condition</li> <li>@Configuration
<ul><li>作用：保证@Bean互相调用</li></ul></li> <li>@Bean：不支持重载</li> <li>@Import：
<ul><li>用法：
<ul><li>引入单个bean</li> <li>引入配置类</li> <li>Selector引入多个类</li> <li>BeanDefinition</li></ul></li> <li>解析规则：
<ul><li>同一配置类：<code>先@Import后@Bean</code></li> <li>问题：后面解析覆盖前面</li> <li>解决：<code>DeferredImportSelector</code>（延迟导入选择器）</li></ul></li></ul></li> <li>@Lazy：
<ul><li>类延迟实例化</li></ul></li> <li>@PropertySource</li></ul> <p>✔️依赖注入：</p> <ul><li>@Autowired</li> <li>@Qualifier</li> <li>@Value</li></ul> <p>mvc mapping：</p> <ul><li>@RequestMapping：派生多个注解，例@GetMapping、@PutMapping等</li></ul> <p>mvc rest：</p> <ul><li>@RequestBody</li> <li><code>@ResponseBody</code>=@Controller+@RestController</li> <li>@ResponseStatus</li></ul> <p>mvc 统一处理：</p> <ul><li>@ControllerAdvice=@ResponseBody+@RestControllerAdvice</li> <li>@ExceptionHandler</li></ul> <p>mvc 参数：</p> <ul><li><code>@PathVariable</code></li></ul> <p>mvc ajax：</p> <ul><li>@CrossOrigin：跨域</li></ul> <p>boot auto：</p> <ul><li>@SpringBootApplication</li> <li>@EnableAutoConfiguration</li> <li>@SpringBootCOnfiguration</li></ul> <p>boot condition：</p> <ul><li>@ConditionanlOnClass：classpath存在某个class条件成立</li> <li>@ConditionalOnMissingBean：BeanFactory不存在bean</li> <li>@ConditionalOnProperty：配置文件存在property</li></ul> <p>boot properties：</p> <ul><li>@ConfigurationProperties：当前bean和配置文件键值绑定</li> <li>@EnableConfigurationProperties：
<ul><li>ConfigurationPropertiesBindingPostProcessor：bean后处理器，bean初始化前调用下面binder</li> <li>ConfigurationPropertiesBinder：真正绑定</li></ul></li></ul> <h2 id="springboot-自动配置原理"><a href="#springboot-自动配置原理" class="header-anchor">#</a> springboot 自动配置原理</h2> <p>🔨原理：</p> <ul><li>@SpringBootConfiguration=@ComponentScan+@EnableAutoConfiguration+@SpringBootConfiguration
<ol><li>@SpringBootConfiguration 和@Configuration区别：只能出现一次</li> <li>@ComponentScan：
<ul><li>excludeFilters：排除</li></ul></li> <li>@EnableAutoConfiguration：
<ul><li>@AutoConfigurationPackage：扫描包</li> <li>@Import（AutoConfigurationImportSelector.class）：加载<code>META-INF/spring.factories</code>自动配置类</li></ul></li></ol></li></ul> <p>🔨为什么不用@Import自动配置类：</p> <ul><li>原因：
<ul><li>主配置和自动配置类<code>强耦合</code></li> <li>自动配置类优先级高，导致后面被覆盖</li></ul></li> <li>解决：
<ul><li><code>@Import(AutoConfigurationImportSelector.class)</code>：加载<code>META-INF/spring.factories</code>自动配置类</li> <li>实现了<code>DeferredImportSelector</code>接口，延迟</li></ul></li></ul> <h2 id="spring的设计模式"><a href="#spring的设计模式" class="header-anchor">#</a> spring的设计模式</h2> <ol><li><p>单例：</p> <ul><li>org.springframework.aop.TruePointcut#INSTANCE</li> <li>org.springframework.aop.interceptor.ExposeInvocationInterceptor#ADVISOR</li> <li>org.springframework.core.annotation.AnnotationAwareOrderComparator#INSTANCE</li> <li>org.springframework.core.OrderComparator#INSTANCE</li> <li>注意：<code>bean不是单例</code></li></ul></li> <li><p>建造者：</p> <ul><li><p>优点：</p> <ul><li><code>链式调用</code>，比较爽</li> <li>灵活构建产品对象：没有build，产品不可用</li></ul></li> <li><p>案例：</p> <ul><li>org.springframework.beans.factory.support.BeanDefinitionBuilder</li> <li>org.springframework.web.util.UriComponentsBuilder</li> <li>org.springframework.http.ResponseEntity.HeadersBuilder</li> <li>org.springframework.http.ResponseEntity.BodyBuilder</li></ul></li></ul></li> <li><p>工厂方法：</p></li></ol> <ul><li>ApplicationContext和BeanFactory：
<ul><li>getBean，<code>封装</code>了bean创建过程和具体<strong>实现</strong></li></ul></li> <li>案例：
<ul><li>org.springframework.beans.factory.FactoryBean</li> <li>@Bean 标注的静态方法及实例方法</li> <li>ObjectFactory 及 ObjectProvider</li></ul></li></ul> <ol start="4"><li>适配器：</li></ol> <ul><li><p>org.springframework.web.servlet.HandlerAdapter</p> <ul><li>不同控制器（@Controller、@RequestMapping），必须适配为<code>HandlerAdapter</code>接口</li></ul></li> <li><p>org.springframework.beans.factory.support.DisposableBeanAdapter</p> <ul><li>适配<code>DisposableBean</code>统一调用销毁方法</li></ul></li></ul> <ol start="5"><li>复合：</li></ol> <ul><li><p>作用：</p> <ul><li>统一调用入口，委托具体干活实现</li></ul></li> <li><p>单例</p> <ul><li><p>org.springframework.web.method.support.HandlerMethodArgumentResolverComposite</p></li> <li><p>org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite</p></li> <li><p>org.springframework.web.servlet.handler.HandlerExceptionResolverComposite</p></li> <li><p>org.springframework.web.servlet.view.ViewResolverComposite</p></li></ul></li></ul> <ol start="6"><li>装饰者：</li></ol> <ul><li>org.springframework.web.util.ContentCachingRequestWrapper</li></ul> <ol start="7"><li>代理：</li></ol> <ul><li>装饰者：<code>注重功能增强</code>、避免子类通过继承来扩展功能</li> <li>代理：<code>注重目标访问</code></li> <li>案例：
<ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li> <li>org.springframework.aop.framework.ObjenesisCglibAopProxy</li></ul></li></ul> <ol start="8"><li>责任链：</li></ol> <ul><li>org.springframework.web.servlet.HandlerInterceptor</li></ul> <ol start="9"><li>观察者：</li></ol> <ul><li>org.springframework.context.ApplicationListener</li> <li>org.springframework.context.event.ApplicationEventMulticaster</li> <li>org.springframework.context.ApplicationEvent</li></ul> <ol start="10"><li>策略模式：</li></ol> <ul><li>org.springframework.beans.factory.support.InstantiationStrategy</li> <li>org.springframework.core.annotation.MergedAnnotations.SearchStrategy</li> <li>org.springframework.boot.autoconfigure.condition.SearchStrategy</li></ul> <ol start="11"><li>模板方法：</li></ol> <ul><li>JdbcTemplate，TransactionTemplate</li> <li>AbstractApplicationContext</li></ul> <h2 id="spring-bean-循环依赖"><a href="#spring-bean-循环依赖" class="header-anchor">#</a> spring bean 循环依赖</h2> <h3 id="解决set循环依赖的原理"><a href="#解决set循环依赖的原理" class="header-anchor">#</a> 解决set循环依赖的原理</h3> <p>🔨一级缓存：</p> <ul><li>第一次getBean：放入singletonObjects一级缓存</li> <li>后续getBean：缓存有，无需创建</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428151711996.png" alt="image-20220428151711996"></p> <ul><li><p>问题：</p> <ul><li>a获取b，b获取a：
<ul><li>由于没put，缓存不存在bean</li> <li>陷入死循环</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428151919648.png" alt="image-20220428151919648"></p></li></ul> <p>🔨二级缓存：</p> <ul><li>解决一级缓存问题：增加singletonFactories缓存</li> <li>把半成品（未依赖注入和初始化）放到singletonFactories</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428152151857.png" alt="image-20220428152151857"></p> <ul><li><p>问题：</p> <ul><li>b拿到a的bean：
<ul><li>a半成品没有完成代理增强</li> <li>拿到原始对象</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220427201431530.png" alt="image-20220427201431530"></p></li></ul> <p>🔨三级缓存：</p> <ul><li>解决二级缓存问题：将代理放在依赖注入之前（工厂判断是否提前创建代理）</li> <li>b获取a的bean后，工厂把a的代理提前创建好放到earlySingletonObejcts</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428153025363.png" alt="image-20220428153025363"></p> <h3 id="三级缓存不能解决的问题"><a href="#三级缓存不能解决的问题" class="header-anchor">#</a> 三级缓存不能解决的问题</h3> <blockquote><p>构造方法上的参数</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428154004253.png" alt="image-20220428154004253"></p> <blockquote><p>bean流程：创建、注入、初始化</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428154111002.png" alt="image-20220428154111002"></p> <blockquote><p>解决：四种</p></blockquote> <ol><li><p>a注入b的代理对象，b的真实对象，通过代理访问：</p> <ul><li>@Lazy</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428154227500.png" alt="image-20220428154227500"></p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">B</span> b<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Lazy</span> <span class="token class-name">B</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;A(B b) {}&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@PostConstruct</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;init()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>注入b的工厂，b的实例对象延迟创建：</p> <ul><li>ObjectProvider：延迟对象创建</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220428154353720.png" alt="image-20220428154353720"></p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> b<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;A({})&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@PostConstruct</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;init()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>@Scope生成代理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>proxyMode <span class="token operator">=</span> <span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span>TARGET_CLASS<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">A</span> a<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token class-name">A</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;B({})&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;init()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>加入Provider依赖：原理和ObjectProvider一样</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.inject<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.inject<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Provider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> b<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token class-name">Provider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;A({}})&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@PostConstruct</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;init()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>单例set方法循环依赖：
<ul><li>一级缓存：存放成品对象</li> <li>二级缓存：存放原始bean，也可能是代理bean</li> <li>三级缓存：存放工厂对象</li> <li>需要代理：工厂提前创建代理</li></ul></li> <li>构造方法和多例循环依赖解决：
<ul><li>@Lazy</li> <li>@Scope</li> <li>ObjectProvider</li> <li>Provider</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220427204214007.png" alt="image-20220427204214007"></p> <h1 id="javaguide"><a href="#javaguide" class="header-anchor">#</a> JavaGuide</h1> <h2 id="java特点"><a href="#java特点" class="header-anchor">#</a> Java特点</h2> <ul><li>面向对象（封装、继承、多态）</li> <li>生态强</li> <li>可靠、安全</li> <li>编译和解释并存（JIT即时编译器）</li> <li>Java9：AOT（ahead of time）</li></ul> <h2 id="jvm、jre、jdk"><a href="#jvm、jre、jdk" class="header-anchor">#</a> JVM、JRE、JDK</h2> <ul><li>JVM：运行Java字节码的虚拟机，Hotspot VM</li> <li>JRE：运行时环境，包含JVM、Java类库、Java命令等</li> <li>JDK：创建和编译程序，包含JRE、javac(编译器)、javadoc(工具)</li></ul> <h2 id="内部类"><a href="#内部类" class="header-anchor">#</a> 内部类</h2> <blockquote><p>四种</p></blockquote> <ol><li>成员内部类</li> <li>局部内部类（方法里有类）</li> <li>静态内部类</li> <li>匿名内部类
<ul><li>定义接口</li> <li>接口下有一个方法</li> <li>new 接口（必须实现方法）</li> <li>底层案例：创建线程（Thread，内部有run方法）</li></ul></li></ol> <div class="language-java extra-class"><pre class="language-java"><code> 	<span class="token comment">// 局部内部类（方法内部类）</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dispaly</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// JDK8形参变为隐式final声明</span>
        <span class="token keyword">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span> <span class="token comment">// 方法内部类即嵌套在方法里面, 不能使用修饰符public protected private</span>
            <span class="token comment">// public static int age = 10; // 不能定义静态属性</span>
            <span class="token comment">// public static void method2() { // 不能定义静态方法</span>
            <span class="token comment">//     System.out.println(&quot; &quot;);</span>
            <span class="token comment">// }</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以使用外部类的非静态属性 &amp; 方法</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以使用外部的静态属性 &amp; 方法</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Call method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// temp++; // 不能改变final类型的值</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 但是可以调用</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 方法内部类在方法里面创建</span>
        <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="jdbc连接数据库"><a href="#jdbc连接数据库" class="header-anchor">#</a> jdbc连接数据库</h2> <blockquote><p>6步</p> <p>jdbc:mysql://localhost:3306/数据库名</p></blockquote> <ol><li><p>注册驱动（使用什么连接）</p></li> <li><p>获取连接（账号、密码、数据库名）</p></li> <li><p>获取传输器</p></li> <li><p>通过传输器写SQL执行</p></li> <li><p>处理数据</p></li> <li><p>关闭连接</p> <div class="language- extra-class"><pre><code> 								http://luocode.top/
</code></pre></div></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220505194123810.png" alt="image-20220505194123810"></p> <h2 id="java-编译和解释并存"><a href="#java-编译和解释并存" class="header-anchor">#</a> Java 编译和解释并存</h2> <ul><li>编译：一次性编译</li> <li>解释：一句一句解释</li> <li>Java：先编译后解释</li></ul> <h2 id="方法类型"><a href="#方法类型" class="header-anchor">#</a> 方法类型</h2> <ol><li>无返回值无参数</li> <li>无返回值有参数</li> <li>有返回值无参数</li> <li>有返回值有参数</li></ol> <h2 id="静态方法为什么不能调用非静态"><a href="#静态方法为什么不能调用非静态" class="header-anchor">#</a> 静态方法为什么不能调用非静态</h2> <blockquote><p>类加载时就创建静态，非静态需要等待实例化</p></blockquote> <h2 id="重载和重写"><a href="#重载和重写" class="header-anchor">#</a> 重载和重写</h2> <ul><li>重载：
<ul><li>概述：方法名相同，参数一定不同，其他可同可不同</li></ul></li> <li>重写：
<ul><li>概述：子类重写父类方法</li> <li>两同两小一大：
<ul><li>两同：方法名、参数</li> <li>两小：异常、返回值类型</li> <li>一大：访问修饰符</li></ul></li></ul></li></ul> <h2 id="可变参数"><a href="#可变参数" class="header-anchor">#</a> 可变参数</h2> <blockquote><p>String ... args</p> <p>底层：转为数组</p></blockquote> <h2 id="基本类型"><a href="#基本类型" class="header-anchor">#</a> 基本类型</h2> <p>byte short int long boolean char float double</p> <p>1         2      4      8       1           2       4       8</p> <h2 id="包装类型的常量池"><a href="#包装类型的常量池" class="header-anchor">#</a> 包装类型的常量池</h2> <ul><li>Byte，Short、Integer、Long：【-128，127】</li> <li>Character：【0，127】</li> <li>Float、Double：没有常量池</li> <li>建议：都有equals比较</li> <li>装箱和拆箱：Integer
<ul><li>Integer i=Integer.valueOf(10)</li> <li>i.intValue()</li></ul></li></ul> <h2 id="面向过程和面向对象"><a href="#面向过程和面向对象" class="header-anchor">#</a> 面向过程和面向对象</h2> <ul><li>过程：问题拆分成一个个方法</li> <li>对象：先抽象出对象，然后问题拆分成一个个方法</li></ul> <h2 id="成员变量和局部变量"><a href="#成员变量和局部变量" class="header-anchor">#</a> 成员变量和局部变量</h2> <table><thead><tr><th></th> <th>成员</th> <th>局部</th></tr></thead> <tbody><tr><td>语法</td> <td>类</td> <td>方法里，方法的参数</td></tr> <tr><td>存储</td> <td>实例，堆</td> <td>栈</td></tr> <tr><td>默认值</td> <td>有</td> <td>没有</td></tr> <tr><td>生存时间</td> <td>实例</td> <td>调用结束消失</td></tr></tbody></table> <h2 id="类的构造方法"><a href="#类的构造方法" class="header-anchor">#</a> 类的构造方法</h2> <blockquote><p>完成对象的初始化</p> <p>注意：不能被重写，但可以重载（多个名字一样，方法参数不同）</p></blockquote> <h2 id="面向对象三大特征"><a href="#面向对象三大特征" class="header-anchor">#</a> 面向对象三大特征</h2> <ul><li>封装：
<ul><li>空调
<ul><li>里面零件：属性</li> <li>空调遥控器：方法</li></ul></li></ul></li> <li>继承：
<ul><li>子类不能访问父类私有方法和属性</li></ul></li> <li>多态：
<ul><li>父类引用指向子类</li> <li>体现：继承、实现
<ul><li>类只能单继承，但接口可以继承多个接口</li> <li>实现多个接口</li></ul></li></ul></li></ul> <h2 id="接口和抽象类"><a href="#接口和抽象类" class="header-anchor">#</a> 接口和抽象类</h2> <ul><li>接口：
<ul><li>成员变量（public static final）不可变</li> <li>被实现</li></ul></li> <li>抽象类：
<ul><li>成员可变</li> <li>被继承</li></ul></li></ul> <h2 id="equals和hashcode"><a href="#equals和hashcode" class="header-anchor">#</a> equals和hashCode</h2> <blockquote><p>注意：String的equals（比较值）被底层重写过了，不是父类Object方法（比较内存地址）</p></blockquote> <p>先hashCode在equals：</p> <ul><li>作用：效率提高</li> <li>例：HashSet添加
<ul><li>hashCode判断值不同，直接判定两者不是同一个对象</li> <li>hashCode相同不一定是同对象</li> <li>同对象：hashCode相同、equals相等</li> <li>即：equals被重写，hashCode也需被重写</li></ul></li></ul> <h2 id="string、stringbuffer、stringbuilder"><a href="#string、stringbuffer、stringbuilder" class="header-anchor">#</a> String、StringBuffer、StringBuilder</h2> <ul><li><p>String：操作少量数据</p></li> <li><p><code>StringBuilder</code>（不安全）：单线程操作大量数据</p></li> <li><p><code>StringBuffer</code>（安全）：多线程操作大量数据</p></li> <li><p>父类：<code>AbstractStringBuilder</code></p></li> <li><p>注意：<code>String</code>是不可变的</p> <ul><li>例：String s1=&quot;hello&quot;，s1=&quot;java&quot;</li> <li>底层：s1=new String(&quot;java&quot;)</li> <li>原因：private final char value[];
<ul><li><code>私有</code>，没有对外提供访问方法</li> <li><code>final</code>：只是说char[]引用不可变，里面内容还是可变的</li></ul></li></ul></li> <li><p>new String(&quot;Java&quot;)</p> <ul><li><p>问题：常量池没有Java，会创建两个字符串对象</p> <p><img src="tu-pian/image-20220508174903682.png" alt="image-20220508174903682"></p></li></ul></li> <li><p>intern：常量池有直接返回，没有创建</p></li></ul> <h2 id="exception和error"><a href="#exception和error" class="header-anchor">#</a> Exception和Error</h2> <blockquote><p>父类是Throwable（类）</p></blockquote> <ul><li>Exception：
<ul><li>受检异常
<ul><li>描述：需要try-catch</li></ul></li> <li>非受检异常
<ul><li>数组越界</li> <li>空指针</li> <li>算术（除0）</li></ul></li></ul></li> <li>Error：运行时报错
<ul><li>栈内存溢出</li> <li>堆内存溢出</li></ul></li></ul> <h2 id="try-catch-finally"><a href="#try-catch-finally" class="header-anchor">#</a> try-catch-finally</h2> <ul><li>try里有返回值，finally不能有返回值</li> <li>原因：try的返回值会存到一个变量中，等finally执行完后在返回，此时finally返回值会把之前覆盖</li> <li>注意：finally不一定会执行，例：系统停止运行（线程死亡），断电</li> <li>区别：try-with-resource（有关闭资源需求的使用，可以自动关闭，不用close）</li></ul> <h2 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h2> <ul><li>泛型类</li> <li>泛型接口</li> <li>泛型方法：
<ul><li>问题(静态方法)：只能使用方法指定的类型，而该类上指定的泛型不可用</li> <li>原因：静态初始化比类的实例化早，所以不知道类的泛型类型是什么</li></ul></li> <li>案例：
<ul><li>ExcelUtil：Excel导出数据类型</li> <li>Collections：sort、binarySearch</li> <li>CommonResult：动态结果返回类型</li></ul></li></ul> <h2 id="反射"><a href="#反射" class="header-anchor">#</a> 反射</h2> <ul><li><p>优点：运行分析类，为框架提供开箱即用，因为可以获取类的所有属性和方法</p></li> <li><p>缺点：跳过了泛型安全检查（编译）</p></li> <li><p>案例：</p> <ul><li>动态代理，<code>method.invoke</code></li> <li>springboot的注解，<code>@Component</code>生成Bean、<code>@Value</code>属性获取值</li></ul></li></ul> <h2 id="序列化和反序列化"><a href="#序列化和反序列化" class="header-anchor">#</a> 序列化和反序列化</h2> <ul><li><p>序列化：将对象<code>object</code>转字节<code>class</code></p></li> <li><p>反序列化：字节<code>class</code>转<code>object</code></p></li> <li><p>作用：序列化后字节方便存储到数据库、网络发送、文件等，其他计算机就把复杂对象恢复（反序列化）</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/image-20220515113701196.png" alt="image-20220515113701196"></p></li> <li><p>注意：只有变量可以控制不被序列化，加<code>transient</code>关键字</p></li></ul> <h2 id="io流"><a href="#io流" class="header-anchor">#</a> IO流</h2> <p>✔️划分：</p> <ul><li>流：输入流和输出流</li> <li>操作结构：字节流和字符流</li> <li>流的角色：节点流和处理流</li> <li>注意：
<ul><li>节点流：和数据源打交道，例<code>FileReader</code></li> <li>处理流：封装节点流，有缓存作用，构造方法需要一个流对象，例<code>BufferReader</code></li></ul></li></ul> <h2 id="集合"><a href="#集合" class="header-anchor">#</a> 集合</h2> <ul><li>两大接口：
<ul><li><code>Collection</code> <ul><li><strong>List</strong>：有序可重复
<ul><li>ArrayList：数组</li> <li>Vector：数组</li> <li>LinkedList：双向链表</li></ul></li> <li><strong>Set</strong>：无序不可重复
<ul><li>HashSet：HashMap</li> <li>LinkedHashSet：HashSet</li> <li>TreeSet：红黑树</li></ul></li> <li><strong>Queue</strong>：有序可重复
<ul><li>PriorityQueue：数组</li></ul></li></ul></li> <li><code>Map</code> <ul><li><strong>HashMap</strong>：
<ul><li>键(唯一性)：无序不可重复</li> <li>值：无序可重复</li> <li>数组+链表/红黑树，拉链法（即相同位置变成链表）</li></ul></li> <li><strong>LinkedHashMap</strong>：
<ul><li>数组+链表/红黑树</li> <li>多了双向链表</li></ul></li> <li><strong>HashTable</strong>：数组+链表</li> <li><strong>TreeMap</strong>：红黑树</li></ul></li></ul></li></ul> <h2 id="list"><a href="#list" class="header-anchor">#</a> List</h2> <ul><li>ArrayList和Vector：两者都是数组，前者不安全，后者安全但古老</li> <li>注意：ArrayList随机访问并不是因为实现了<code>RandomAccess</code>（标识），是因为数组具有天然的随机访问能力</li></ul> <table><thead><tr><th></th> <th>ArrayList</th> <th>LinkedList</th></tr></thead> <tbody><tr><td>结构</td> <td>数组</td> <td>双向链表</td></tr> <tr><td>随机访问</td> <td>能</td> <td>不能</td></tr> <tr><td>安全</td> <td>不安全</td> <td>不安全</td></tr> <tr><td>内存</td> <td>末尾预留一定空间</td> <td>前驱后继+数据</td></tr></tbody></table> <h2 id="comparable和comparator"><a href="#comparable和comparator" class="header-anchor">#</a> Comparable和Comparator</h2> <ul><li><code>Comparable</code>：
<ul><li>java.lang</li> <li>compareto（一个参数）</li></ul></li> <li><code>Comparator</code>：
<ul><li>java.util</li> <li>compare（两个参数）</li></ul></li></ul> <h2 id="无序性和不可重复性"><a href="#无序性和不可重复性" class="header-anchor">#</a> 无序性和不可重复性</h2> <ul><li>无序性：数据在底层存储不是按照<code>索引</code>，而是<code>按照hash值</code></li> <li>不可重复性：equals比较，必须重写<code>hashCode</code>和<code>equals</code></li></ul> <h2 id="queue和deque"><a href="#queue和deque" class="header-anchor">#</a> Queue和Deque</h2> <ul><li>Queue：
<ul><li>单端队列：一端删除，一端插入</li></ul></li> <li>Deque：
<ul><li>双端队列：两边可以插入和删除</li></ul></li></ul> <h2 id="hashmap和hashtable"><a href="#hashmap和hashtable" class="header-anchor">#</a> HashMap和HashTable</h2> <table><thead><tr><th></th> <th>HashMap</th> <th>HashTable</th></tr></thead> <tbody><tr><td>安全</td> <td>不安全</td> <td>安全</td></tr> <tr><td>key和value</td> <td>可以为null</td> <td>不可以为null</td></tr> <tr><td>扩容</td> <td>初始16，2n</td> <td>初始11，2n+1</td></tr> <tr><td>底层数据结构</td> <td>数组+链表/红黑树</td> <td>数组+链表</td></tr></tbody></table> <p>HashMap和TreeMap：TreeMap比HashMap多了搜索和排序</p> <h2 id="hashset去重"><a href="#hashset去重" class="header-anchor">#</a> HashSet去重</h2> <blockquote><p>先计算对象的hashCode值，值一样，使用equals判断</p> <p>注意（对象）：需要重写hashCode和equals</p></blockquote> <h2 id="hashmap-2"><a href="#hashmap-2" class="header-anchor">#</a> HashMap</h2> <ul><li>扰动函数：得到hash值，之后通过(n-1)&amp;hash获取位置</li> <li>1.7JDK：扰动四次</li> <li>1.8JDK：扰动一次</li> <li>为什么HashMap长度是2的幂次方：n-1保证全是1
<ul><li>(n-1)&amp;hash</li> <li>4-1=3          11</li> <li>16-1=15           1111</li> <li>n&amp;hash==(n-1)&amp;hash，&amp;效率高</li></ul></li></ul> <h2 id="concurrenthashmap和hashtable"><a href="#concurrenthashmap和hashtable" class="header-anchor">#</a> ConcurrentHashMap和HashTable</h2> <ul><li>segment：继承了ReentrantLock，访问数组元素HashEntry，必须获得segment的可重入锁</li></ul> <table><thead><tr><th></th> <th>ConcurrentHashMap</th> <th>HashTable</th></tr></thead> <tbody><tr><td>结构</td> <td>1.7segment数组+链表/红黑树        1.8Node+链表/红黑树</td> <td>数组+链表</td></tr> <tr><td>锁</td> <td>每个segment一个锁，互不影响    CAS和synchronized</td> <td>全局锁，锁住其他就不可使用，效率低</td></tr></tbody></table> <h2 id="集合和数组"><a href="#集合和数组" class="header-anchor">#</a> 集合和数组</h2> <ul><li>集合转数组：<code>toArray</code>(new String(0))，其中String(0)起指定类型作用</li> <li>数组转集合：<code>asList</code></li></ul> <h2 id="进程和线程"><a href="#进程和线程" class="header-anchor">#</a> 进程和线程</h2> <ul><li><code>进程</code>：系统运行程序的基本单位，JVM进程，main是线程，exe文件运行是进程</li> <li><code>线程</code>：多个线程互相影响，互相调用
<ul><li>共享：<code>堆、方法区</code> <ul><li>堆：存放对象</li> <li>方法区：静态变量</li></ul></li> <li><code>私有</code>：程序计数器、本地方法栈、虚拟栈
<ul><li>程序计数器：多线程下记录切换的位置</li> <li>本地方法栈、虚拟栈：存局部变量，防止局部变量共享</li></ul></li></ul></li></ul> <h2 id="并发和并行"><a href="#并发和并行" class="header-anchor">#</a> 并发和并行</h2> <ul><li>并发：同一时间点，不可能同时运行，并发只是有多个线程运行</li> <li>并行：同一时间点，同时运行</li></ul> <h2 id="为什么使用多线程"><a href="#为什么使用多线程" class="header-anchor">#</a> 为什么使用多线程</h2> <blockquote><p>多线程效率高，成本比进程低</p> <p>如今并发量高，多核下的多线程提高并发性能</p></blockquote> <h2 id="线程的生命周期"><a href="#线程的生命周期" class="header-anchor">#</a> 线程的生命周期</h2> <ol><li>new：创建，未调用start()</li> <li>Runable：可运行</li> <li>Blocked：阻塞，<code>等待锁</code></li> <li>Waiting：等待，需要其他线程唤醒</li> <li>Time_Waiting：有一定时间等待，超过时间自动醒</li> <li>Terminal：停止运行</li></ol> <h2 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h2> <p>🔨产生条件：</p> <ul><li>互斥：资源只能被一个线程获得</li> <li>请求与保持：请求其他资源得不到响应，没有释放自己有的资源</li> <li>不剥夺：其他线程不抢夺阻塞的线程资源</li> <li>循环等待：形成一个头尾相连</li></ul> <h2 id="为什么不能直接调用run-而是调用start"><a href="#为什么不能直接调用run-而是调用start" class="header-anchor">#</a> 为什么不能直接调用run()，而是调用start()</h2> <blockquote><p>注意：调用完start，无需调用run</p></blockquote> <ul><li>直接调用run，被当做当前线程的方法调用，<code>不会启动新线程</code></li> <li>start：会<code>创建新线程</code></li></ul> <h2 id="synchronized"><a href="#synchronized" class="header-anchor">#</a> synchronized</h2> <ul><li>添加：
<ul><li>实例方法（对象）</li> <li>静态方法（类）</li> <li>代码块（类）</li></ul></li> <li>synchronized和reentrantlock：
<ul><li>相同：
<ul><li>可重入锁，即获取锁后可以继续获取该锁，计数器+1，计数器=0才释放锁</li></ul></li> <li>不同：
<ul><li><code>reentrantlock</code>可以公平，也可以非公平（不按顺序获取锁），<code>JDK</code></li> <li><code>synchronized</code>非公平，<code>JVM</code></li></ul></li></ul></li> <li>synchronized和volatile：
<ul><li>互补</li> <li>volatile：注重多线程<code>可见</code>，只能修饰变量</li> <li>synchronized：注重多线程资源<code>同步性</code>，变量、方法、代码块</li></ul></li></ul> <h2 id="volatile-2"><a href="#volatile-2" class="header-anchor">#</a> volatile</h2> <blockquote><p>保证可见性、有序性，不能保证原子性</p> <p>并发编程三大特性：原子、可见、有序</p></blockquote> <h2 id="juc"><a href="#juc" class="header-anchor">#</a> JUC</h2> <blockquote><p>java.util.concurrent：简称JUC，只是一个包，下面有很多类</p></blockquote> <p>🔨Atomic：原子类</p> <ul><li>基本类型：
<ul><li>Atomic<code>Integer</code> <ul><li>get</li> <li>getAndSet</li> <li>getAndIncrement</li> <li><code>CAS+native</code>保证原子性</li></ul></li> <li>Atomic<code>Long</code></li> <li>Atomic<code>Boolean</code></li></ul></li> <li>数组：
<ul><li>Atomic<code>Integer</code>Array</li> <li>Atomic<code>Long</code>Array</li> <li>Atomic<code>Reference</code>Array</li></ul></li> <li>引用：
<ul><li>AtomicReference</li> <li>Atomic<code>Stamped</code>Reference：带有版本号</li> <li>Atomic<code>Markable</code>Referenc：标记</li></ul></li> <li>引用的字段修改：
<ul><li>Atomic<code>Integer</code>FieldUpdater</li> <li>Atomic<code>Long</code>FieldUpdater</li> <li>Atomic<code>Reference</code>FieldUpdater</li></ul></li></ul> <h2 id="aqs"><a href="#aqs" class="header-anchor">#</a> AQS</h2> <blockquote><p><code>AbstractQueuedSynchronizer</code>，抽象队列同步器</p></blockquote> <p>🔨原理：</p> <ul><li>请求资源空闲，占用后锁定，否则到<code>CLH</code>队列等待（无需维护前驱后继，只需局部变量知道前节点）</li> <li>共享方式：
<ul><li>独占：公平锁或非公平锁，<code>ReentrantLock</code></li> <li>共享：share，<code>Semaphore</code>（信号量）、<code>CountDowLatch</code>（倒计时器）、<code>CyclicBarrier</code>（循环屏障）</li> <li>特例：组合，<code>ReentrantReadWriteLock</code></li></ul></li> <li>模板方法：
<ul><li>自定义同步器：只需继承<code>AbstractQueuedSynchronizer</code>，重写方法（钩子）</li> <li>主要方法：state（<code>get</code>、<code>set</code>），<code>CLH</code>队列无需自己实现（已实现）</li></ul></li></ul> <h2 id="对象的创建"><a href="#对象的创建" class="header-anchor">#</a> 对象的创建</h2> <ol><li>类加载检查
<ul><li>检查类是否加载过</li></ul></li> <li>分配内存
<ul><li>标记-清除（<code>空闲列表</code>，分配一个大内存）</li> <li>标记-整理（<code>指针碰撞</code>，用过的放一边，没用过的放一边）</li></ul></li> <li>设置零值（即默认值）</li> <li>设置对象头（哈希码、GC分代年龄）</li> <li>初始化
<ul><li>init（构造方法）</li></ul></li></ol> <p>🔨对象的访问：</p> <ul><li><code>句柄</code>：
<ul><li>实例对象地址</li> <li>具体数据地址（方法区）</li></ul></li> <li><code>直接指针</code>：
<ul><li>栈中的引用访问堆中实例对象</li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220528203601304.png" alt="image-20220528203601304"></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220528203616182.png" alt="image-20220528203616182"></p> <h2 id="空间分配担保"><a href="#空间分配担保" class="header-anchor">#</a> 空间分配担保</h2> <blockquote><p>确保minor GC之前老年代有足够的空间存新生代晋升老年代</p></blockquote> <ul><li><p>JDK6之前：</p> <ul><li><p>先判断是否大于所有新生代</p></li> <li><p><code>HandlerPromotionFailure</code></p></li> <li><p>判断是否大于每次晋升到老年代的平均值</p></li></ul></li> <li><p>JDK6之后：</p> <ul><li>判断是否大于每次晋升到老年代的平均值
<ul><li>是：<code>MinorGC</code></li> <li>否：<code>Full GC</code></li></ul></li></ul></li></ul> <h2 id="四种引用-2"><a href="#四种引用-2" class="header-anchor">#</a> 四种引用</h2> <blockquote><p>判断对象存活：</p> <ul><li><p>可达性分析法：沿着GC Root（引用链）往下找</p></li> <li><p>引用计数法：被使用+1，等于0时可回收</p></li> <li><p>三色标记法：白色未标记可回收</p></li></ul> <p>注意：都和引用有关系</p></blockquote> <p>强软弱虚：</p> <ul><li>软(常用)：第一次不被回收，第二次回收</li> <li>弱：第一次回收</li> <li>虚：必须配合引用队列，软弱可配可不配</li></ul> <h2 id="cms和g1"><a href="#cms和g1" class="header-anchor">#</a> CMS和G1</h2> <ul><li>相同：最短回收停顿</li> <li>不同：
<ul><li>CMS：
<ul><li>初始标记</li> <li>并发标记</li> <li>重新标记</li> <li>清除</li></ul></li> <li>G1：
<ul><li>初始标记</li> <li>并发标记</li> <li>最终标记</li> <li>回收</li></ul></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220529181957136.png" alt="image-20220529181957136"></p> <h2 id="事务acid"><a href="#事务acid" class="header-anchor">#</a> 事务ACID</h2> <blockquote><p>MySQL引擎InnoDB实现事务ACID</p></blockquote> <ul><li>原子性(atomic)
<ul><li>全部成功，全部失败</li> <li>实现：undo log（回滚）</li></ul></li> <li>一致性(consistency)
<ul><li>数据一致</li> <li>实现：保证AID之后</li></ul></li> <li>隔离性(Isolation)
<ul><li>互不影响</li> <li>实现：锁，MVCC（multi version concurrent control）</li></ul></li> <li>持久性(duration)
<ul><li>数据永久存在</li> <li>实现：redo log（重做日志）</li></ul></li></ul> <h2 id="并发事务问题"><a href="#并发事务问题" class="header-anchor">#</a> 并发事务问题</h2> <ul><li>脏读：<code>一个事务修改数据</code>，还没提交到数据库，<code>另一个事务读取数据</code>，还是原来数据（脏数据），没有拿到最新数据，依据原数据操作可能不正确</li> <li>丢失修改：<code>多个事务修改数据</code>，因为每个最初拿到都是原始相同数据，导致最后修改数据的把之前修改数据的覆盖，之前所有事务修改丢失，<code>以最后修改为准</code></li> <li>不可重复读：第一个事务读取数据，另一个并发事务修改数据，导致第一个事务再次读取时，发现数据不相同</li> <li>幻读：一个事务读取数据，另一个并发事务添加或删除数据，导致第一个事务再次读取时，发现多了不存在或少了数据，想幻觉一样</li> <li><strong>注意</strong>：幻读和不可重复读主要区别在于<code>并发事务操作时</code>，幻读是<code>添加或删除</code>数据，不可重复读是<code>修改</code></li></ul> <h2 id="事务隔离级别"><a href="#事务隔离级别" class="header-anchor">#</a> 事务隔离级别</h2> <table><thead><tr><th></th> <th>脏读</th> <th>不可重复读</th> <th>幻读</th></tr></thead> <tbody><tr><td>read-uncommitted（读未提交）</td> <td>有</td> <td>有</td> <td>有</td></tr> <tr><td>read-committed（读已提交）</td> <td>无</td> <td>有</td> <td>有</td></tr> <tr><td>repeatable-read（重复读）</td> <td>无</td> <td>无</td> <td>有</td></tr> <tr><td>serializable（可串行，可序列化）</td> <td>无</td> <td>无</td> <td>无</td></tr></tbody></table> <h2 id="innodb"><a href="#innodb" class="header-anchor">#</a> InnoDB</h2> <blockquote><p>MySQL的引擎</p></blockquote> <p>优点：</p> <ul><li>行级锁（<code>row-level locking</code>）</li> <li>支持事务（回滚、提交）</li> <li>事务隔离级别：重复读</li> <li>ACID
<ul><li>原子
<ul><li><code>undo log</code>（回滚）</li></ul></li> <li>一致</li> <li>隔离
<ul><li>锁和MVCC</li></ul></li> <li>持久
<ul><li><code>redo log</code>（重做）</li></ul></li></ul></li> <li><code>MVCC</code></li></ul> <h2 id="spring重要模块"><a href="#spring重要模块" class="header-anchor">#</a> Spring重要模块</h2> <ul><li><code>core</code>：为IOC（<code>inverse of control</code>），控制反转、依赖注入</li> <li><code>aop</code>：切面，基于动态代理实现，运行时增强</li> <li><code>aspectj</code>：完整的aop，aop已集成，基于字节码实现，编译时增强</li> <li><code>web</code></li> <li><code>data access/Integration</code></li></ul> <h2 id="aop和ioc"><a href="#aop和ioc" class="header-anchor">#</a> AOP和IOC</h2> <ul><li>IOC：
<ul><li>控制反转、依赖注入</li> <li>主要是把创建对象交给IOC容器实现</li> <li>容器：<code>Map</code></li> <li>作用：复杂依赖关系解放出来，无需关注构造方法</li></ul></li> <li>AOP：
<ul><li>面向切面编程</li> <li>封装一些和业务无关代码，但有经常使用到（日志、权限、事务）</li> <li>作用：减少代码，降低耦合度，未来可维护、可拓展</li></ul></li></ul> <h2 id="springmvc"><a href="#springmvc" class="header-anchor">#</a> SpringMVC</h2> <ul><li>M：model，模型，实体类entity</li> <li>V：view：视图，HTML</li> <li>C：controller/service 控制器</li></ul> <p>🔨工作原理：</p> <ol><li><p>请求到<code>dispatcherServlet</code></p></li> <li><p>找处理器<code>HandlerMapping</code></p></li> <li><p>适配器<code>HandlerAdapter</code></p></li> <li><p>适配器调用处理器（执行业务）</p></li> <li><p><code>ModelAndView</code></p> <ul><li><p><code>Model</code>：数据</p></li> <li><p><code>View</code>：逻辑View</p></li></ul></li> <li><p>真正View：<code>ViewResolver</code></p></li> <li><p>Model传给View（渲染）</p></li> <li><p>返回View给用户</p></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220604160150436.png" alt="image-20220604160150436"></p> <h2 id="类声明为bean"><a href="#类声明为bean" class="header-anchor">#</a> 类声明为Bean</h2> <blockquote><p>bean是IOC管理的对象，类声明为bean，下次就可以自动注入该类实例，不用new</p></blockquote> <ul><li><code>@Component</code>：不确定bean是那一层</li> <li><code>@Repository</code>：Dao</li> <li><code>@Service</code>：业务，调用Dao</li> <li><code>@Controller</code>：控制层，接收请求，调用service，返回数据给前端页面</li></ul> <h2 id="component和-bean"><a href="#component和-bean" class="header-anchor">#</a> @Component和@Bean</h2> <table><thead><tr><th></th> <th>Component</th> <th>Bean</th></tr></thead> <tbody><tr><td>范围</td> <td>类</td> <td>方法</td></tr> <tr><td>使用</td> <td>少</td> <td>多，例依赖注入第三方类库</td></tr></tbody></table> <h2 id="注入bean"><a href="#注入bean" class="header-anchor">#</a> 注入Bean</h2> <blockquote><p>类型：即实现类</p> <p>名字：首字母小写，根据类名找类</p></blockquote> <ul><li><code>@Autowire</code>：
<ul><li>先类型在名字</li> <li><code>spring</code>注解</li> <li>成员变量名不一致，使用<code>@Qualifier</code></li></ul></li> <li><code>@Resource</code>：
<ul><li>先名字在类型</li> <li><code>JDK</code>注解</li> <li>成员变量名不一致，使用<code>name</code>属性</li></ul></li> <li><code>@Inject</code>（少）：注入</li></ul> <h2 id="bean作用域"><a href="#bean作用域" class="header-anchor">#</a> Bean作用域</h2> <blockquote><p>使用：<code>@Bean</code>注解下多添加一个注解<code>@Scope（&quot;singleton&quot;）</code></p></blockquote> <ul><li><code>singleton</code>：单例
<ul><li>问题：单例多线程下存在安全问题</li> <li>解决：
<ul><li>创建ThreadLocal</li> <li>底层：ThreadLocalMap</li> <li>实现：每次线程访问自己资源，线程内资源共享</li></ul></li></ul></li> <li><code>prototype</code>：每次请求创建新的</li> <li><code>request</code>：http请求创建新的</li> <li><code>session</code>：一个session创建新的</li></ul> <h2 id="bean的生命周期"><a href="#bean的生命周期" class="header-anchor">#</a> Bean的生命周期</h2> <ul><li>实例化bean</li> <li>设置属性</li> <li>检查aware接口</li> <li>前置处理（后处理器）</li> <li>检查是否有初始化方法</li> <li>后置处理</li> <li>销毁（自定义方法还是实现接口）</li></ul> <h2 id="spring设计模式"><a href="#spring设计模式" class="header-anchor">#</a> Spring设计模式</h2> <ul><li><p>单例：Bean</p></li> <li><p>工厂：BeanFactory（延迟注入，只注入基本的）、ApplicationContext（全部注入，常用）</p></li> <li><p>代理：AOP，JDK动态代理</p></li> <li><p>模板：jdbcTemplate</p></li> <li><p>观察者：我变你也变</p> <ul><li><p>事件角色：</p> <ul><li><code>ApplicationEvent</code></li></ul></li> <li><p>监听者：</p> <ul><li><code>ApplicationListener</code>：方法<code>onApplicationEvent()</code></li></ul></li> <li><p>发布者：</p> <ul><li><code>ApplicationEventPublisher</code>：方法<code>publisherEvent()</code></li></ul></li></ul></li> <li><p>适配器：包装器，把接口转换成客户想要的接口</p> <ul><li><p>SpringAOP</p> <ul><li>拦截器适配通知</li> <li>例：<code>MethodBeforeAdviceIntercept</code>-&gt;<code>MethodBeforeAdvice</code></li></ul></li> <li><p>SpringMVC</p> <ul><li><code>HandlerAdapter</code>适配<code>Handler</code>（请求）</li></ul></li></ul></li> <li><p>装饰者：spring的wrapper和decorator</p></li></ul> <h2 id="spring事务传播行为"><a href="#spring事务传播行为" class="header-anchor">#</a> Spring事务传播行为</h2> <p>🔨事务传播行为：解决事务之间调用问题</p> <ul><li>TransactionalDefinition.propagation_<code>required</code>：没有则创建新的，有则继续使用</li> <li>……_<code>required-new</code>：不管有没有，有就挂起，创建新的</li> <li>……_<code>nested</code>：嵌套</li> <li>……_<code>mandatory</code>：强制性，没有则报错，抛异常</li></ul> <p>🔨<code>@Transactional</code>：</p> <ul><li>方法或类上添加，则说明开启事务</li> <li>注意：<code>@Transactional（rollbackFor=Exception.class）</code> <ul><li>保证运行时或非运行时异常都能回滚</li> <li>不加默认运行时</li></ul></li></ul> <h2 id="springbootapplication"><a href="#springbootapplication" class="header-anchor">#</a> @SpringBootApplication</h2> <blockquote><p><code>Springboot</code>项目启动类添加<code>@SpringBootApplication</code>和<code>@MapperScan</code>(扫描mapper包下)</p></blockquote> <p>🔨@SpringBootApplication</p> <ul><li><code>@ComponentScan</code>：扫描<code>@Service</code>、<code>@Controller</code>，默认扫描该类所在包的所有类（即为什么启动类要放到外面和）</li> <li><code>@EnableConfiguration</code>：自动配置</li> <li><code>@SpringBootConfiguration</code>：下面有<code>@Configuration</code>，即为什么启动类可以声明其他很多bean</li></ul> <h2 id="常见http请求"><a href="#常见http请求" class="header-anchor">#</a> 常见HTTP请求</h2> <ul><li>get：查询</li> <li>post：添加</li> <li>put：更新</li> <li>delete：删除</li></ul> <h2 id="前后端传值"><a href="#前后端传值" class="header-anchor">#</a> 前后端传值</h2> <ul><li><code>@PathVariable</code>：路径上的参数
<ul><li>例：<code>/user/{userId}</code></li> <li>方法参数<code>（@PathVariable(&quot;userId&quot;) Integer userId）</code></li></ul></li> <li><code>@RequestParam</code>：请求参数
<ul><li>例：？type=zhangsan</li> <li>方法参数<code>（@RequestParam(value=&quot;type&quot;,required=false) String type）</code></li></ul></li> <li><code>@RequestBody</code>：body里传入JSON数据，相当于客户端把数据传给服务端，后台需要实体类和JSON对应
<ul><li>方法参数<code>（@RequestBody Book book）</code></li></ul></li></ul> <h2 id="事务属性"><a href="#事务属性" class="header-anchor">#</a> 事务属性</h2> <blockquote><p>@Transactional（）：括号里配置如下属性</p> <p>注意：谈到AOP，无非是JDK动态代理，或子类的cglib，transactional工作机制也是AOP实现，<code>TransactionInterceptor</code>.invoke()</p></blockquote> <ul><li>传播行为：required</li> <li>隔离级别：重复读</li> <li>回滚：运行时异常和非运行时异常</li> <li>超时</li> <li>只读</li></ul> <h2 id="transactional注意事项"><a href="#transactional注意事项" class="header-anchor">#</a> @Transactional注意事项</h2> <ul><li>必须public修饰的方法</li> <li>数据库支持事务</li> <li>同一类中不能调用</li> <li>注意回滚默认只支持运行时异常回滚</li> <li>@Transactional需由spring管理，即需要配置@Controller、@Service类似的类</li></ul> <h2 id="springboot自动装配"><a href="#springboot自动装配" class="header-anchor">#</a> SpringBoot自动装配</h2> <ul><li><p>概念：扫描<code>meta-inf</code>（元信息）下的<code>spring.factories</code>加载到容器</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220606180429005.png" alt="image-20220606180429005"></p></li> <li><p>实现：</p> <ul><li><p><code>@SpringBootApplication</code>：</p> <ul><li><p><code>@ComponentScan</code>（扫描<code>@Service</code>、<code>@Controller</code>）</p></li> <li><p><code>@EnableAutoConfiguration</code>（核心）：自动配置</p> <ul><li><p><code>AutoConfigurationImportSelector</code></p></li> <li><p><code>ImportSelector</code>接口中方法<code>selectImports</code></p></li> <li><p>selectImports下的<code>getAutoConfigurationEntry</code></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220606181157504.png" alt="image-20220606181157504"></p></li> <li><p>排除：@ConditionalOnXXX</p> <ul><li>@ConditionalOnBean</li> <li>@ConditionalOnClass</li></ul></li></ul></li> <li><p><code>@SpringBootConfiguration</code>：<code>@Configuration</code>，实现上下文注册<code>Bean</code></p></li></ul></li></ul></li> <li><p>总结：</p> <ul><li><code>@EnableAutoConfiguration</code>开启自动装配，<code>SpringFactoriesLoader</code>加载<code>meta-inf</code>，根据<code>@Conditional</code>加载类</li></ul></li></ul> <h1 id="铁令"><a href="#铁令" class="header-anchor">#</a> 铁令</h1> <p>字符串+=：</p> <ul><li>直接相加底层还是<code>StringBuilder</code>的<code>append</code>()</li> <li>尽量使用StringBuilder中的append方法</li> <li>使用String直接相加（for循环内），底层还是new StringBuilder，结果有大量StringBuilder</li></ul> <p>看见排好序的数组找元素：</p> <ul><li>二分法，左右指针</li></ul> <p>数组不存储null</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img2/image-20220529210436501.png" alt="image-20220529210436501"></p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/learn-vuepress/computer/os.html" class="prev">
            操作系统
          </a></span> <span class="next"><a href="/learn-vuepress/interview/Java基础面试题.html">
            Java基础面试题
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#二分查找" class="sidebar-link reco-side-二分查找" data-v-cb1513f6>二分查找</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#冒泡排序-找最大到末尾" class="sidebar-link reco-side-冒泡排序-找最大到末尾" data-v-cb1513f6>冒泡排序（找最大到末尾）</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#选择排序-找最小放开头" class="sidebar-link reco-side-选择排序-找最小放开头" data-v-cb1513f6>选择排序（找最小放开头）</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#插入排序-边放最小到开头边插入" class="sidebar-link reco-side-插入排序-边放最小到开头边插入" data-v-cb1513f6>插入排序（边放最小到开头边插入）</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#希尔排序-间隔分后插入排序" class="sidebar-link reco-side-希尔排序-间隔分后插入排序" data-v-cb1513f6>希尔排序(间隔分后插入排序)</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#快速排序" class="sidebar-link reco-side-快速排序" data-v-cb1513f6>快速排序</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#单边循环快排" class="sidebar-link reco-side-单边循环快排" data-v-cb1513f6>单边循环快排</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#双边循环快排" class="sidebar-link reco-side-双边循环快排" data-v-cb1513f6>双边循环快排</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#arraylist" class="sidebar-link reco-side-arraylist" data-v-cb1513f6>ArrayList</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#iterator" class="sidebar-link reco-side-iterator" data-v-cb1513f6>Iterator</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#linkedlist" class="sidebar-link reco-side-linkedlist" data-v-cb1513f6>LinkedList</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#hashmap" class="sidebar-link reco-side-hashmap" data-v-cb1513f6>HashMap</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#数据结构" class="sidebar-link reco-side-数据结构" data-v-cb1513f6>数据结构</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#树化和退化" class="sidebar-link reco-side-树化和退化" data-v-cb1513f6>树化和退化</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#索引计算" class="sidebar-link reco-side-索引计算" data-v-cb1513f6>索引计算</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#put与扩容" class="sidebar-link reco-side-put与扩容" data-v-cb1513f6>put与扩容</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#并发问题" class="sidebar-link reco-side-并发问题" data-v-cb1513f6>并发问题</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#key设计" class="sidebar-link reco-side-key设计" data-v-cb1513f6>key设计</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#单例模式" class="sidebar-link reco-side-单例模式" data-v-cb1513f6>单例模式</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#饿汉式-runtime" class="sidebar-link reco-side-饿汉式-runtime" data-v-cb1513f6>饿汉式（Runtime）</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#枚举饿汉式-naturalordercomparator" class="sidebar-link reco-side-枚举饿汉式-naturalordercomparator" data-v-cb1513f6>枚举饿汉式（NaturalOrderComparator）</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#懒汉式" class="sidebar-link reco-side-懒汉式" data-v-cb1513f6>懒汉式</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#双检锁懒汉式-console" class="sidebar-link reco-side-双检锁懒汉式-console" data-v-cb1513f6>双检锁懒汉式（Console）</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#内部类懒汉式-集合" class="sidebar-link reco-side-内部类懒汉式-集合" data-v-cb1513f6>内部类懒汉式（集合）</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jdk中的单例" class="sidebar-link reco-side-jdk中的单例" data-v-cb1513f6>JDK中的单例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#线程状态" class="sidebar-link reco-side-线程状态" data-v-cb1513f6>线程状态</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#线程池" class="sidebar-link reco-side-线程池" data-v-cb1513f6>线程池</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#wait和sleep" class="sidebar-link reco-side-wait和sleep" data-v-cb1513f6>wait和sleep</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#lock和synchronized" class="sidebar-link reco-side-lock和synchronized" data-v-cb1513f6>lock和synchronized</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#volatile" class="sidebar-link reco-side-volatile" data-v-cb1513f6>volatile</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#悲观锁和乐观锁" class="sidebar-link reco-side-悲观锁和乐观锁" data-v-cb1513f6>悲观锁和乐观锁</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#hashtable和concurrenthashmap" class="sidebar-link reco-side-hashtable和concurrenthashmap" data-v-cb1513f6>Hashtable和ConcurrentHashMap</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#threadlocal" class="sidebar-link reco-side-threadlocal" data-v-cb1513f6>ThreadLocal</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jvm内存结构" class="sidebar-link reco-side-jvm内存结构" data-v-cb1513f6>JVM内存结构</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jvm内存参数" class="sidebar-link reco-side-jvm内存参数" data-v-cb1513f6>JVM内存参数</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jvm垃圾回收" class="sidebar-link reco-side-jvm垃圾回收" data-v-cb1513f6>JVM垃圾回收</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#内存溢出" class="sidebar-link reco-side-内存溢出" data-v-cb1513f6>内存溢出</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#类加载" class="sidebar-link reco-side-类加载" data-v-cb1513f6>类加载</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#四种引用" class="sidebar-link reco-side-四种引用" data-v-cb1513f6>四种引用</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#finalize" class="sidebar-link reco-side-finalize" data-v-cb1513f6>finalize</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring-refresh-概述" class="sidebar-link reco-side-spring-refresh-概述" data-v-cb1513f6>spring refresh 概述</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring-bean生命周期" class="sidebar-link reco-side-spring-bean生命周期" data-v-cb1513f6>spring bean生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring事务失效" class="sidebar-link reco-side-spring事务失效" data-v-cb1513f6>spring事务失效</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring-mvc执行流程" class="sidebar-link reco-side-spring-mvc执行流程" data-v-cb1513f6>spring mvc执行流程</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring注解" class="sidebar-link reco-side-spring注解" data-v-cb1513f6>spring注解</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#springboot-自动配置原理" class="sidebar-link reco-side-springboot-自动配置原理" data-v-cb1513f6>springboot 自动配置原理</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring的设计模式" class="sidebar-link reco-side-spring的设计模式" data-v-cb1513f6>spring的设计模式</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring-bean-循环依赖" class="sidebar-link reco-side-spring-bean-循环依赖" data-v-cb1513f6>spring bean 循环依赖</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#解决set循环依赖的原理" class="sidebar-link reco-side-解决set循环依赖的原理" data-v-cb1513f6>解决set循环依赖的原理</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#三级缓存不能解决的问题" class="sidebar-link reco-side-三级缓存不能解决的问题" data-v-cb1513f6>三级缓存不能解决的问题</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#总结" class="sidebar-link reco-side-总结" data-v-cb1513f6>总结</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#java特点" class="sidebar-link reco-side-java特点" data-v-cb1513f6>Java特点</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jvm、jre、jdk" class="sidebar-link reco-side-jvm、jre、jdk" data-v-cb1513f6>JVM、JRE、JDK</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#内部类" class="sidebar-link reco-side-内部类" data-v-cb1513f6>内部类</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#jdbc连接数据库" class="sidebar-link reco-side-jdbc连接数据库" data-v-cb1513f6>jdbc连接数据库</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#java-编译和解释并存" class="sidebar-link reco-side-java-编译和解释并存" data-v-cb1513f6>Java 编译和解释并存</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#方法类型" class="sidebar-link reco-side-方法类型" data-v-cb1513f6>方法类型</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#静态方法为什么不能调用非静态" class="sidebar-link reco-side-静态方法为什么不能调用非静态" data-v-cb1513f6>静态方法为什么不能调用非静态</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#重载和重写" class="sidebar-link reco-side-重载和重写" data-v-cb1513f6>重载和重写</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#可变参数" class="sidebar-link reco-side-可变参数" data-v-cb1513f6>可变参数</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#基本类型" class="sidebar-link reco-side-基本类型" data-v-cb1513f6>基本类型</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#包装类型的常量池" class="sidebar-link reco-side-包装类型的常量池" data-v-cb1513f6>包装类型的常量池</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#面向过程和面向对象" class="sidebar-link reco-side-面向过程和面向对象" data-v-cb1513f6>面向过程和面向对象</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#成员变量和局部变量" class="sidebar-link reco-side-成员变量和局部变量" data-v-cb1513f6>成员变量和局部变量</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#类的构造方法" class="sidebar-link reco-side-类的构造方法" data-v-cb1513f6>类的构造方法</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#面向对象三大特征" class="sidebar-link reco-side-面向对象三大特征" data-v-cb1513f6>面向对象三大特征</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#接口和抽象类" class="sidebar-link reco-side-接口和抽象类" data-v-cb1513f6>接口和抽象类</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#equals和hashcode" class="sidebar-link reco-side-equals和hashcode" data-v-cb1513f6>equals和hashCode</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#string、stringbuffer、stringbuilder" class="sidebar-link reco-side-string、stringbuffer、stringbuilder" data-v-cb1513f6>String、StringBuffer、StringBuilder</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#exception和error" class="sidebar-link reco-side-exception和error" data-v-cb1513f6>Exception和Error</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#try-catch-finally" class="sidebar-link reco-side-try-catch-finally" data-v-cb1513f6>try-catch-finally</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#泛型" class="sidebar-link reco-side-泛型" data-v-cb1513f6>泛型</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#反射" class="sidebar-link reco-side-反射" data-v-cb1513f6>反射</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#序列化和反序列化" class="sidebar-link reco-side-序列化和反序列化" data-v-cb1513f6>序列化和反序列化</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#io流" class="sidebar-link reco-side-io流" data-v-cb1513f6>IO流</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#集合" class="sidebar-link reco-side-集合" data-v-cb1513f6>集合</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#list" class="sidebar-link reco-side-list" data-v-cb1513f6>List</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#comparable和comparator" class="sidebar-link reco-side-comparable和comparator" data-v-cb1513f6>Comparable和Comparator</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#无序性和不可重复性" class="sidebar-link reco-side-无序性和不可重复性" data-v-cb1513f6>无序性和不可重复性</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#queue和deque" class="sidebar-link reco-side-queue和deque" data-v-cb1513f6>Queue和Deque</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#hashmap和hashtable" class="sidebar-link reco-side-hashmap和hashtable" data-v-cb1513f6>HashMap和HashTable</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#hashset去重" class="sidebar-link reco-side-hashset去重" data-v-cb1513f6>HashSet去重</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#hashmap-2" class="sidebar-link reco-side-hashmap-2" data-v-cb1513f6>HashMap</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#concurrenthashmap和hashtable" class="sidebar-link reco-side-concurrenthashmap和hashtable" data-v-cb1513f6>ConcurrentHashMap和HashTable</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#集合和数组" class="sidebar-link reco-side-集合和数组" data-v-cb1513f6>集合和数组</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#进程和线程" class="sidebar-link reco-side-进程和线程" data-v-cb1513f6>进程和线程</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#并发和并行" class="sidebar-link reco-side-并发和并行" data-v-cb1513f6>并发和并行</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#为什么使用多线程" class="sidebar-link reco-side-为什么使用多线程" data-v-cb1513f6>为什么使用多线程</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#线程的生命周期" class="sidebar-link reco-side-线程的生命周期" data-v-cb1513f6>线程的生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#死锁" class="sidebar-link reco-side-死锁" data-v-cb1513f6>死锁</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#为什么不能直接调用run-而是调用start" class="sidebar-link reco-side-为什么不能直接调用run-而是调用start" data-v-cb1513f6>为什么不能直接调用run()，而是调用start()</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#synchronized" class="sidebar-link reco-side-synchronized" data-v-cb1513f6>synchronized</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#volatile-2" class="sidebar-link reco-side-volatile-2" data-v-cb1513f6>volatile</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#juc" class="sidebar-link reco-side-juc" data-v-cb1513f6>JUC</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#aqs" class="sidebar-link reco-side-aqs" data-v-cb1513f6>AQS</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#对象的创建" class="sidebar-link reco-side-对象的创建" data-v-cb1513f6>对象的创建</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#空间分配担保" class="sidebar-link reco-side-空间分配担保" data-v-cb1513f6>空间分配担保</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#四种引用-2" class="sidebar-link reco-side-四种引用-2" data-v-cb1513f6>四种引用</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#cms和g1" class="sidebar-link reco-side-cms和g1" data-v-cb1513f6>CMS和G1</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#事务acid" class="sidebar-link reco-side-事务acid" data-v-cb1513f6>事务ACID</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#并发事务问题" class="sidebar-link reco-side-并发事务问题" data-v-cb1513f6>并发事务问题</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#事务隔离级别" class="sidebar-link reco-side-事务隔离级别" data-v-cb1513f6>事务隔离级别</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#innodb" class="sidebar-link reco-side-innodb" data-v-cb1513f6>InnoDB</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring重要模块" class="sidebar-link reco-side-spring重要模块" data-v-cb1513f6>Spring重要模块</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#aop和ioc" class="sidebar-link reco-side-aop和ioc" data-v-cb1513f6>AOP和IOC</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#springmvc" class="sidebar-link reco-side-springmvc" data-v-cb1513f6>SpringMVC</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#类声明为bean" class="sidebar-link reco-side-类声明为bean" data-v-cb1513f6>类声明为Bean</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#component和-bean" class="sidebar-link reco-side-component和-bean" data-v-cb1513f6>@Component和@Bean</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#注入bean" class="sidebar-link reco-side-注入bean" data-v-cb1513f6>注入Bean</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#bean作用域" class="sidebar-link reco-side-bean作用域" data-v-cb1513f6>Bean作用域</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#bean的生命周期" class="sidebar-link reco-side-bean的生命周期" data-v-cb1513f6>Bean的生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring设计模式" class="sidebar-link reco-side-spring设计模式" data-v-cb1513f6>Spring设计模式</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#spring事务传播行为" class="sidebar-link reco-side-spring事务传播行为" data-v-cb1513f6>Spring事务传播行为</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#springbootapplication" class="sidebar-link reco-side-springbootapplication" data-v-cb1513f6>@SpringBootApplication</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#常见http请求" class="sidebar-link reco-side-常见http请求" data-v-cb1513f6>常见HTTP请求</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#前后端传值" class="sidebar-link reco-side-前后端传值" data-v-cb1513f6>前后端传值</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#事务属性" class="sidebar-link reco-side-事务属性" data-v-cb1513f6>事务属性</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#transactional注意事项" class="sidebar-link reco-side-transactional注意事项" data-v-cb1513f6>@Transactional注意事项</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/interview/interview.html#springboot自动装配" class="sidebar-link reco-side-springboot自动装配" data-v-cb1513f6>SpringBoot自动装配</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/learn-vuepress/assets/js/app.ef882cb7.js" defer></script><script src="/learn-vuepress/assets/js/6.0c5ddd61.js" defer></script><script src="/learn-vuepress/assets/js/1.a3f35cab.js" defer></script><script src="/learn-vuepress/assets/js/17.de597ac3.js" defer></script>
  </body>
</html>
