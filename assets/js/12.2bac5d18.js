(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{828:function(t,a,s){t.exports=s.p+"assets/img/202112142227793.99b6f827.png"},829:function(t,a,s){t.exports=s.p+"assets/img/image-20211216214902553.d1c88135.png"},830:function(t,a,s){t.exports=s.p+"assets/img/image-20211218214957203.6c510aa4.png"},831:function(t,a,s){t.exports=s.p+"assets/img/image-20220126220723859.a618ae66.png"},832:function(t,a,s){t.exports=s.p+"assets/img/image-20220130161744226.5e54fd26.png"},833:function(t,a,s){t.exports=s.p+"assets/img/image-20220204221208361.1f027455.png"},834:function(t,a,s){t.exports=s.p+"assets/img/image-20220204123425989.efcd60a4.png"},910:function(t,a,s){"use strict";s.r(a);var n=s(17),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"nginx简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx简介"}},[t._v("#")]),t._v(" nginx简介")]),t._v(" "),n("h2",{attrs:{id:"背景介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景介绍"}},[t._v("#")]),t._v(" 背景介绍")]),t._v(" "),n("blockquote",[n("p",[t._v("高性能的【HTTP】和【反向代理】的【web服务器】，同时是【POP3、SMTP、IMAP代理服务器】，使用c语言编写的，开源")])]),t._v(" "),n("h3",{attrs:{id:"名词解释"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#名词解释"}},[t._v("#")]),t._v(" 名词解释")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("web服务器：")]),t._v(" "),n("ul",[n("li",[t._v("也叫==页面服务器==，给用户提供网上信息浏览服务")])])]),t._v(" "),n("li",[n("p",[t._v("HTTP：")]),t._v(" "),n("ul",[n("li",[t._v("超文本传输协议的缩写，从web服务器传输超文本到本地浏览器的传输协议，客户端是终端用户，服务器是网站")])])]),t._v(" "),n("li",[n("p",[t._v("POP3、SMTP、IMAP：")]),t._v(" "),n("ul",[n("li",[t._v("POP3（post office protocol）：邮局协议的第三个版本")]),t._v(" "),n("li",[t._v("SMTP（simple mail transfer protocol）：简单邮件传输协议")]),t._v(" "),n("li",[t._v("IMAP（Internet mail access protocol）：交互式邮件存取协议")])])]),t._v(" "),n("li",[n("p",[t._v("反向代理：nginx可以作为==电子邮件==代理服务器")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("正向代理：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112062117719.png",alt:"image-20211206211713665"}})])]),t._v(" "),n("li",[n("p",[t._v("反向代理：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112062117309.png",alt:"image-20211206211717992"}})])])])])]),t._v(" "),n("h2",{attrs:{id:"常见服务器对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见服务器对比"}},[t._v("#")]),t._v(" 常见服务器对比")]),t._v(" "),n("blockquote",[n("p",[t._v("==netcraft==公司官网每月公布调研数据（web server survey），成为人们了解全球网站数量及服务器份额情况必不可少网站")])]),t._v(" "),n("p",[t._v("https://news.netcraft.com/")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112072003804.png",alt:"image-20211207200319533"}})]),t._v(" "),n("h3",{attrs:{id:"iis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iis"}},[t._v("#")]),t._v(" IIS")]),t._v(" "),n("blockquote",[n("p",[t._v("Internet information services即互联网信息服务，由微软公司提供的基于Windows系统的互联网服务")])]),t._v(" "),n("ul",[n("li",[t._v("缺点：\n"),n("ul",[n("li",[t._v("服务器的稳定性")]),t._v(" "),n("li",[t._v("性能不如unix操作系统")])])])]),t._v(" "),n("h3",{attrs:{id:"tomcat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tomcat"}},[t._v("#")]),t._v(" tomcat")]),t._v(" "),n("blockquote",[n("p",[t._v("运行==servlet和jsp==的web应用软件，开源")])]),t._v(" "),n("ul",[n("li",[t._v("缺点：\n"),n("ul",[n("li",[t._v("重量级")]),t._v(" "),n("li",[t._v("对静态文件和高并发的处理比较弱")])])])]),t._v(" "),n("h3",{attrs:{id:"apache"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#apache"}},[t._v("#")]),t._v(" apache")]),t._v(" "),n("blockquote",[n("p",[t._v("稳定、开源。跨平台等，出现时间太久了")])]),t._v(" "),n("ul",[n("li",[t._v("缺点：\n"),n("ul",[n("li",[t._v("重量级、不支持高并发")]),t._v(" "),n("li",[t._v("消耗大量的CPU资源")])])])]),t._v(" "),n("h3",{attrs:{id:"lighttpd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lighttpd"}},[t._v("#")]),t._v(" lighttpd")]),t._v(" "),n("blockquote",[n("p",[t._v("德国开源的web服务器软件")])]),t._v(" "),n("ul",[n("li",[t._v("优点：\n"),n("ul",[n("li",[t._v("轻量级，高性能")]),t._v(" "),n("li",[t._v("欧美常用，国内常用nginx")])])])]),t._v(" "),n("h3",{attrs:{id:"其它的服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其它的服务器"}},[t._v("#")]),t._v(" 其它的服务器")]),t._v(" "),n("blockquote",[n("p",[t._v("Google servers、weblogic……")])]),t._v(" "),n("h3",{attrs:{id:"nginx的优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的优点"}},[t._v("#")]),t._v(" nginx的优点")]),t._v(" "),n("h4",{attrs:{id:"速度更快、并发更高"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#速度更快、并发更高"}},[t._v("#")]),t._v(" 速度更快、并发更高")]),t._v(" "),n("blockquote",[n("p",[t._v("采用了==多进程和I/O多路复用（epoll）==的底层实现")])]),t._v(" "),n("h4",{attrs:{id:"配置简单-扩展性强"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置简单-扩展性强"}},[t._v("#")]),t._v(" 配置简单，扩展性强")]),t._v(" "),n("blockquote",[n("p",[t._v("很多模块组成，可以使用==配置文件的配置来添加模块==，也可以自己==定制模块==")])]),t._v(" "),n("h4",{attrs:{id:"高可靠性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#高可靠性"}},[t._v("#")]),t._v(" 高可靠性")]),t._v(" "),n("blockquote",[n("p",[t._v("多进程，其中有一个master主进程和N多个worker进程，==worker进程数量可以手动设置==，worker相互==独立==")])]),t._v(" "),n("h4",{attrs:{id:"热部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#热部署"}},[t._v("#")]),t._v(" 热部署")]),t._v(" "),n("blockquote",[n("p",[t._v("在==nginx不停止==的情况下，对nginx进行文件升级、更新配置和更换日志文件等功能")])]),t._v(" "),n("h4",{attrs:{id:"成本低、bsd许可证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#成本低、bsd许可证"}},[t._v("#")]),t._v(" 成本低、BSD许可证")]),t._v(" "),n("blockquote",[n("p",[t._v("BSD是一个开源的许可证。nginx不仅可以免费的应用在商业领域，还可以在项目中直接修改nginx的源码")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("比较流行的开源许可证：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("GPL、BSD、MIT、Mozilla、Apache、LGPL")])]),t._v(" "),n("li",[n("p",[t._v("OpenRestry [Nginx+Lua]   Tengine[淘宝]")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112072015644.png",alt:"image-20211207201540414"}})])])])])]),t._v(" "),n("h2",{attrs:{id:"nginx的功能特性及常用功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的功能特性及常用功能"}},[t._v("#")]),t._v(" nginx的功能特性及常用功能")]),t._v(" "),n("h3",{attrs:{id:"基本http服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本http服务"}},[t._v("#")]),t._v(" 基本HTTP服务")]),t._v(" "),n("p",[t._v("作为HTTP代理服务器和反向代理服务器，支持通过==缓存加速访问==，可以完成简单的==负载均衡和容错==，支持==包过滤、SSl==等")]),t._v(" "),n("ul",[n("li",[t._v("处理静态文件、索引文件以及支持自动索引")]),t._v(" "),n("li",[t._v("提供反向代理服务器、并可以使用缓存加上反向代理，同时完成负载均衡和容错")]),t._v(" "),n("li",[t._v("提供对fastcgl、memcached等访问的缓存机制，同时完成负载均衡和容错")]),t._v(" "),n("li",[t._v("提供过滤器功能，基本过滤器包括gzip压缩、ranges支持、chunked响应、XSLT、SSI以及图像缩放等")]),t._v(" "),n("li",[t._v("支持HTTP下的==安全套接层安全协议SSL==")]),t._v(" "),n("li",[t._v("支持基于加权和依赖的优先权的HTTP/2")])]),t._v(" "),n("h3",{attrs:{id:"高级http服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#高级http服务"}},[t._v("#")]),t._v(" 高级HTTP服务")]),t._v(" "),n("ul",[n("li",[t._v("支持基于名字和IP的虚拟主机设置")]),t._v(" "),n("li",[t._v("支持http/1.0中的keep-alive模式和管线（PipeLined）模型连接")]),t._v(" "),n("li",[t._v("自定义访问日志格式、带缓存的日志写操作以及快速日志轮转")]),t._v(" "),n("li",[t._v("提供3xx-5xx错误代码重定向功能")]),t._v(" "),n("li",[t._v("支持重写（Rewrite）模块扩展")]),t._v(" "),n("li",[t._v("支持重写加载配置以及在线升级无需中断正在处理的请求")]),t._v(" "),n("li",[t._v("支持网络监控")]),t._v(" "),n("li",[t._v("支持FLV和MP4流媒体传输")])]),t._v(" "),n("h3",{attrs:{id:"邮件服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#邮件服务"}},[t._v("#")]),t._v(" 邮件服务")]),t._v(" "),n("ul",[n("li",[t._v("支持IMPA、POP3代理服务功能")]),t._v(" "),n("li",[t._v("支持内部SMTP代理服务功能")])]),t._v(" "),n("h3",{attrs:{id:"nginx常用的功能模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用的功能模块"}},[t._v("#")]),t._v(" nginx常用的功能模块")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("静态资源部署\nRewrite地址重写\n\t正则表达式\n反向代理\n负载均衡\n\t轮询、加权轮询、ip_hash、url_hash、fair\nweb缓存\n环境部署\n\t高可用的环境\n用户认证模块..\n")])])]),n("p",[t._v("nginx的核心组成")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("nginx二进制可执行文件\nnginx.conf配置文件\nerror.log错误的日志记录\naccess.og访问日志记录\n")])])]),n("h1",{attrs:{id:"nginx环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx环境准备"}},[t._v("#")]),t._v(" nginx环境准备")]),t._v(" "),n("h2",{attrs:{id:"nginx版本介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx版本介绍"}},[t._v("#")]),t._v(" nginx版本介绍")]),t._v(" "),n("p",[t._v("官网：http://nginx.org/")]),t._v(" "),n("p",[t._v("右边导航栏：")]),t._v(" "),n("ol",[n("li",[t._v("语言：英文和俄罗斯")]),t._v(" "),n("li",[t._v("不同年份更新说明")]),t._v(" "),n("li",[t._v("关于nginx介绍")]),t._v(" "),n("li",[t._v("download：下载不同版本链接")]),t._v(" "),n("li",[t._v("security：和nginx安全相关的问题描述")]),t._v(" "),n("li",[t._v("documentation：官方文档")]),t._v(" "),n("li",[t._v("==faq：nginx的问答==")]),t._v(" "),n("li",[t._v("books：nginx书籍")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081930691.png",alt:"image-20211208193032993"}})]),t._v(" "),n("p",[t._v("下载页面：")]),t._v(" "),n("ol",[n("li",[t._v("mainline version：主线版本，即最新的")]),t._v(" "),n("li",[t._v("stable version：稳定版本，做web服务器通常考虑的")]),t._v(" "),n("li",[t._v("legacy version：旧版本")]),t._v(" "),n("li",[t._v("changes：对应版本功能变更日志")]),t._v(" "),n("li",[t._v("nginx：一点就下载，Linux版本的下载链接")]),t._v(" "),n("li",[t._v("pgp：一点就下载，使用PGP加密自由软件GnuPG计算后的签名信息")]),t._v(" "),n("li",[t._v("windows：Windows版本下载链接\t"),n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081939722.png",alt:"image-20211208193950598"}})])]),t._v(" "),n("h2",{attrs:{id:"获取nginx源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取nginx源码"}},[t._v("#")]),t._v(" 获取nginx源码")]),t._v(" "),n("p",[t._v("官网：http://nginx.org/download/")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081947134.png",alt:"image-20211208194727177"}})]),t._v(" "),n("h2",{attrs:{id:"准备服务器系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备服务器系统"}},[t._v("#")]),t._v(" 准备服务器系统")]),t._v(" "),n("p",[t._v("环境：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("Vmware workStation\nCentos7\nMobaXterm(或者Xshell，SecureCRT)\n网络\n")])])]),n("ol",[n("li",[n("p",[t._v("确认centos的内核，==centos7.6默认高于Linux2.6==，2.6以上才支持epoll，因为nginx需要解==决高并发问题是需要epoll==")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("查看内核版本")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("==uname -a==：查看当前")])]),t._v(" "),n("li",[n("p",[t._v("==yum list kernel -q==：查看已经安装的内核版本")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081953011.png",alt:"image-20211208195338513"}})])])])])])]),t._v(" "),n("li",[n("p",[t._v("确保联网：ping baidu.com")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081954654.png",alt:"image-20211208195425573"}})])]),t._v(" "),n("li",[n("p",[t._v("确保关闭防火墙，省去学习配置的问题，可以自己配置端口号，这样就不会被防火墙拦住")]),t._v(" "),n("ul",[n("li",[t._v("systemctl stop firewalld：重启失效")]),t._v(" "),n("li",[t._v("==systemctl disable firewalld==：永久关闭")]),t._v(" "),n("li",[t._v("systemctl status firewalld：查看服务器状态")])])]),t._v(" "),n("li",[n("p",[t._v("停用selinux：杰出安全子系统")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("==sestatus==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081959081.png",alt:"image-20211208195908479"}})])]),t._v(" "),n("li",[n("p",[t._v("如果不是disabled")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("==vim /etc/selinux/config==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082000818.png",alt:"image-20211208200039591"}})])])])])])])]),t._v(" "),n("h2",{attrs:{id:"nginx安装方式介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装方式介绍"}},[t._v("#")]),t._v(" nginx安装方式介绍")]),t._v(" "),n("p",[t._v("两个方式")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("通过nginx源码\n\t简单安装（1）\n\t复杂安装（2）\n通过yum安装\n")])])]),n("h3",{attrs:{id:"源码安装条件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码安装条件"}},[t._v("#")]),t._v(" 源码安装条件")]),t._v(" "),n("blockquote",[n("p",[t._v("centos7.6已经全部安装，不需要自己安装")])]),t._v(" "),n("h4",{attrs:{id:"gcc编译器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gcc编译器"}},[t._v("#")]),t._v(" GCC编译器")]),t._v(" "),n("blockquote",[n("p",[t._v("GCC是一个开源的==编译器集合==，用于处理各种各样的语言，其中包括C语言")])]),t._v(" "),n("h4",{attrs:{id:"pcre"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pcre"}},[t._v("#")]),t._v(" PCRE")]),t._v(" "),n("blockquote",[n("p",[t._v("perl Compatible Regular Expressoin兼容正则表达式库，因为nginx的Rewrite模块和http科学模块会使用到")])]),t._v(" "),n("h4",{attrs:{id:"zlib"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#zlib"}},[t._v("#")]),t._v(" zlib")]),t._v(" "),n("blockquote",[n("p",[t._v("因为nginx的需要==gzip压缩==，所以需要提前安装zlib(库)和zlib-devel(源代码)")])]),t._v(" "),n("h4",{attrs:{id:"openssl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#openssl"}},[t._v("#")]),t._v(" OpenSSL")]),t._v(" "),n("blockquote",[n("p",[t._v("安全通信，SSL：Secure Sockets Layer 安全套接协议，保证两个应用间通信的保密性和可靠性")])]),t._v(" "),n("p",[t._v("一行命令安装所有：yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel")]),t._v(" "),n("h3",{attrs:{id:"方案一-源码简单安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案一-源码简单安装"}},[t._v("#")]),t._v(" 方案一：源码简单安装")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("进入官网找到下载版本的链接地址，使用wget命令下载")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("wget http://nginx.org/download/nginx-1.16.1.tar.gz\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建目录")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mkdir -p nginx/core：创建多级\t\n")])])])]),t._v(" "),n("li",[n("p",[t._v("解压缩")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("tar -zxf nginx-1.16.1.tar.gz：不加v是不显示解压时的信息\n")])])])]),t._v(" "),n("li",[n("p",[t._v("找到configure执行脚本")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configure\n")])])])]),t._v(" "),n("li",[n("p",[t._v("编译和安装")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("make && make install\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"方案二-yum安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案二-yum安装"}},[t._v("#")]),t._v(" 方案二：yum安装")]),t._v(" "),n("blockquote",[n("p",[t._v("源码安装比较繁琐，需要准备GCC、PCRE、zlib、OpenSSL等，而yum不需要")])]),t._v(" "),n("p",[t._v("官网安装：http://nginx.org/en/linux_packages.html#RHEL-CentOS")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("安装yum-utils")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("sudo yum install yum-utils\n")])])])]),t._v(" "),n("li",[n("p",[t._v("添加yum源文件")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("vim sudo yum install yum-utils\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[nginx-stable]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n")])])])]),t._v(" "),n("li",[n("p",[t._v("使用yum安装")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("yum install -y nginx：加—y是默认输入y，即确认\n")])])])]),t._v(" "),n("li",[n("p",[t._v("查看nginx的安装位置")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("whereis nginx\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"源码简单安装和yum安装的差异"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码简单安装和yum安装的差异"}},[t._v("#")]),t._v(" 源码简单安装和yum安装的差异")]),t._v(" "),n("p",[n("code",[t._v("./nginx -V")]),t._v("，开源查看nginx版本及相关配置信息，这里的./nginx是绝对路径，完整路径==/usr/local/nginx/sbin/nginx -V==")]),t._v(" "),n("p",[t._v("简单安装：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082045043.png",alt:"image-20211208204542962"}})]),t._v(" "),n("p",[t._v("yum安装：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082046991.png",alt:"image-20211208204605990"}})]),t._v(" "),n("h4",{attrs:{id:"解压nginx目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解压nginx目录"}},[t._v("#")]),t._v(" 解压nginx目录")]),t._v(" "),n("p",[t._v("解压后还没有Makefile、objs")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082051945.png",alt:"image-20211208205158683"}})]),t._v(" "),n("p",[t._v("内容解释：")]),t._v(" "),n("ol",[n("li",[t._v("auto：存放编译相关的脚本")]),t._v(" "),n("li",[t._v("changes：版本变更记录")]),t._v(" "),n("li",[t._v("changes.ru：俄罗斯版本变更记录")]),t._v(" "),n("li",[t._v("==conf==：nginx默认的配置文件")]),t._v(" "),n("li",[t._v("==configure==：nginx的自动脚本程序，重要，作用如下：\n"),n("ul",[n("li",[t._v("==检查环境及根据环境检查结构生成C代码==")]),t._v(" "),n("li",[t._v("==生成编译代码需要的Makefile文件==")])])]),t._v(" "),n("li",[t._v("==contrib==：存放结构特殊的脚本文件，其中readme对脚本有详细的说明")]),t._v(" "),n("li",[t._v("html：nginx自带两个页面，首页和错误页面")]),t._v(" "),n("li",[t._v("license：许可证")]),t._v(" "),n("li",[t._v("man：nginx的man手册")]),t._v(" "),n("li",[t._v("src：源代码")])]),t._v(" "),n("h3",{attrs:{id:"方案三-nginx的源码复杂安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案三-nginx的源码复杂安装"}},[t._v("#")]),t._v(" 方案三：Nginx的源码复杂安装")]),t._v(" "),n("blockquote",[n("p",[t._v("和简单安装不同在第一步，手动指定./configure的配置")])]),t._v(" "),n("ul",[n("li",[t._v("PATH：和路径相关的配置")]),t._v(" "),n("li",[t._v("==with：启动模块，默认关闭==")]),t._v(" "),n("li",[t._v("==without：关闭模块，默认开启==")])]),t._v(" "),n("p",[t._v("配置：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("--prefix=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("指向nginx的安装目录，默认是/usr/local/nginx\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--sbin-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("指向执行程序文件路径，默认/usr/local/nginx/sbin/nginx\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--modules-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("动态模块安装目录，默认/usr/local/nginx/modules\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--conf-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("执行配置文件的路径，默认/usr/local/nginx/conf/nginx.conf\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082104546.png",alt:"image-20211208210404057"}})])]),t._v(" "),n("li",[n("p",[t._v("--error-log-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("错误日志文件路径，默认值/usr/local/nginx/logs/error.log\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--http-log-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("访问日志路径，默认/usr/local/nginx/logs/access.log\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--pid-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("nginx启动后ID的路径，默认/usr/local/nginx/logs/nginx.pid\n")])])])]),t._v(" "),n("li",[n("p",[t._v("--lock-path=PATH")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("nginx锁文件的路径，默认/usr/local/nginx/logs/nginx.lock\n")])])])])]),t._v(" "),n("p",[t._v("使用以上命令")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configure --prefix=/usr/local/nginx \\\n--sbin-path=/usr/local/nginx/sbin/nginx \\\n--modules-path=/usr/local/nginx/modules \\\n--conf-path=/usr/local/nginx/conf/nginx.conf \\\n--error-log-path=/usr/local/nginx/logs/error.log \\\n--http-log-path=/usr/local/nginx/logs/access.log \\\n--pid-path=/usr/local/nginx/logs/nginx.pid \\\n--lock-path=/usr/local/nginx/logs/nginx.lock\n")])])]),n("p",[t._v("编译和安装")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("make && make install\n")])])]),n("h2",{attrs:{id:"卸载nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#卸载nginx"}},[t._v("#")]),t._v(" 卸载nginx")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("关闭进程")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./nginx -s stop\n")])])])]),t._v(" "),n("li",[n("p",[t._v("删除安装的nginx")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("rm -rf /usr/local/nginx\n")])])])]),t._v(" "),n("li",[n("p",[t._v("之前编译的环境清除掉（注意：make命令要在有Makefile的目录中执行）")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("make clean\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112092007451.png",alt:"image-20211209200746888"}})])]),t._v(" "),n("li",[n("p",[t._v("如果在这此之前安装过复杂源码安装，yum安装后nginx目录可能不在/usr/local/nginx")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("==find / -name nginx==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082130898.png",alt:"image-20211208213027143"}})])]),t._v(" "),n("li",[n("p",[t._v("找到nginx目录把它给删除")])]),t._v(" "),n("li",[n("p",[t._v("然后在make clean将之前编译的环境清除掉")])])])])]),t._v(" "),n("h2",{attrs:{id:"nginx目录结构分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx目录结构分析"}},[t._v("#")]),t._v(" nginx目录结构分析")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091549221.png",alt:"image-20211209154908119"}})]),t._v(" "),n("ul",[n("li",[t._v("conf：nginx所有配置文件目录")]),t._v(" "),n("li",[t._v("CGI（common gateway interface）通用网关接口，客户端发送请求和数据，服务端调用cgi处理相应结果给客户端的一种==标准规范==")]),t._v(" "),n("li",[t._v("fastcgi.conf：相关配置文件")]),t._v(" "),n("li",[t._v("fastcgi.conf.default：对应的备份")]),t._v(" "),n("li",[t._v("fastcgi_params：参数文件")]),t._v(" "),n("li",[t._v("scgi_params：scgi的参数文件")]),t._v(" "),n("li",[t._v("uwsgi_params：uwsgi的参数文件")]),t._v(" "),n("li",[t._v("mine.types：记录HTTP协议中的Content-Type的==值==和==文件后缀名==的对应关系")]),t._v(" "),n("li",[t._v("==nginx.conf==：==核心配置文件==，非常重要，学习的重点")]),t._v(" "),n("li",[t._v("koi-utf、koi-win、win-utf：与编码转换映射相关的配置文件，一种==编码转换另一种编码==")]),t._v(" "),n("li",[t._v("html：存放两个静态页面\n"),n("ul",[n("li",[t._v("50x.html：访问失败")]),t._v(" "),n("li",[t._v("index.html：访问成功页面")])])]),t._v(" "),n("li",[t._v("logs：服务器启动后，这里会有==access.log、error.log、nginx.pid==三个文件")]),t._v(" "),n("li",[t._v("sbin：存放执行程序nginx文件")])]),t._v(" "),n("h2",{attrs:{id:"nginx服务器启停命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务器启停命令"}},[t._v("#")]),t._v(" nginx服务器启停命令")]),t._v(" "),n("h3",{attrs:{id:"方式一-nginx服务的信号控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式一-nginx服务的信号控制"}},[t._v("#")]),t._v(" 方式一：Nginx服务的信号控制")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==ps -ef | grep nginx==：查看nginx进程号")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091838307.png",alt:"image-20211209183823884"}})])]),t._v(" "),n("li",[n("p",[t._v("关系：")]),t._v(" "),n("p",[n("img",{attrs:{src:"E:%5CTypora_BI_JI%5Ctu-pian%5Cimage-20211209184041084.png",alt:"image-20211209184041084"}})])]),t._v(" "),n("li",[n("p",[t._v("我们是管理员，只需给master进程发送信号就可以控制nginx")]),t._v(" "),n("ul",[n("li",[t._v("master进程")]),t._v(" "),n("li",[t._v("信号")])])]),t._v(" "),n("li",[n("p",[t._v("信号")]),t._v(" "),n("ul",[n("li",[t._v("TERM/INT：立即关闭服务")]),t._v(" "),n("li",[t._v("QUIT：先执行完当前然后关闭全部服务")]),t._v(" "),n("li",[t._v("HUP：重新启动work进程")]),t._v(" "),n("li",[t._v("USR1：重新开启日志文件")]),t._v(" "),n("li",[t._v("USR2：平滑升级到最新版的nginx")]),t._v(" "),n("li",[t._v("WINCH：和quit差不多，区别在于这个master进程不会被关闭")])])]),t._v(" "),n("li",[n("p",[t._v("==kill -signal PID==")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("立即关闭")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("kill -TERM `cat /usr/local/nginx/logs/nginx.pid`\n")])])])]),t._v(" "),n("li",[n("p",[t._v("先执行完当前然后关闭全部服务")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("kill -quit 11044\n")])])])]),t._v(" "),n("li",[n("p",[t._v("重新启动work进程")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("kill -HUP 11044\n")])])])]),t._v(" "),n("li",[n("p",[t._v("重新开启日志文件")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("//删除日志文件\nrm -rf access.log error.log\n//恢复\nkill -usr1 11044\n")])])])]),t._v(" "),n("li",[n("p",[t._v("平滑升级到最新版的nginx")]),t._v(" "),n("div",{staticClass:"language-nginx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[t._v("kill -usr2 11044\n此时出现两个master，日志多了nginx.pid.oldbin\n//关闭旧的master\nkill -quit 11044\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091932811.png",alt:"image-20211209193256555"}})])]),t._v(" "),n("li",[n("p",[t._v("和quit差不多，区别在于这个master进程不会被关闭")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("kill -winch 11044\n")])])])])])])]),t._v(" "),n("h3",{attrs:{id:"方式二-nginx的命令行控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式二-nginx的命令行控制"}},[t._v("#")]),t._v(" 方式二：Nginx的命令行控制")]),t._v(" "),n("blockquote",[n("p",[t._v("通过sbin下的nginx实现命令行控制，先./nginx -h查看有哪些参数可以用")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091921971.png",alt:"image-20211209192136967"}})]),t._v(" "),n("ol",[n("li",[t._v("-v：打印版本号信息")]),t._v(" "),n("li",[t._v("-V：打印版本号和配置信息")]),t._v(" "),n("li",[t._v("-t：测试nginx的配置文件是否正确")]),t._v(" "),n("li",[t._v("-T：测试nginx的配置文件是否正确并==列出配置文件信息==")]),t._v(" "),n("li",[t._v("==-q：只打印错误信息==")]),t._v(" "),n("li",[t._v("-s：信号，后面可以跟：\n"),n("ul",[n("li",[t._v("stop【快速关闭，相当于int】")]),t._v(" "),n("li",[t._v("quit【QUIT】")]),t._v(" "),n("li",[t._v("==reopen==【重启日志文件，相当于==usr1==】")]),t._v(" "),n("li",[t._v("==reload==【hup，即==重新加载worker==】")])])]),t._v(" "),n("li",[t._v("-p：指定nginx的路径，默认/usr/local/nginx")]),t._v(" "),n("li",[t._v("-c：指定nginx的配置文件路径。默认/usr/local/nginx/conf/nginx.conf")]),t._v(" "),n("li",[t._v("-g：补充全局配置文件，很少用，可以在/usr/local/nginx/conf/nginx.conf配置就行")])]),t._v(" "),n("h2",{attrs:{id:"nginx服务器版本升级和新增模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务器版本升级和新增模块"}},[t._v("#")]),t._v(" nginx服务器版本升级和新增模块")]),t._v(" "),n("h3",{attrs:{id:"环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("准备要安装的新版本包")])]),t._v(" "),n("li",[n("p",[t._v("==对新版本进行参数配置和编译，不需要安装make install==")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configure\nmake\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"方案一-使用nginx服务信号进行升级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案一-使用nginx服务信号进行升级"}},[t._v("#")]),t._v(" 方案一：使用nginx服务信号进行升级")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==对老版本sbin下的nginx进行备份==")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("cd /usr/local/nginx/sbin\n//改名\nmv nginx nginxOld\n")])])])]),t._v(" "),n("li",[n("p",[t._v("进入==新版本的objs==，==把里面的nginx文件拷贝到/usr/local/nginx/sbin目录下==")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("cd ~/nginx/core/nginx-1.16.1/objs\ncp nginx /usr/local/nginx/sbin\n")])])])]),t._v(" "),n("li",[n("p",[t._v("使用usr2")]),t._v(" "),n("ul",[n("li",[t._v("==kill -usr2 老版本号的PID==")]),t._v(" "),n("li",[t._v("==kill -quit 老版本号的PID==")])])]),t._v(" "),n("li",[n("p",[t._v("检查是否更新成功")]),t._v(" "),n("ul",[n("li",[t._v("==./nginx -v==")])])])]),t._v(" "),n("h3",{attrs:{id:"方案二-使用nginx安装目录的make命令完成升级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案二-使用nginx安装目录的make命令完成升级"}},[t._v("#")]),t._v(" 方案二：使用nginx安装目录的make命令完成升级")]),t._v(" "),n("p",[t._v("前两步一样，第三步有变化")]),t._v(" "),n("p",[t._v("==make upgrade（使用make前提在有Makefile的目录），底层实现还是调用了usr2、quit==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112092020558.png",alt:"image-20211209202016477"}})]),t._v(" "),n("h1",{attrs:{id:"nginx核心配置文件结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx核心配置文件结构"}},[t._v("#")]),t._v(" nginx核心配置文件结构")]),t._v(" "),n("blockquote",[n("p",[t._v("目录：/usr/local/nginx/conf/nginx.conf")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("除了注释，nginx.conf的内容：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("worker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\n}\n")])])])]),t._v(" "),n("li",[n("p",[t._v("全局块：设置nginx服务器==整体运行的配置指令==")]),t._v(" "),n("ul",[n("li",[t._v("指令名  指令值")])])]),t._v(" "),n("li",[n("p",[t._v("events块：设置服务器与用户的==网络连接==")])]),t._v(" "),n("li",[n("p",[t._v("http块：==代理、缓存、日志记录、第三方模块配置……==")])])]),t._v(" "),n("p",[t._v("🚅nginx.conf配置文件默认有三大块：全局块、events块、http块")]),t._v(" "),n("p",[t._v("📧==http==可以设置==多个server块==，每个==server块==又可以配置==多个location块==")]),t._v(" "),n("h2",{attrs:{id:"全局块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局块"}},[t._v("#")]),t._v(" 全局块")]),t._v(" "),n("h3",{attrs:{id:"user指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user指令"}},[t._v("#")]),t._v(" user指令")]),t._v(" "),n("blockquote",[n("p",[t._v("配置worker进程的用户和用户组")]),t._v(" "),n("p",[t._v("✔️默认值：nobody")]),t._v(" "),n("p",[t._v("✔️位置：全局块")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("user www;")])]),t._v(" "),n("li",[n("p",[t._v("==useradd www==")])]),t._v(" "),n("li",[n("p",[t._v("创建/root/html/index.html，内容如下：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Welcome to nginx!"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token style"}},[n("span",{pre:!0,attrs:{class:"token language-css"}},[t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("body")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 35em"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("margin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0 auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-family")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Tahoma"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Verdana"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Arial"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sans-serif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Welcome to nginx!"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("For online documentation and support please refer to\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://nginx.org/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nginx.org"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\nCommercial support is available at\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://nginx.com/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nginx.com"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("em")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Thank you for using nginx."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("em")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("em")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("I am WWW"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("em")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("修改nginx.conf")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("location / {\n\troot /root/html\n\tindex index.html index.htm\n}\n")])])])]),t._v(" "),n("li",[n("p",[t._v("启动访问失败：403")])]),t._v(" "),n("li",[n("p",[t._v("原因：当前用户(www)没有访问/root/html目录权限")]),t._v(" "),n("ul",[n("li",[t._v("这个可以自己测试，即==用要测试的用户登录，然后看能不能进入想要的目录==")])])]),t._v(" "),n("li",[n("p",[t._v("将文件创建到/home/www/html/index.html")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("location / {\n\troot /home/www/html\n\tindex index.html index.htm\n}\n")])])])]),t._v(" "),n("li",[n("p",[t._v("访问成功")])])]),t._v(" "),n("p",[t._v(":happy:使用user指令，对于系统的权限访问控制的==更加精细和安全==")]),t._v(" "),n("h3",{attrs:{id:"work-process-指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#work-process-指令"}},[t._v("#")]),t._v(" work process 指令")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==master_process==   on|off")]),t._v(" "),n("ul",[n("li",[t._v("默认值：on（开启）")]),t._v(" "),n("li",[t._v("位置：全局块")]),t._v(" "),n("li",[t._v("作用：是否==开启worker进程==")])])]),t._v(" "),n("li",[n("p",[t._v("==worker_processes==")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("默认值：1")])]),t._v(" "),n("li",[n("p",[t._v("位置：全局块")])]),t._v(" "),n("li",[n("p",[t._v("作用：开启==worker进程数量==，尽量和CPU的内核数保存一致")])]),t._v(" "),n("li",[n("p",[t._v("设置为2，会看到如下所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101658374.png",alt:"image-20211210165834580"}})])])])])]),t._v(" "),n("h3",{attrs:{id:"其它指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其它指令"}},[t._v("#")]),t._v(" 其它指令")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==daemon== on|off")]),t._v(" "),n("ul",[n("li",[t._v("默认值：on")]),t._v(" "),n("li",[t._v("全局块")]),t._v(" "),n("li",[t._v("作用：是否==守护进程==，不守护开启nginx后，不能进行任何操作，只能等进程结束（即ctrl+c退出进程）")])])]),t._v(" "),n("li",[n("p",[t._v("pid file")]),t._v(" "),n("ul",[n("li",[t._v("默认值：/usr/local/nginx/logs/nginx.pid")]),t._v(" "),n("li",[t._v("位置：全局块")]),t._v(" "),n("li",[t._v("作用：master进程的进程号ID存储路径")])])]),t._v(" "),n("li",[n("p",[t._v("==error_log==")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("默认值：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101706026.png",alt:"image-20211210170617415"}})])]),t._v(" "),n("li",[n("p",[t._v("位置：除了event都有")])]),t._v(" "),n("li",[n("p",[t._v("日志级别：debug|info|notice|warn|error|crit|alert|emerg|：调试、信息、通知、警告、错误、临界、警报、紧急，要在info之上，减少磁盘I/O消耗")])])])]),t._v(" "),n("li",[n("p",[t._v("==include==：引入其它配置文件，使nginx配置更灵活")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101712728.png",alt:"image-20211210171241156"}})])])]),t._v(" "),n("h2",{attrs:{id:"events块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#events块"}},[t._v("#")]),t._v(" events块")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==accept_mutex==：设置网络连接序列化")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("默认值：on")])]),t._v(" "),n("li",[n("p",[t._v("位置：events")])]),t._v(" "),n("li",[n("p",[t._v("开启后，一个一个唤醒接收，不开启会争夺，但最后还是只能一个狗获得")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101715893.png",alt:"image-20211210171426417"}})])])])]),t._v(" "),n("li",[n("p",[t._v("==multi_accept==：是否允许==多个网络连接worker==")]),t._v(" "),n("ul",[n("li",[t._v("默认值：off")]),t._v(" "),n("li",[t._v("位置：events")])])]),t._v(" "),n("li",[n("p",[t._v("==worker_connections==：一个worker最大连接数")]),t._v(" "),n("ul",[n("li",[t._v("默认值：512")]),t._v(" "),n("li",[t._v("位置：events")])])]),t._v(" "),n("li",[n("p",[t._v("use：选择哪种==事件驱动==来==处理网络消息==")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("默认值：操作系统定")])]),t._v(" "),n("li",[n("p",[t._v("位置：events")])]),t._v(" "),n("li",[n("p",[t._v("可选：select/poll/epoll/kqueue等")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101722894.png",alt:"image-20211210172231629"}})])])])])]),t._v(" "),n("h3",{attrs:{id:"events指令配置实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#events指令配置实例"}},[t._v("#")]),t._v(" events指令配置实例")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("events "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置网络连接序列号，默认on，即一个一个唤醒连接")]),t._v("\n    accept_mutex on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认off，设置进程是否可以多个网络连接")]),t._v("\n    multi_accept on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#单个worker最大连接数")]),t._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置哪种事件驱动来处理网络信息，linux2.6以上才支持epoll(多路复用)")]),t._v("\n    use epoll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"http块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http块"}},[t._v("#")]),t._v(" http块")]),t._v(" "),n("h3",{attrs:{id:"定义mime-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定义mime-type"}},[t._v("#")]),t._v(" 定义MIME-Type")]),t._v(" "),n("blockquote",[n("p",[t._v("MIME-Type网络资源的媒体类型")])]),t._v(" "),n("p",[t._v("✔️include mine.types相当于把mine.types文件加入nginx.conf的配置文件中")]),t._v(" "),n("p",[t._v("✔️位置：http、server、location")]),t._v(" "),n("p",[t._v("✔️例：请求文本或者json字符串，使用固定字符串，可以使用nginx快速实现，就不用程序响应请求")]),t._v(" "),n("ul",[n("li",[n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#自定义普通文本文件")]),t._v("\n      location /get_text "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log   logs/text.log myFormat;")]),t._v("\n          default_type text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<h1>This is a nginx\'s text</h1>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      location /get_json "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          default_type application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{name:\"luo\",age:18}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"自定义服务日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义服务日志"}},[t._v("#")]),t._v(" 自定义服务日志")]),t._v(" "),n("blockquote",[n("p",[t._v("对日志的格式、大小、输出等进行自定义，需要两个指令")]),t._v(" "),n("ul",[n("li",[t._v("==access_log==")]),t._v(" "),n("li",[t._v("==log_format==")])])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("access_log：成功日志路径")])]),t._v(" "),n("li",[n("p",[t._v("log_format：日志输出格式")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101733957.png",alt:"image-20211210173348925"}})])])]),t._v(" "),n("h3",{attrs:{id:"其它配置指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其它配置指令"}},[t._v("#")]),t._v(" 其它配置指令")]),t._v(" "),n("ol",[n("li",[t._v("==sendfile==：传输文件，提高处理静态资源的性能\n"),n("ul",[n("li",[t._v("默认值：off")]),t._v(" "),n("li",[t._v("位置：http、server、location")])])]),t._v(" "),n("li",[t._v("==keepalive_timeout==：设置长连接的超时时间\n"),n("ul",[n("li",[t._v("即三次握手，四次挥手")]),t._v(" "),n("li",[t._v("处理完一个请求后保存TCP连接打开状态，若有其它请求，服务端利用这个未被关闭的连接，不需要创建新连接")]),t._v(" "),n("li",[t._v("默认值：75s")]),t._v(" "),n("li",[t._v("位置：http、server、location")])])]),t._v(" "),n("li",[t._v("==keepalive_requests==：设置一个keep-alive连接使用次数\n"),n("ul",[n("li",[t._v("默认值：100")]),t._v(" "),n("li",[t._v("位置：http、server、location")])])])]),t._v(" "),n("h2",{attrs:{id:"server和location块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#server和location块"}},[t._v("#")]),t._v(" server和location块")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101740025.png",alt:"image-20211210174053086"}})]),t._v(" "),n("h1",{attrs:{id:"nginx进阶篇"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx进阶篇"}},[t._v("#")]),t._v(" nginx进阶篇")]),t._v(" "),n("h2",{attrs:{id:"nginx服务器基础配置实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务器基础配置实例"}},[t._v("#")]),t._v(" nginx服务器基础配置实例")]),t._v(" "),n("p",[t._v(":happy:需求：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("1、访问192.168.200.129:8081/server1/location1：返回index_sr1_location1.html\n2、访问192.168.200.129:8081/server2/location2：返回index_sr1_location2.html\n3、访问192.168.200.129:8082/server1/location1：返回index_sr2_location1.html\n4、访问192.168.200.129:8082/server2/location1：返回index_sr2_location2.html\n5、404返回自定义404页面\n6、server1和server2配置分开放\n7、server1和server2格子有访问日志文件\n")])])]),n("p",[t._v(":happy:目录如下：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112112246532.png",alt:"image-20211211224611486"}})]),t._v(" "),n("ul",[n("li",[n("p",[t._v("nginx.conf的配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更改用户")]),t._v("\nuser  www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置worker数量")]),t._v("\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认错误路径在logs/error.log")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认masterPID路径在logs/nginx.pid")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#pid        logs/nginx.pid;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认以守护进程方式启动")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#daemon on;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#以后这个直接复制")]),t._v("\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置网络连接序列化")]),t._v("\n    accept_mutex on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置worker是否可以同时连接多个")]),t._v("\n    multi_accept on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#同时连接多个上限")]),t._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#事件驱动模型")]),t._v("\n    use epoll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用default_type代表application/octet-stream")]),t._v("\n    default_type  application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用sendfile传输")]),t._v("\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置连接超时时间")]),t._v("\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置日志格式")]),t._v("\n    log_format server1 "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'===>server1 access log'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    log_format server2 "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'===>server2 access log'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#引入自定义配置")]),t._v("\n    include /home/www/conf.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("server1.conf")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监听的端口")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主机名")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#成功访问后日志路径（试试能不能改路径/myweb/server1/logs/access.log,答案不行,其实每个location最后都用了绝对路径）")]),t._v("\n        access_log /home/www/myweb/server1/logs/access.log server1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置访问的路径")]),t._v("\n        location /server1/location1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index_sr1_location1.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location /server1/location2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index_sr1_location2.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#错误日志路径")]),t._v("\n        error_page "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" /404.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /404.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可以试试把这个删了，因为上面写了404.html(error_page),root可以不用写，但alias需要")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#index 404.html;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("server2.conf")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监听的端口")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主机名")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#成功访问后日志路径（试试能不能改路径/server2/logs/access.log）")]),t._v("\n        access_log /home/www/myweb/server2/logs/access.log server1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置访问的路径")]),t._v("\n        location /server2/location1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index_sr2_location1.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location /server2/location2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index_sr2_location2.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#错误日志路径")]),t._v("\n        error_page "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" /404.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /404.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root /home/www/myweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可以试试把这个删了，因为上面写了404.html(error_page)")]),t._v("\n                index "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(".html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"nginx服务操作的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务操作的问题"}},[t._v("#")]),t._v(" nginx服务操作的问题")]),t._v(" "),n("blockquote",[n("p",[t._v("如果想启动、关闭或重新加载nginx，需要进入它的配置文件，有点繁琐")])]),t._v(" "),n("p",[t._v("优化：")]),t._v(" "),n("p",[t._v("​\t✔️配置为系统服务")]),t._v(" "),n("p",[t._v("​\t✔️命令配置到系统环境")]),t._v(" "),n("h2",{attrs:{id:"nginx配置成系统服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置成系统服务"}},[t._v("#")]),t._v(" nginx配置成系统服务")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==vim /usr/lib/systemd/system/nginx.service==")])]),t._v(" "),n("li",[n("p",[t._v("添加如下内容：")]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("[Unit]\nDescription=nginx web service\nDocumentation="),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//nginx.org/en/docs/")]),t._v("\nAfter=network.target\n\n[Service]\nType=forking\nPIDFile=/usr/local/nginx/logs/nginx.pid\nExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nExecStart=/usr/local/nginx/sbin/nginx\nExecReload=/usr/local/nginx/sbin/nginx -s reload\nExecStop=/usr/local/nginx/sbin/nginx -s stop\nPrivateTmp="),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n[Install]\nWantedBy=default.target\n")])])])]),t._v(" "),n("li",[n("p",[t._v("修改权限：==chmod 755  /usr/lib/systemd/system/nginx.service==")])]),t._v(" "),n("li",[n("p",[t._v("接下来可以使用：")]),t._v(" "),n("ul",[n("li",[t._v("启动：systemctl start nginx")]),t._v(" "),n("li",[t._v("停止：systemctl stop nginx")]),t._v(" "),n("li",[t._v("重启：systemctl restart nginx")]),t._v(" "),n("li",[t._v("重新加载：systemctl reload nginx")]),t._v(" "),n("li",[t._v("状态：systemctl status nginx")])])])]),t._v(" "),n("h2",{attrs:{id:"nginx命令配置到系统环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx命令配置到系统环境"}},[t._v("#")]),t._v(" nginx命令配置到系统环境")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("vim /etc/profile")])]),t._v(" "),n("li",[n("p",[t._v("在最后一行加：==export PATH=$PATH:$JAVA_HOME/bin:/usr/local/nginx/sbin==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112120952172.png",alt:"image-20211212095247984"}})])]),t._v(" "),n("li",[n("p",[t._v("生效：==source /etc/profile==")])]),t._v(" "),n("li",[n("p",[t._v("执行命令：")]),t._v(" "),n("ul",[n("li",[t._v("nginx -V")]),t._v(" "),n("li",[t._v("nginx -t")]),t._v(" "),n("li",[t._v("nginx -s reload")]),t._v(" "),n("li",[t._v("nginx -s stop")])])])]),t._v(" "),n("h2",{attrs:{id:"nginx静态资源部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx静态资源部署"}},[t._v("#")]),t._v(" nginx静态资源部署")]),t._v(" "),n("h3",{attrs:{id:"nginx静态资源概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx静态资源概述"}},[t._v("#")]),t._v(" nginx静态资源概述")]),t._v(" "),n("p",[t._v("✔️静态资源：服务端真实存在，能直接拿出来，例：html、css、js、图片、视频等")]),t._v(" "),n("p",[t._v("✔️动态资源：服务端真实存在，但需要业务逻辑处理才能取出来 ，例报表数据、登录用户不同展示不同数据等")]),t._v(" "),n("p",[t._v(":happy:nginx处理静态内容，考虑如下问题：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("静态资源的配置指令\n静态资源的配置优化\n静态资源的压缩配置指令\n静态资源的缓存处理\n静态资源的访问控制，包括跨域问题和防盗链问题\n")])])]),n("h3",{attrs:{id:"nginx静态资源的配置指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx静态资源的配置指令"}},[t._v("#")]),t._v(" nginx静态资源的配置指令")]),t._v(" "),n("h4",{attrs:{id:"listen指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#listen指令"}},[t._v("#")]),t._v(" listen指令")]),t._v(" "),n("ul",[n("li",[t._v("listen：配置监听端口\n"),n("ul",[n("li",[t._v("默认值：80")]),t._v(" "),n("li",[t._v("位置：server")]),t._v(" "),n("li",[t._v("例：\n"),n("ul",[n("li",[t._v("listen 8080;            指定端口")])])]),t._v(" "),n("li",[t._v("default_server属性是标识符，默认主机，如果==不指定默认，==则==默认是第一个server==")]),t._v(" "),n("li",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121014586.png",alt:"image-20211212101453776"}})])])])]),t._v(" "),n("h4",{attrs:{id:"server-name指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#server-name指令"}},[t._v("#")]),t._v(" server_name指令")]),t._v(" "),n("ul",[n("li",[t._v("server_name：设置虚拟主机服务名称")]),t._v(" "),n("li",[t._v("例：127.0.0.1、localhos、域名【www.baidu.com】【www.jd.com】")]),t._v(" "),n("li",[t._v("三种配置：\n"),n("ul",[n("li",[t._v("精确匹配")]),t._v(" "),n("li",[t._v("通配符匹配")]),t._v(" "),n("li",[t._v("正则表达式匹配")])])])]),t._v(" "),n("p",[t._v("✔️精确匹配")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("server {\n\tlisten 80;\n\tserver_name www.baidu.com  www.itcast.cn;\n\t……\n}\n")])])]),n("p",[t._v("😄补充小知识点：hosts是一个没有扩展名的系统文件，登录网址时，系统==首先从hosts==文件中寻找对应的IP地址，如果没有找到，再从==DNS域名解析服务器进行IP地址解析==")]),t._v(" "),n("ul",[n("li",[t._v("windows：C:\\Windows\\System32\\drivers\\etc")]),t._v(" "),n("li",[t._v("cenots：/etc/hosts")]),t._v(" "),n("li",[t._v("配置虚拟域名：\n"),n("ol",[n("li",[t._v("==vim /etc/hosts==")]),t._v(" "),n("li",[t._v("127.0.0.1 www.baidu.com       127.0.0.1 www.itheima.com")])])])]),t._v(" "),n("p",[t._v("✔️通配符匹配")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("通配符不能出现在域名中间，只能在首段或尾段")]),t._v(" "),n("div",{staticClass:"language-SPARQL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sparql"}},[n("code",[t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#通配符在前")]),t._v("\n    server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        return "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wildcard_before_success'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#通配符在后")]),t._v("\n    server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        return "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wildcard_after_success'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("p",[t._v("✔️正则表达式配置")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("正则表达式开始的标记~")])]),t._v(" "),n("li",[n("p",[t._v("常见的正则表达式：")]),t._v(" "),n("ol",[n("li",[t._v("^(常用)：字符串开始")]),t._v(" "),n("li",[t._v("$(常用)：字符串结束")]),t._v(" "),n("li",[t._v("(常用)：转义字符")]),t._v(" "),n("li",[t._v("[xyz]：字符集，与其中任意一个指定字符匹配")]),t._v(" "),n("li",[t._v("[a-z]：字符范围")]),t._v(" "),n("li",[t._v("\\w(常用)：A-Z、a-z、0-9和下划线_ ，等效于[A-Za-z0-9_]")]),t._v(" "),n("li",[t._v("\\d：数字匹配，等效于[0-9]")]),t._v(" "),n("li",[t._v("{n}：正好匹配n次")]),t._v(" "),n("li",[t._v("{n,}：至少匹配n次")]),t._v(" "),n("li",[t._v("{n,m}：至少n次，至多m次")]),t._v(" "),n("li",[t._v("*(常用)：零次或多次，等价于{0,}")]),t._v(" "),n("li",[t._v("+：一次或多次，等价于{1,}")]),t._v(" "),n("li",[t._v("?：零次或一次，等价于{0,1}")])])]),t._v(" "),n("li",[n("p",[t._v("例：")]),t._v(" "),n("div",{staticClass:"language-SPARQL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sparql"}},[n("code",[t._v("\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#正则表达式")]),t._v("\n    server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#\\.转义，\\w+，输入一次或多次")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#~^开始")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#$结束")]),t._v("\n        server_name ~^www\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\w+"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        return "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'regex_success'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"匹配执行顺序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#匹配执行顺序"}},[t._v("#")]),t._v(" 匹配执行顺序")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("三种匹配都有，哪个优先？")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("  \t#server\n    #精确匹配\n    server{\n        listen 80;\n        server_name www.baidu.com;\n        default_type text/plain;\n        return 200 'exact_success';\n    }\n    #通配符在前\n    server{\n        listen 80;\n        server_name *.baidu.com;\n        default_type text/plain;\n        return 200 'wildcard_before_success';\n    }\n    #通配符在后\n    server{\n        listen 80;\n        server_name www.baidu.*;\n        default_type text/plain;\n        return 200 'wildcard_after_success';\n    }\n    #正则表达式\n    server{\n        listen 80;\n        server_name ~^www\\.(\\w+)\\.com$;\n        default_type text/plain;\n        return 200 'regex_success';\n    }\n    #默认\n    server{\n        listen 80 default_server;\n        server_name localhost;\n        default_type text/plain;\n        return 444 'default_server error';\n\t}\n")])])]),n("p",[t._v("😙结论")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("exact_success\t精确\nwildcard_before_success\t\t通配符前\nwildcard_after_success\t\t通配符后\nregex_success\t\t正则表达式\ndefault_server not found server!!\t默认\n")])])])])]),t._v(" "),n("h4",{attrs:{id:"location指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location指令"}},[t._v("#")]),t._v(" location指令")]),t._v(" "),n("ul",[n("li",[t._v("location：设置请求的URL")]),t._v(" "),n("li",[t._v("属性介绍：")])]),t._v(" "),n("p",[t._v("✔️不带符号")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('server {\n\tlisten 80;\n\tserver_name 127.0.0.1;\n\tlocation =/abc{\n\t\tdefault_type text/plain;\n\t\treturn 200 "access success";\n\t}\n}\n只要加了abc，后面什么都可以加\nhttp://192.168.164.129/abc\nhttp://192.168.164.129/abc?p1=TOM\nhttp://192.168.164.129/abc/\nhttp://192.168.164.129/abcdef\n')])])]),n("p",[t._v("✔️带等号=")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('server {\n\tlisten 80;\n\tserver_name 127.0.0.1;\n\tlocation =/abc{\n\t\tdefault_type text/plain;\n\t\treturn 200 "access success";\n\t}\n}\n可以访问（精确访问，?相当于传参不影响）\nhttp://192.168.164.129/abc\nhttp://192.168.164.129/abc?p1=TOM\n不可以\nhttp://192.168.164.129/abc/\nhttp://192.168.164.129/abcdef\n')])])]),n("p",[t._v("✔️带正则表达式，使用~(区分大小写) 或 ~*(不区分大小写)")]),t._v(" "),n("div",{staticClass:"language-SPARQL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sparql"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tlocation ~^/abc\\w$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tdefault_type text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\treturn "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"access success"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/abc：即地址后面加/abc")]),t._v("\n\tlocation ~*^/abc\\w$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tdefault_type text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\treturn "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"access success"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("✔️带符号^~(不是正则表达式)，而==正则表达式是 ~^==，作用是如果匹配到了，就不继续找后面server(后面可能有相同的URL)")]),t._v(" "),n("h4",{attrs:{id:"设置请求资源的目录root-alias"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置请求资源的目录root-alias"}},[t._v("#")]),t._v(" 设置请求资源的目录root/alias")]),t._v(" "),n("ul",[n("li",[t._v("root：设置请求的根目录")]),t._v(" "),n("li",[t._v("alias：更改location的URL，即location后面配置的无效")])]),t._v(" "),n("p",[t._v("✔️root")]),t._v(" "),n("ul",[n("li",[t._v("默认值：html")]),t._v(" "),n("li",[t._v("位置：http、server、location")])]),t._v(" "),n("p",[t._v("✔️两者区别")]),t._v(" "),n("ol",[n("li",[t._v("root处理结果是：==root路径+location路径==")]),t._v(" "),n("li",[t._v("alias处理结果是：==alias路径替换location路径==")])]),t._v(" "),n("h4",{attrs:{id:"index指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index指令"}},[t._v("#")]),t._v(" index指令")]),t._v(" "),n("ul",[n("li",[t._v("index：设置网站默认首页\n"),n("ul",[n("li",[t._v("默认值：index.html、index.htm，从左往右找，直到找到第一个为止")])])])]),t._v(" "),n("h4",{attrs:{id:"error-page指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#error-page指令"}},[t._v("#")]),t._v(" error_page指令")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("error_page：设置网站错误页面")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("可以指定具体跳转地址：erroe_page 404 http://www.baidu.com")])]),t._v(" "),n("li",[n("p",[t._v("指定重定向地址和使用=200把状态码改掉")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    #设置错误后状态码改为200，使用=200即可,/50x.html使重定向\n    error_page 404 =200 /50x.html;\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    \troot   html;\n    }\n")])])])]),t._v(" "),n("li",[n("p",[t._v("使用location的@完成错误信息展示（等同于使用重定向展示错误信息）")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("server{\n\terror_page 404 @jump_to_error;\n\tlocation @jump_to_error {\n\t\tdefault_type text/plain;\n\t\treturn 404 'Not Found Page...';\n\t}\n}\n")])])])])])])]),t._v(" "),n("h3",{attrs:{id:"静态资源优化配置语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态资源优化配置语法"}},[t._v("#")]),t._v(" 静态资源优化配置语法")]),t._v(" "),n("p",[t._v(":happy:三个属性配置优化：一般三个都一起开")]),t._v(" "),n("div",{staticClass:"language-SPARQL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sparql"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#传输方式")]),t._v("\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不推送，即先存储")]),t._v("\n    tcp_nopush      on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#没有延迟，即实时推送")]),t._v("\n    tcp_nodelay     on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("✔️sendfile，开启高效的文件传输模式")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121113110.png",alt:"image-20211212111335833"}})]),t._v(" "),n("p",[t._v("✔️==tcp_nopush==：必须在==sendfile==打开状态下才生效，提高传输效率")]),t._v(" "),n("p",[t._v("✔️==tcp_nodelay==：必须在==keep-alive==开启下才生效，提高网络包传输的实时性")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121115350.png",alt:"image-20211212111529259"}})]),t._v(" "),n("h3",{attrs:{id:"nginx静态资源压缩实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx静态资源压缩实战"}},[t._v("#")]),t._v(" nginx静态资源压缩实战")]),t._v(" "),n("p",[t._v("nginx通过如下模块对压缩指令进行解析和处理")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("ngx_http_gzip_module模块\nngx_http_gzip_static_module模块\nngx_http_gunzip_module模块\n")])])]),n("p",[t._v("学习内容如下：")]),t._v(" "),n("ol",[n("li",[t._v("Gzip各模块支持的配置指令")]),t._v(" "),n("li",[t._v("Gzip压缩功能的配置")]),t._v(" "),n("li",[t._v("Gzip和sendfile的冲突解决")]),t._v(" "),n("li",[t._v("浏览器不支持Gzip的解决方案")])]),t._v(" "),n("h4",{attrs:{id:"gzip模块配置指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip模块配置指令"}},[t._v("#")]),t._v(" Gzip模块配置指令")]),t._v(" "),n("blockquote",[n("p",[t._v("接下来指令来自ngx_http_gzip_module模块")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("gzip指令：开启或关闭gzip功能")])]),t._v(" "),n("li",[n("p",[t._v("==gzip_types==：根据响应页的MIME类型选择性开启Gzip压缩功能")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    #选择性开启gzip压缩\n    gzip_types application/javascript;\n")])])])]),t._v(" "),n("li",[n("p",[t._v("==gzip_comp_level==：设置压缩程度，1-9，1压缩程度低，但效率高，时间少，而9相反")])]),t._v(" "),n("li",[n("p",[t._v("==gzip_vary==：告诉接收方所发送的数据经过Gzip压缩处理")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121128138.png",alt:"image-20211212112810166"}})])]),t._v(" "),n("li",[n("p",[t._v("==gzip_buffers==：处理请求压缩的缓冲区数量和大小，和服务器的操作系统有关，使用默认值即可")])]),t._v(" "),n("li",[n("p",[t._v("==gzip_disable==：针对客户端种类发起的请求，选择性开启和关闭Gzip功能")]),t._v(" "),n("ul",[n("li",[t._v('gzip_disable "~^Mozilla/5.0.*$";')])])]),t._v(" "),n("li",[n("p",[t._v("==gzip_http_version==：针对不同的HTTP协议版本，选择性开启和关闭Gzip功能，默认即可")])]),t._v(" "),n("li",[n("p",[t._v("==gzip_min_length==：对传输数据大小做要求，不能小于指定的")]),t._v(" "),n("ul",[n("li",[t._v("gzip_min_length 252874;")])])]),t._v(" "),n("li",[n("p",[t._v("==gzip_proxied==：是否对==服务器返回的结果==进行Gzip压缩，反向代理方面的")]),t._v(" "),n("ul",[n("li",[t._v("off：关闭")]),t._v(" "),n("li",[t._v('expired：header头中包含"Expires"，启用压缩')]),t._v(" "),n("li",[t._v('no-cache：header头中包含"Cache-Control:no-cache"，启用压缩')]),t._v(" "),n("li",[t._v('no-store：header头中包含"Cache-Control:no-store"，启用压缩')]),t._v(" "),n("li",[t._v('private：header头中包含"Cache-Control:private"，启用压缩')]),t._v(" "),n("li",[t._v('no_last_modified：header头中不包含"Last-Modified"，启用压缩')]),t._v(" "),n("li",[t._v('no_etag：header头中不包含"ETag"，启用压缩')]),t._v(" "),n("li",[t._v('auth：header头中包含"Authorization"，启用压缩')]),t._v(" "),n("li",[t._v("any：无条件启用压缩")])])])]),t._v(" "),n("h4",{attrs:{id:"gzip压缩功能的实例匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip压缩功能的实例匹配"}},[t._v("#")]),t._v(" Gzip压缩功能的实例匹配")]),t._v(" "),n("blockquote",[n("p",[t._v("很多地方可能用到该指令，抽取到一个配置文件中，使用的时候使用include指令")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('  \t#是否开启gzip压缩\n    gzip on;\n    #选择性开启gzip压缩\n    gzip_types application/javascript;\n    #压缩的程度，1~9，9压缩程度高，但费时间，影响效率\n    gzip_comp_level 6;\n    #告诉接收方，自己使用了gzip压缩\n    gzip_vary   on;\n    #针对不同种类客户端开启gzip，使用正则表达式\n    gzip_disable "MSIE [1-6]\\."; #对IE6以下的版本都不进行压缩\n    #设置最小压缩大小\n    gzip_min_length 252874;\n    gzip_buffers 4 16K;\t  #缓存空间大小\n    gzip_http_version 1.1; #指定压缩响应所需要的最低HTTP请求版本\n    gzip_proxied  off; #nginx作为反向代理压缩服务端返回数据的条件\n')])])]),n("h4",{attrs:{id:"gzip和sendfile共存问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip和sendfile共存问题"}},[t._v("#")]),t._v(" Gzip和sendfile共存问题")]),t._v(" "),n("blockquote",[n("p",[t._v("sendfile不经过用户进程，但是Gzip需要经过用户进程")]),t._v(" "),n("p",[t._v("解决方法：使用==ngx_gzip_static_module==模块的==gzip_static==指令解决")])]),t._v(" "),n("h5",{attrs:{id:"gzip-static指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip-static指令"}},[t._v("#")]),t._v(" gzip_static指令")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("gzip_static：检查与==访问资源同名的.gz文件==")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("默认值：off，可选on、always")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121625009.png",alt:"image-20211210220035393"}})])]),t._v(" "),n("li",[n("p",[t._v("添加上述命令后报错，找不到gzip_static，因为配置./configure没有添加")])])])])]),t._v(" "),n("h5",{attrs:{id:"添加模块到nginx的实现步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加模块到nginx的实现步骤"}},[t._v("#")]),t._v(" 添加模块到nginx的实现步骤")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("==nginx -V==")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configure --prefix=/usr/local/nginx \\\n--sbin-path=/usr/local/nginx/sbin/nginx \\\n--modules-path=/usr/local/nginx/modules \\\n--conf-path=/usr/local/nginx/conf/nginx.conf \\\n--error-log-path=/usr/local/nginx/logs/error.log \\\n--http-log-path=/usr/local/nginx/logs/access.log \\\n--pid-path=/usr/local/nginx/logs/nginx.pid \\\n--lock-path=/usr/local/nginx/logs/nginx.lock\n")])])])]),t._v(" "),n("li",[n("p",[t._v("==cd /usr/local/nginx/sbin==                ==mv nginx nginxold==：改名（相等于备份）")])]),t._v(" "),n("li",[n("p",[t._v("==cd /root/nginx/core/nginx-1.16.1==")])]),t._v(" "),n("li",[n("p",[t._v("==make clean==：清空之前编译的内容")])]),t._v(" "),n("li",[n("p",[t._v("使用configure来重新配置参数")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configure --prefix=/usr/local/nginx \\\n--sbin-path=/usr/local/nginx/sbin/nginx \\\n--modules-path=/usr/local/nginx/modules \\\n--conf-path=/usr/local/nginx/conf/nginx.conf \\\n--error-log-path=/usr/local/nginx/logs/error.log \\\n--http-log-path=/usr/local/nginx/logs/access.log \\\n--pid-path=/usr/local/nginx/logs/nginx.pid \\\n--lock-path=/usr/local/nginx/logs/nginx.lock  --with-http_gzip_static_module\n")])])])]),t._v(" "),n("li",[n("p",[t._v("make：重新编译")])]),t._v(" "),n("li",[n("p",[t._v("==mv objs/nginx /usr/local/nginx/sbin== ：把脚本移到sbin目录下")])]),t._v(" "),n("li",[n("p",[t._v("执行更新命令：==make upgrade==")]),t._v(" "),n("p",[t._v("✔️注意：有make必须在MakeFile下才能执行")])])]),t._v(" "),n("h5",{attrs:{id:"gzip-static测试使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip-static测试使用"}},[t._v("#")]),t._v(" gzip_static测试使用")]),t._v(" "),n("p",[t._v("✔️压缩前")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121631823.png",alt:"image-20211212163149810"}})]),t._v(" "),n("p",[t._v("✔️压缩后：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("cd /usr/local/nginx/html")])]),t._v(" "),n("li",[n("p",[t._v("gzip jquery.js")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121632351.png",alt:"image-20211212163231170"}})])])]),t._v(" "),n("h2",{attrs:{id:"静态资源的缓存处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态资源的缓存处理"}},[t._v("#")]),t._v(" 静态资源的缓存处理")]),t._v(" "),n("h3",{attrs:{id:"什么是缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是缓存"}},[t._v("#")]),t._v(" 什么是缓存")]),t._v(" "),n("blockquote",[n("p",[t._v("访问速度比随机存取存储器（RAM）快")])]),t._v(" "),n("h3",{attrs:{id:"什么是web缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是web缓存"}},[t._v("#")]),t._v(" 什么是web缓存")]),t._v(" "),n("blockquote",[n("p",[t._v("web资源存在于web服务器和客户端（浏览器）之间的副本，例：浏览器缓存过网站的网页，当再次访问URL地址时，直接使用本地缓存的网页")])]),t._v(" "),n("h3",{attrs:{id:"web缓存的种类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web缓存的种类"}},[t._v("#")]),t._v(" web缓存的种类")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("客户端缓存\n\t浏览器缓存\n服务端缓存\n\tNginx/Redis/Mencached等\n")])])]),n("h3",{attrs:{id:"为什么要用浏览器缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用浏览器缓存"}},[t._v("#")]),t._v(" 为什么要用浏览器缓存")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("成本最低的缓存\n减少网络带宽消耗\n降低服务器压力\n减少网络延迟，加快页面打开速度\n")])])]),n("h3",{attrs:{id:"浏览器缓存的执行流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存的执行流程"}},[t._v("#")]),t._v(" 浏览器缓存的执行流程")]),t._v(" "),n("p",[t._v("✔️和页面(header)缓存相关的字段：")]),t._v(" "),n("ul",[n("li",[t._v("Expires：缓存过期的日期和时间")]),t._v(" "),n("li",[t._v("Cache-Control：和==缓存相关的配置信息==")]),t._v(" "),n("li",[t._v("Last-Modified：资源最后修改时间")]),t._v(" "),n("li",[t._v("ETag：请求变量实体标签的的的当前值，比如文件的==MD5值==")])]),t._v(" "),n("p",[n("img",{attrs:{src:s(828),alt:"image-20211212213127899"}})]),t._v(" "),n("ol",[n("li",[t._v("第一次请求，发送request获取数据")]),t._v(" "),n("li",[t._v("服务端返回200状态码并且在响应头附上对应资源以及缓存信息")]),t._v(" "),n("li",[t._v("==再次访问==，客户端在浏览器的缓存中找资源")]),t._v(" "),n("li",[t._v("如果没有，走第二步")]),t._v(" "),n("li",[t._v("有，接下来判断是否过期，过期判断标准是Expires")]),t._v(" "),n("li",[t._v("没有==过期==，返回数据")]),t._v(" "),n("li",[t._v("过期，判断缓存是否发生变化\n"),n("ul",[n("li",[t._v("一个是ETag，一个是Last-Modified")])])]),t._v(" "),n("li",[t._v("==未发生变化，返回304==，直接从缓存取数据")]),t._v(" "),n("li",[t._v("发生变化，重新从服务端获取数据")])]),t._v(" "),n("h3",{attrs:{id:"浏览器缓存相关指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存相关指令"}},[t._v("#")]),t._v(" 浏览器缓存相关指令")]),t._v(" "),n("h4",{attrs:{id:"expires指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#expires指令"}},[t._v("#")]),t._v(" expires指令")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("==expires==：控制页面缓存，HTTP应答中的Expires和Cache-Control")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("max：Cache-Control值为10年")])]),t._v(" "),n("li",[n("p",[t._v("time：负数，Cache-Control值为no-cache，整数，值为对应的整数")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142240383.png",alt:"image-20211213100531204"}})])])])])]),t._v(" "),n("h4",{attrs:{id:"add-header指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#add-header指令"}},[t._v("#")]),t._v(" add_header指令")]),t._v(" "),n("ul",[n("li",[t._v("指定响应头和响应值\n"),n("ol",[n("li",[t._v("must-revalidate：可缓存但必须向服务器进行确认")]),t._v(" "),n("li",[t._v("no-cache：缓存前确认有效性")]),t._v(" "),n("li",[t._v("==no-store==：不缓存任何")]),t._v(" "),n("li",[t._v("no-transform：不可更改")]),t._v(" "),n("li",[t._v("public：任意都缓存")]),t._v(" "),n("li",[t._v("private：指定用户缓存")]),t._v(" "),n("li",[t._v("proxy-revalidate：中间服务器对响应再进行确认")]),t._v(" "),n("li",[t._v("max-age=<秒>：响应最大Age值")]),t._v(" "),n("li",[t._v("s-maxage=<秒>：公共缓存服务器响应的最大Age值")])])])]),t._v(" "),n("h2",{attrs:{id:"nginx的跨域问题解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的跨域问题解决"}},[t._v("#")]),t._v(" Nginx的跨域问题解决")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("什么情况下出现跨域问题？\n实例演示跨域问题\n具体的解决方案是什么？\n")])])]),n("h3",{attrs:{id:"同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),n("p",[t._v(":happy:浏览器的一种约定，最核心最基本的安全功能，同源：==协议、域名（IP）、端口相同==即为同源")]),t._v(" "),n("ul",[n("li",[t._v("http和https：不")]),t._v(" "),n("li",[t._v("192.168.164.129和192.168.164.128：不")]),t._v(" "),n("li",[t._v("192.168.164.129和192.168.164.128:8080：不。不写默认是80端口，80和8080端口不一样")]),t._v(" "),n("li",[t._v("192.168.164.129和192.168.164.128:80：是")])]),t._v(" "),n("h3",{attrs:{id:"跨域问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[t._v("#")]),t._v(" 跨域问题")]),t._v(" "),n("p",[t._v(":happy:简单描述：两台服务器A、B，==服务器A的页面发送异步请求服务器B的数据==，如果A和B不满足同源策略，则出现跨域问题")]),t._v(" "),n("h3",{attrs:{id:"跨域问题的案例演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题的案例演示"}},[t._v("#")]),t._v(" 跨域问题的案例演示")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142253813.png",alt:"image-20211214225327393"}})]),t._v(" "),n("ol",[n("li",[n("p",[t._v("nginx的html目录下创建a.html")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("utf-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("跨域问题演示"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         //这里可能要改\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("jquery.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#btn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.164.129:8080/getUser'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("获取数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("btn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])])]),t._v(" "),n("li",[n("p",[t._v("nginx.conf配置")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("getUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                default_type application"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性一定要加双引号")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"id":1,"name":"TOM","age":18}\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("浏览器访问测试")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142302487.png",alt:"image-20211214230240507"}})])])]),t._v(" "),n("h3",{attrs:{id:"解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),n("p",[t._v("✔️使用add_header指令添加一些头信息")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("解决跨域问题的两个头信息")]),t._v(" "),n("ul",[n("li",[t._v("==Access-Control-Allow-Origin==：允许跨域，多个逗号分隔，使用*代表所有源")]),t._v(" "),n("li",[t._v("==Access-Control-Allow-Methods==：允许跨域访问的请求方式，值为POST(增)、DELETE(删)、PUT(改)、GET(查)")])])]),t._v(" "),n("li",[n("p",[t._v("具体配置")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("getUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    add_header Access"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Methods "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type application"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"id":1,"name":"TOM","age":18}\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"静态资源防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态资源防盗链"}},[t._v("#")]),t._v(" 静态资源防盗链")]),t._v(" "),n("h3",{attrs:{id:"什么是资源盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是资源盗链"}},[t._v("#")]),t._v(" 什么是资源盗链")]),t._v(" "),n("blockquote",[n("p",[t._v("资源盗链指内容不在自己服务器上，盗取大网站空间和流量，==用别人的东西成就自己的网站==")])]),t._v(" "),n("p",[t._v("从下图可知：百度防止盗链，而京东没有")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142310403.png",alt:"image-20211214231002999"}})]),t._v(" "),n("h3",{attrs:{id:"nginx防盗链的实现原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx防盗链的实现原理"}},[t._v("#")]),t._v(" Nginx防盗链的实现原理")]),t._v(" "),n("p",[t._v("✔️HTTP的头信息Referer，告诉浏览器该网页从哪个页面链接过来的")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142311478.png",alt:"image-20211214231134043"}})]),t._v(" "),n("p",[t._v(":happy:如果是自己==信任的网站地址，放行，否则返回403（服务器拒绝访问）==的状态信息")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142313493.png",alt:"image-20211214231310122"}})]),t._v(" "),n("ul",[n("li",[n("p",[t._v("防盗链的具体实现：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("valid_referers：查看referer和自己定义的内容是否匹配，匹配到==valid-referers值置为0，否则为1==")])]),t._v(" "),n("li",[n("p",[t._v("none：referer为空，允许访问")])]),t._v(" "),n("li",[n("p",[t._v("blocked：不带http://、https://等协议允许访问")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181724209.png",alt:"image-20211218172409194"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181724772.png",alt:"image-20211218172426750"}})])])])])]),t._v(" "),n("h3",{attrs:{id:"针对目录进行防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#针对目录进行防盗链"}},[t._v("#")]),t._v(" 针对目录进行防盗链")]),t._v(" "),n("p",[t._v("✔️配置如下")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("        #防盗链问题\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("images "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                valid_referers none blocked www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" $invalid_referer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("✔️问题：")]),t._v(" "),n("ul",[n("li",[t._v("referer的限制比较粗鲁")]),t._v(" "),n("li",[t._v("解决方法，使用nginx的第三方模块==ngx_http_accesskey_module==")])]),t._v(" "),n("h2",{attrs:{id:"rewrite功能配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite功能配置"}},[t._v("#")]),t._v(" Rewrite功能配置")]),t._v(" "),n("blockquote",[n("p",[t._v("实现URL的重写")]),t._v(" "),n("p",[t._v("注意：rewrite功能依赖于==PCRE==的支持，nginx使用==ngx_http_rewrite_module==模块来解析和处理Rewrite功能的相关配置")])]),t._v(" "),n("h3",{attrs:{id:"地址重写-与-地址转发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#地址重写-与-地址转发"}},[t._v("#")]),t._v(" “地址重写”与“地址转发”")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("重写==地址==会发生变化，转发不会")])]),t._v(" "),n("li",[n("p",[t._v("重写产生==两次==请求，而转发一次请求")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181732331.png",alt:"image-20211218173251412"}})])]),t._v(" "),n("li",[n("p",[t._v("重写的页面必须是一个==完整的路径==，而转发不需要")])]),t._v(" "),n("li",[n("p",[t._v("重写request范围内属性==不能传递给新页面，==而转发可以传递值")])]),t._v(" "),n("li",[n("p",[t._v("转发==速度==快于重写")])])]),t._v(" "),n("h3",{attrs:{id:"rewrite规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite规则"}},[t._v("#")]),t._v(" Rewrite规则")]),t._v(" "),n("h3",{attrs:{id:"set指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#set指令"}},[t._v("#")]),t._v(" set指令")]),t._v(" "),n("blockquote",[n("p",[t._v("设置一个新的变量")])]),t._v(" "),n("ul",[n("li",[t._v("例：==set $name zhangsan==;")])]),t._v(" "),n("h3",{attrs:{id:"rewrite常用全局变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite常用全局变量"}},[t._v("#")]),t._v(" Rewrite常用全局变量")]),t._v(" "),n("p",[t._v("✔️前面都加$")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("变量")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("$==args==")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("存放请求路径的参数，192.168.164.129:8081/server?a1=2&a2=3，其中的a1=2&a2=3")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("http_user_agent")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("记录浏览器的相关版本信息")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("==host==")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("服务器的server_name")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("document_uri")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("URI地址")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("document_root")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("对应location的root值，未设置，默认是nginx自带的html位置")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("content_length")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("请求头中的content_length")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("http_cookie")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("客户端的cookie信息")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("limit_rate")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("服务器对网络连接速率的限制，默认0，不限制")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("remote_addr")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("客户端的IP地址")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("remote_port")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("客户端与服务器端连接的端口号")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("remote_user")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("客户端的用户名")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("scheme")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("访问协议")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("server_addr")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("服务端地址")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("server_name")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("服务器的名称")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("server_port")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("服务器的端口号")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("server_protocol")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("版本，例”HTTP/1.1“")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("request_body_file")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("本地文件资源的名称")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("==request_method==")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("客户端的请求方式，比如：GET、POST等")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("request_filename")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("当前请求资源文件的路径名")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("==request_uri==")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("当前请求的URI，即全部路径192.168.164.129:8081/server?a1=2&a2=3")])])])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181754705.png",alt:"image-20211218175430634"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181754247.png",alt:"image-20211218175439240"}})]),t._v(" "),n("h3",{attrs:{id:"if指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#if指令"}},[t._v("#")]),t._v(" if指令")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("变量名，值为空或者是0为false，其它为true")]),t._v(" "),n("div",{staticClass:"language-csharp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("===和!===比较变量和字符串是否相等，满足条件为true，不满足为false，注意字符串不需要引号")]),t._v(" "),n("div",{staticClass:"language-csharp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token preprocessor property"}},[t._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("if")]),t._v("语句括号和if之间有空格")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request_method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("405")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("使用cmd发送post请求：==curl -X POST 地址==")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181910095.png",alt:"image-20211212213135963"}})])])]),t._v(" "),n("ol",[n("li",[n("p",[t._v('使用正则表达式对变量进行匹配，用"~","~ * ","!~","!~*"')]),t._v(" "),n("ul",[n("li",[n("p",[t._v("~：区分大小写")])]),t._v(" "),n("li",[n("p",[t._v("~*：不区分大小写")])]),t._v(" "),n("li",[n("p",[t._v("!~，!~*：取反")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    #加*不区分大小写\n    if ($http_user_agent ~* safari){\n    \treturn 200 Chrome;\n    }\n")])])])])])]),t._v(" "),n("li",[n("p",[t._v("判断请求的==文件==是否存在：-f和!-f")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #查找是否存在这个文件，找目录是"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f $request_filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1> file not found</h1>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("判断==目录==是否存在：-d和!-d")])]),t._v(" "),n("li",[n("p",[t._v("判断==目录或者文件==是否存在：-e和!-e")])]),t._v(" "),n("li",[n("p",[t._v("判断文件是否可执行：-x和!-x")])])]),t._v(" "),n("h3",{attrs:{id:"break指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#break指令"}},[t._v("#")]),t._v(" break指令")]),t._v(" "),n("blockquote",[n("p",[t._v("中断指令，位于他前面的生效，后面不生效")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("        #测试"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("testbreak "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" $username "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'luo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" $username "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zhangsan'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" $username "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lisi'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                add_header username $username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h3",{attrs:{id:"return指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#return指令"}},[t._v("#")]),t._v(" return指令")]),t._v(" "),n("blockquote",[n("p",[t._v("完成对请求的处理，直接向客户端返回响应的状态代码")])]),t._v(" "),n("ul",[n("li",[t._v("code：状态码0-999")]),t._v(" "),n("li",[t._v("text：内容")]),t._v(" "),n("li",[t._v("URL：地址")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("        #测试"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("testreturn "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.baidu.com/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"rewrite指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite指令"}},[t._v("#")]),t._v(" rewrite指令")]),t._v(" "),n("p",[t._v("✔️URL和URI的区别：")]),t._v(" "),n("ul",[n("li",[t._v("URI：统一资源标识符identifier")]),t._v(" "),n("li",[t._v("URL：统一资源定位符location")])]),t._v(" "),n("p",[t._v("✔️语法：")]),t._v(" "),n("ul",[n("li",[t._v("rewrite regex replacement [flag]\n"),n("ul",[n("li",[t._v("regex：匹配URI的正则表达式")]),t._v(" "),n("li",[t._v("replacement ：替换URI中的字符串，如果该字符串是==以http或https开头的，直接返回该字符串==，下面不管")])])])]),t._v(" "),n("p",[t._v("✔️flag：")]),t._v(" "),n("ol",[n("li",[t._v("last：和正常请求一样")]),t._v(" "),n("li",[t._v("break：中断")]),t._v(" "),n("li",[t._v("redirect：==重定向，地址发送变化，两次请求==")]),t._v(" "),n("li",[t._v("permanent：永久重定向")])]),t._v(" "),n("p",[t._v("✔️状态码：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("301：永久重定向")])]),t._v(" "),n("li",[n("p",[t._v("302：临时重定向")]),t._v(" "),n("p",[n("img",{attrs:{src:s(829),alt:"image-20211216214902553"}})])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("        #测试rewrite\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rewrite "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                #开启重写日志的记录\n                rewrite_log on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                error_log logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                #地址重写，永久重写"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v("，临时重写"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v("\n                rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("url\\w"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("$ https"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\w"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1 permanent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("demo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\w"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1 permanent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test success'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'demo success'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"rewrite-log指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite-log指令"}},[t._v("#")]),t._v(" rewrite_log指令")]),t._v(" "),n("blockquote",[n("p",[t._v("是否开启URL重写==日志的输出功能==，开启后，相关日志将以==notice==级别输出")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    #开启重写日志的记录\n    rewrite_log on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"rewrite的案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite的案例"}},[t._v("#")]),t._v(" Rewrite的案例")]),t._v(" "),n("h3",{attrs:{id:"域名跳转和域名镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#域名跳转和域名镜像"}},[t._v("#")]),t._v(" 域名跳转和域名镜像")]),t._v(" "),n("p",[t._v("例www.jd.com，www.360buy.com两个都能访问京东网站")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("准备两个域名")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("vim /etc/hosts\n127.0.0.1 www.luo.com\n127.0.0.1 www.luomu.com\n")])])])]),t._v(" "),n("li",[n("p",[t._v("配置如下：两个server，==监听端口号一样==")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>welcome to luo</h1>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itheima"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #不携带"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URI")]),t._v("\n        #rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("www.itcast.cn")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #携带"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URI")]),t._v("\n        #rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #镜像，即只提供user模块跳转\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                #域名跳转\n                rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("emp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>employee success</h1>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"独立域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立域名"}},[t._v("#")]),t._v(" 独立域名")]),t._v(" "),n("p",[t._v("✔️独立域名和镜像区分：==镜像是某个功能模块==，只允许某个功能访问，而==独立域名==是每个功能都有自己的地址，端口号也是80，和后面http://www.itcast.cn保持一致")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    #独立域名\n    server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name search"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("luo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rewrite "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("search$1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"目录自动添加"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目录自动添加"}},[t._v("#")]),t._v(" 目录自动添加”/“")]),t._v(" "),n("p",[t._v(":happy:问题描述：")]),t._v(" "),n("p",[t._v("直接访问：http://192.168.164成功，没有目录，和/无关")]),t._v(" "),n("div",{staticClass:"language-scala extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scala"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tlocation "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\troot html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tindex index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("修改如下配置：")]),t._v(" "),n("div",{staticClass:"language-csharp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("server_name")]),t._v(" localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tlocation "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("root")]),t._v(" html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tindex index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("访问http://192.168.164/luo失败，因为没有加/，访问成localhost，不是192.168.164.129，==加/会做301==永久重定向，访问成功")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112182257216.png",alt:"image-20211218215007222"}})]),t._v(" "),n("p",[t._v("✔️==server_name_in_redirect==：控制是否自动加/，nginx0.8.48之前版本默认没自动加，即on，之后版本改为off，自动加")]),t._v(" "),n("div",{staticClass:"language-powershell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[t._v("    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 8083"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启不自动末尾加/")]),t._v("\n        server_name_in_redirect on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置让他自动加/")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#每一个参数后面想使用，得加()，加([^/])是因为后面没有/才加，有就匹配失败")]),t._v("\n                        rewrite ^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ http:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"合并目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#合并目录"}},[t._v("#")]),t._v(" 合并目录")]),t._v(" "),n("p",[t._v("✔️快速创建index.html")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112182256017.png",alt:"image-20211218215002294"}})]),t._v(" "),n("p",[t._v("访问http://192.168.164.129/server/11/22/33/44/20.html，太长，不利于SEO搜索引擎优化")]),t._v(" "),n("div",{staticClass:"language-powershell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#合并目录")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 8085"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                index index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#\\.html中的\\.是转义.")]),t._v("\n                rewrite ^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server-"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html$ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server/"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("优化可以直接访问http://192.168.164.129/server/11-22-33-44-20.html")]),t._v(" "),n("h3",{attrs:{id:"防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防盗链"}},[t._v("#")]),t._v(" 防盗链")]),t._v(" "),n("blockquote",[n("p",[t._v("使用rewrite给个图片友好提示")])]),t._v(" "),n("p",[t._v("✔️注意：==一般rewrite后面地址开头要加/==，除非是http://开头")]),t._v(" "),n("p",[n("img",{attrs:{src:s(830),alt:"image-20211218214957203"}})]),t._v(" "),n("div",{staticClass:"language-powershell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[t._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#防盗链问题")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("images "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                valid_referers none blocked www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#return 403;")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#友好提示跳转")]),t._v("\n                        rewrite ^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("images/daotu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jpg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h1",{attrs:{id:"nginx反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理"}},[t._v("#")]),t._v(" nginx反向代理")]),t._v(" "),n("h2",{attrs:{id:"nginx反向代理概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理概述"}},[t._v("#")]),t._v(" nginx反向代理概述")]),t._v(" "),n("blockquote",[n("p",[t._v("反向代理：服务端")]),t._v(" "),n("p",[t._v("正向代理：客户端（保护客户）")])]),t._v(" "),n("p",[t._v("✔️正向代理案例：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("代理服务器设置：")]),t._v(" "),n("div",{staticClass:"language-powershell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen  82"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        resolver 8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252141033.png",alt:"image-20220125213023782"}})])]),t._v(" "),n("li",[n("p",[t._v("客户端配置代理服务器")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252139807.png",alt:"image-20220125213944225"}})])])]),t._v(" "),n("h2",{attrs:{id:"nginx反向代理的配置语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理的配置语法"}},[t._v("#")]),t._v(" nginx反向代理的配置语法")]),t._v(" "),n("blockquote",[n("p",[t._v("ngx_http_proxy_module，安装nginx自动装好")])]),t._v(" "),n("h3",{attrs:{id:"proxy-pass"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass"}},[t._v("#")]),t._v(" proxy_pass")]),t._v(" "),n("blockquote",[n("p",[t._v("设置代理服务器地址，位置location")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252201039.png",alt:"image-20220125212957953"}})]),t._v(" "),n("h3",{attrs:{id:"proxy-set-header"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-set-header"}},[t._v("#")]),t._v(" proxy_set_header")]),t._v(" "),n("blockquote",[n("p",[t._v("更改服务器接收到客户端请求的请求头信息，代理将客户的头信息修改后再给服务器")])]),t._v(" "),n("h3",{attrs:{id:"proxy-redirect"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-redirect"}},[t._v("#")]),t._v(" proxy_redirect")]),t._v(" "),n("blockquote",[n("p",[t._v("重置头信息中的location和refresh")])]),t._v(" "),n("h2",{attrs:{id:"nginx反向代理实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理实战"}},[t._v("#")]),t._v(" Nginx反向代理实战")]),t._v(" "),n("ul",[n("li",[t._v("服务器存在两种情况\n"),n("ul",[n("li",[t._v("内容不一样\n"),n("ul",[n("li",[t._v("根据用户请求分发到不同服务器")])])]),t._v(" "),n("li",[t._v("内容一样\n"),n("ul",[n("li",[t._v("SSL")])])])])])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201260858890.png",alt:"image-20220126085803214"}})]),t._v(" "),n("div",{staticClass:"language-SAS extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sas"}},[n("code",[t._v("代理服务器\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name     localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200.146")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200.146")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9002")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200.146")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9003")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n服务端\nserver1\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name     localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>192.168.200.146:9001</h1>'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver2\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name     localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>192.168.200.146:9002</h1>'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver3\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9003")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name     localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        default_type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>192.168.200.146:9003</h1>'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"nginx的安全控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的安全控制"}},[t._v("#")]),t._v(" Nginx的安全控制")]),t._v(" "),n("blockquote",[n("p",[t._v("安全隔离：设置防火墙，仅留一个入口给代理服务器")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201260919113.png",alt:"image-20220126091925076"}})]),t._v(" "),n("h3",{attrs:{id:"如何使用ssl对流量进行加密"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用ssl对流量进行加密"}},[t._v("#")]),t._v(" 如何使用SSL对流量进行加密")]),t._v(" "),n("blockquote",[n("p",[t._v("https：有SSL外壳的http")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("原理：")]),t._v(" "),n("ul",[n("li",[t._v("经由HTTP进行通信")]),t._v(" "),n("li",[t._v("利用SSL/TLS建立全通信\n"),n("ul",[n("li",[t._v("SSL：安全套接层")]),t._v(" "),n("li",[t._v("TLS：传输层安全")])])])])]),t._v(" "),n("li",[n("p",[t._v("总结：")]),t._v(" "),n("blockquote",[n("p",[t._v("https：加密传输，相当于http+ssl，防止流量劫持")])])])]),t._v(" "),n("h4",{attrs:{id:"nginx添加ssl的支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx添加ssl的支持"}},[t._v("#")]),t._v(" nginx添加SSL的支持")]),t._v(" "),n("blockquote",[n("p",[t._v("nginx使用条件：--with-http-ssl_module+OpenSSL")])]),t._v(" "),n("p",[t._v("添加模块")]),t._v(" "),n("ol",[n("li",[t._v("将/sbin/nginx备份")]),t._v(" "),n("li",[t._v("==nginx -V==：获取nginx的配置信息")]),t._v(" "),n("li",[t._v("在nginx的安装源码目录下进行：==./configure 获取到的信息 --with-http_ssl_module==")]),t._v(" "),n("li",[t._v("==make==：编译")]),t._v(" "),n("li",[t._v("拷贝objs的nginx到/usr/local/nginx/sbin")]),t._v(" "),n("li",[t._v("==make upgrade==：平滑升级，不停机")])]),t._v(" "),n("h4",{attrs:{id:"nginx的ssl相关指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的ssl相关指令"}},[t._v("#")]),t._v(" nginx的SSL相关指令")]),t._v(" "),n("ol",[n("li",[t._v("listen ：443 ssl，默认占用443端口")]),t._v(" "),n("li",[t._v("ssl_certificate：PEM格式的证书路径")]),t._v(" "),n("li",[t._v("ssl_certificate_key：PEM secret key路径")]),t._v(" "),n("li",[t._v("ssl_sesion_cache：SSL会话的缓存\n"),n("ul",[n("li",[t._v("off：禁用")]),t._v(" "),n("li",[t._v("none：禁用")]),t._v(" "),n("li",[t._v("builtin：仅在一个工作进程使用")]),t._v(" "),n("li",[t._v("shared：所有工作进程共享缓存")])])]),t._v(" "),n("li",[t._v("ssl_session_timeout：缓存时间")]),t._v(" "),n("li",[t._v("ssl_ciphers：密码格式要求")]),t._v(" "),n("li",[t._v("ssl_prefer_server_ciphers：服务器密码是否优先客户端密码")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201261418247.png",alt:"image-20220126141839863"}})]),t._v(" "),n("h4",{attrs:{id:"生成证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[t._v("#")]),t._v(" 生成证书")]),t._v(" "),n("p",[t._v("✔️方法一：阿里云/腾讯云等第三方服务购买")]),t._v(" "),n("p",[t._v("✔️方法二：openssl生成证书")]),t._v(" "),n("ol",[n("li",[t._v("查看是否安装openssl：==openssl version==")]),t._v(" "),n("li",[t._v("mkdir /root/cert")]),t._v(" "),n("li",[t._v("cd /root/cert")]),t._v(" "),n("li",[t._v("openssl genrsa -des3 -out server.key 1024")]),t._v(" "),n("li",[t._v("openssl req -new -key server.key -out server.csr")]),t._v(" "),n("li",[t._v("cp server.key server.key.org")]),t._v(" "),n("li",[t._v("openssl rsa -in server.key.org -out server.key")]),t._v(" "),n("li",[t._v("openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201261736205.png",alt:"image-20220126144043244"}})]),t._v(" "),n("h4",{attrs:{id:"开启ssl实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启ssl实例"}},[t._v("#")]),t._v(" 开启SSL实例")]),t._v(" "),n("div",{staticClass:"language-less extra-class"},[n("pre",{pre:!0,attrs:{class:"language-less"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("server")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       443 ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ssl_certificate      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cert"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server.crt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cert"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ssl_session_cache    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("shared")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("SSL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_session_timeout  5m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ssl_ciphers  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("HIGH")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("!"),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("aNULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("!MD5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_prefer_server_ciphers  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"反向代理系统调优"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#反向代理系统调优"}},[t._v("#")]),t._v(" 反向代理系统调优")]),t._v(" "),n("blockquote",[n("p",[t._v("缓冲和缓存")])]),t._v(" "),n("ul",[n("li",[t._v("相同点：\n"),n("ul",[n("li",[t._v("IO吞吐效率，提升nginx代理的性能")])])]),t._v(" "),n("li",[t._v("不同点：\n"),n("ul",[n("li",[t._v("缓冲：解决不同设备之间==数据传递==速度导致性能问题")]),t._v(" "),n("li",[t._v("缓存：备份，客户端获取相同数据，从代理服务器获取，效率高")])])])]),t._v(" "),n("p",[t._v("✔️相关指令：")]),t._v(" "),n("ul",[n("li",[t._v("proxy_buffering：开启或者关闭代理服务器的缓冲区")]),t._v(" "),n("li",[t._v("proxy_buffers：==缓存区==的个数和大小")]),t._v(" "),n("li",[t._v("proxy_buffer_size：保持和proxy_buffers中的size一致即可")]),t._v(" "),n("li",[t._v("proxy_busy_buffers_size：处于BUSY状态的缓冲总大小")]),t._v(" "),n("li",[t._v("proxy_temp_path：缓冲区满，临时存放在磁盘文件上")]),t._v(" "),n("li",[t._v("proxy_temp_file_write_size：磁盘缓冲文件的大小")])]),t._v(" "),n("p",[t._v("✔️通用网站的配置")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("proxy_buffering on;\nproxy_buffer_size 4 32k;\nproxy_busy_buffers_size 64k;\nproxy_temp_file_write_size 64k;\n")])])]),n("h1",{attrs:{id:"nginx负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx负载均衡"}},[t._v("#")]),t._v(" nginx负载均衡")]),t._v(" "),n("h2",{attrs:{id:"负载均衡概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡概述"}},[t._v("#")]),t._v(" 负载均衡概述")]),t._v(" "),n("blockquote",[n("p",[t._v("将客户请求均衡发给服务器")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262154272.png",alt:"image-20220126215401228"}})]),t._v(" "),n("h2",{attrs:{id:"负载均衡的原理及处理流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡的原理及处理流程"}},[t._v("#")]),t._v(" 负载均衡的原理及处理流程")]),t._v(" "),n("blockquote",[n("p",[t._v("纵向扩展：硬件能力")]),t._v(" "),n("p",[t._v("横向扩展：添加服务器")])]),t._v(" "),n("p",[t._v("✔️两个角色：")]),t._v(" "),n("ul",[n("li",[t._v("应用集群：同一应用部署多台机器")]),t._v(" "),n("li",[t._v("负载均衡器：通过算法，分发到集群中的一个服务器（机器）")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262158968.png",alt:"image-20220126215821538"}})]),t._v(" "),n("h3",{attrs:{id:"负载均衡的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡的作用"}},[t._v("#")]),t._v(" 负载均衡的作用")]),t._v(" "),n("ol",[n("li",[t._v("高并发性")]),t._v(" "),n("li",[t._v("高可用性，故障转移")]),t._v(" "),n("li",[t._v("可扩展性，添加服务器")]),t._v(" "),n("li",[t._v("安全性，负载均衡器上进行过滤")])]),t._v(" "),n("h2",{attrs:{id:"负载均衡常用的处理方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡常用的处理方式"}},[t._v("#")]),t._v(" 负载均衡常用的处理方式")]),t._v(" "),n("h3",{attrs:{id:"方式一-用户手动选择"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式一-用户手动选择"}},[t._v("#")]),t._v(" 方式一：用户手动选择")]),t._v(" "),n("blockquote",[n("p",[t._v("网站提供不同线路、不同服务器链接方式，用户选择")])]),t._v(" "),n("p",[n("img",{attrs:{src:s(831),alt:"image-20220126220723859"}})]),t._v(" "),n("h3",{attrs:{id:"方式二-dns轮询方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式二-dns轮询方式"}},[t._v("#")]),t._v(" 方式二：DNS轮询方式")]),t._v(" "),n("blockquote",[n("p",[t._v("域名和IP")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262214122.png",alt:"image-20220126221408993"}})]),t._v(" "),n("ul",[n("li",[t._v("清除本地的dns缓存：ipconfig/flushdns")]),t._v(" "),n("li",[t._v("缺点：\n"),n("ul",[n("li",[t._v("可靠性低")]),t._v(" "),n("li",[t._v("负载均衡不均衡（轮询）")])])])]),t._v(" "),n("h3",{attrs:{id:"方式三-四-七层负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式三-四-七层负载均衡"}},[t._v("#")]),t._v(" 方式三：四/七层负载均衡")]),t._v(" "),n("blockquote",[n("p",[t._v("OSI（open system interconnection）：开放式系统互联模型，网络体系结构")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201272007397.png",alt:"image-20220127200737911"}})]),t._v(" "),n("ol",[n("li",[t._v("应用层：提供网络给应用")]),t._v(" "),n("li",[t._v("表示层：数据格式化、编码、加密、压缩等")]),t._v(" "),n("li",[t._v("会话层：会话连接")]),t._v(" "),n("li",[t._v("传输层：端到端连接，例TCP/UDP")]),t._v(" "),n("li",[t._v("网络层：IP寻址和路由选择")]),t._v(" "),n("li",[t._v("数据链路层：控制网络层和物理层的通信")]),t._v(" "),n("li",[t._v("物理层：比特流传输")])]),t._v(" "),n("p",[t._v("✔️四层负载：OSI中的传输层，基于IP+PROT（port）的负载均衡")]),t._v(" "),n("ul",[n("li",[t._v("硬件：F5（十几w）、BIG-IP、Radware等")]),t._v(" "),n("li",[t._v("软件：LVS、Nginx、Hayproxy等")])]),t._v(" "),n("p",[t._v("✔️七层负载：OSI中的应用层，基于虚拟的URL或主机IP的负载均衡")]),t._v(" "),n("ul",[n("li",[t._v("软件：nignx、Hayproxy等")])]),t._v(" "),n("p",[t._v("✔️区别：")]),t._v(" "),n("ul",[n("li",[t._v("数据：四层底层分（效率高），七层最顶端分发")]),t._v(" "),n("li",[t._v("域名：七层识别域名，四层不识别")])]),t._v(" "),n("p",[t._v("✔️实际使用：四层负载（LVS）+七层负载（Nginx）")]),t._v(" "),n("h2",{attrs:{id:"nginx七层负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx七层负载均衡"}},[t._v("#")]),t._v(" nginx七层负载均衡")]),t._v(" "),n("blockquote",[n("p",[t._v("模块：proxy_pass")])]),t._v(" "),n("h3",{attrs:{id:"nginx七层负载均衡的指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx七层负载均衡的指令"}},[t._v("#")]),t._v(" nginx七层负载均衡的指令")]),t._v(" "),n("h4",{attrs:{id:"upstream指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upstream指令"}},[t._v("#")]),t._v(" upstream指令")]),t._v(" "),n("blockquote",[n("p",[t._v("定义一组服务器，监听不同服务器（TCP、Unix socket等）")])]),t._v(" "),n("h4",{attrs:{id:"server指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#server指令"}},[t._v("#")]),t._v(" server指令")]),t._v(" "),n("blockquote",[n("p",[t._v("指定服务器的名称")]),t._v(" "),n("ul",[n("li",[t._v("域名、IP、端口或者unix socket")])])]),t._v(" "),n("h3",{attrs:{id:"nginx七层负载均衡的实现流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx七层负载均衡的实现流程"}},[t._v("#")]),t._v(" nginx七层负载均衡的实现流程")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280823433.png",alt:"image-20220128082356409"}})]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("    upstream backend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#登录后，访问的还是需要登录的服务器")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ip_hash;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#请求给连接次数较少的服务器")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#least_conn;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#请求资源，有缓存的服务器")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#hash $request_uri;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#fair：智能化把请求给需要的服务器")]),t._v("\n        fair;\n        server 192.168.164.129"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9001;\n        server 192.168.164.129"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9002;\n        server 192.168.164.129"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9003;\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 8083;\n        server_name localhost;\n        location /"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \tproxy_pass http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//backend;\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"负载均衡状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡状态"}},[t._v("#")]),t._v(" 负载均衡状态")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("状态")]),t._v(" "),n("th",[t._v("概述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("down")]),t._v(" "),n("td",[t._v("不参与")])]),t._v(" "),n("tr",[n("td",[t._v("backup")]),t._v(" "),n("td",[t._v("备份")])]),t._v(" "),n("tr",[n("td",[t._v("max_fails")]),t._v(" "),n("td",[t._v("请求失败的次数")])]),t._v(" "),n("tr",[n("td",[t._v("fail_timeouts")]),t._v(" "),n("td",[t._v("最大失败次数后，服务暂停时间")])]),t._v(" "),n("tr",[n("td",[t._v("max_conns")]),t._v(" "),n("td",[t._v("最大连接数")])])])]),t._v(" "),n("h4",{attrs:{id:"down"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#down"}},[t._v("#")]),t._v(" down")]),t._v(" "),n("blockquote",[n("p",[t._v("服务器不可用，停机维护")])]),t._v(" "),n("h4",{attrs:{id:"backup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backup"}},[t._v("#")]),t._v(" backup")]),t._v(" "),n("blockquote",[n("p",[t._v("主服务器不可用")])]),t._v(" "),n("h4",{attrs:{id:"max-conns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#max-conns"}},[t._v("#")]),t._v(" max_conns")]),t._v(" "),n("blockquote",[n("p",[t._v("最大请求数，防止服务器压跨")])]),t._v(" "),n("h4",{attrs:{id:"max-fails和fail-timeout"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#max-fails和fail-timeout"}},[t._v("#")]),t._v(" max_fails和fail_timeout")]),t._v(" "),n("blockquote",[n("p",[t._v("请求失败次数，次数后服务暂停时间")])]),t._v(" "),n("h3",{attrs:{id:"负载均衡策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[t._v("#")]),t._v(" 负载均衡策略")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("算法")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("轮询")]),t._v(" "),n("td",[t._v("默认")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("weight")]),t._v(" "),n("td",[t._v("权重")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("ip_hash")]),t._v(" "),n("td",[t._v("ip")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("least_conn")]),t._v(" "),n("td",[t._v("最少连接")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("url_hash")]),t._v(" "),n("td",[t._v("URL")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("fair")]),t._v(" "),n("td",[t._v("响应时间")])])])]),t._v(" "),n("h4",{attrs:{id:"轮询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#轮询"}},[t._v("#")]),t._v(" 轮询")]),t._v(" "),n("blockquote",[n("p",[t._v("平均分配请求，概率一样")])]),t._v(" "),n("h4",{attrs:{id:"weight【加权轮询】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#weight【加权轮询】"}},[t._v("#")]),t._v(" weight【加权轮询】")]),t._v(" "),n("blockquote",[n("p",[t._v("有比例分配请求，概率不一样")])]),t._v(" "),n("h4",{attrs:{id:"ip-hash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash"}},[t._v("#")]),t._v(" ip_hash")]),t._v(" "),n("blockquote",[n("p",[t._v("用户登录，保证下次登录还是在同一个服务器，因为登录信息在该服务器")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280837147.png",alt:"image-20220126205513751"}})]),t._v(" "),n("h4",{attrs:{id:"least-conn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#least-conn"}},[t._v("#")]),t._v(" least_conn")]),t._v(" "),n("blockquote",[n("p",[t._v("把请求给连接少的")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280839751.png",alt:"image-20220128083902712"}})]),t._v(" "),n("h4",{attrs:{id:"url-hash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#url-hash"}},[t._v("#")]),t._v(" url_hash")]),t._v(" "),n("blockquote",[n("p",[t._v("请求资源，资源缓存在服务器，下次请求相同资源，保证去同一个服务器，因为服务器有资源的缓存")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280839544.png",alt:"image-20220128083945142"}})]),t._v(" "),n("h4",{attrs:{id:"fair"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fair"}},[t._v("#")]),t._v(" fair")]),t._v(" "),n("blockquote",[n("p",[t._v("根据页码大小、加载时间长短")]),t._v(" "),n("p",[t._v("添加nginx-upstream-fair模块")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("下载地址：https://github.com/gnosek/nginx-upstream-fair")])]),t._v(" "),n("li",[n("p",[t._v("unzip nginx-upstream-fair-master.zip")])]),t._v(" "),n("li",[n("p",[t._v("./configure --add-module=/root/fair")])]),t._v(" "),n("li",[n("p",[t._v("make")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("报错：因为ngx_http_upstream_srv_conf缺少default_port")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281130763.png",alt:"image-20220128113037964"}})])]),t._v(" "),n("li",[n("p",[t._v("解决方案：")]),t._v(" "),n("ul",[n("li",[t._v("nginx源码src目录下：vim src/htttp/ngx_http_upstream.h")]),t._v(" "),n("li",[t._v("找：ngx_http_upstream_srv_conf_s\n"),n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281133352.png",alt:"image-20220128113321820"}})])])])])]),t._v(" "),n("li",[n("p",[t._v("make upgrade")])])]),t._v(" "),n("h3",{attrs:{id:"负载均衡案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡案例"}},[t._v("#")]),t._v(" 负载均衡案例")]),t._v(" "),n("h4",{attrs:{id:"实现带有url重写的负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现带有url重写的负载均衡"}},[t._v("#")]),t._v(" 实现带有URL重写的负载均衡")]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#具有rewrite的负载均衡\n    server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 8084"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /file/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            #重写到/server地址\n            rewrite ^"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/file/.*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" /server/"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" last"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#/server地址\n        location /server/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//backend;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"nginx四层负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx四层负载均衡"}},[t._v("#")]),t._v(" nginx四层负载均衡")]),t._v(" "),n("blockquote",[n("p",[t._v("四层负载均衡：stream=>upstream=>server")]),t._v(" "),n("p",[t._v("upstream添加多个后端服务")])]),t._v(" "),n("h3",{attrs:{id:"添加stream模块的支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加stream模块的支持"}},[t._v("#")]),t._v(" 添加stream模块的支持")]),t._v(" "),n("blockquote",[n("p",[t._v("添加模块stream：./configure 之前的配置 --with-stream")])]),t._v(" "),n("h3",{attrs:{id:"nginx四层负载均衡的指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx四层负载均衡的指令"}},[t._v("#")]),t._v(" nginx四层负载均衡的指令")]),t._v(" "),n("h4",{attrs:{id:"stream指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stream指令"}},[t._v("#")]),t._v(" stream指令")]),t._v(" "),n("blockquote",[n("p",[t._v("和http指令同级")])]),t._v(" "),n("h4",{attrs:{id:"upstream指令-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upstream指令-2"}},[t._v("#")]),t._v(" upstream指令")]),t._v(" "),n("blockquote",[n("p",[t._v("和http里的upstream类似")])]),t._v(" "),n("h3",{attrs:{id:"四层负载均衡的案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四层负载均衡的案例"}},[t._v("#")]),t._v(" 四层负载均衡的案例")]),t._v(" "),n("h4",{attrs:{id:"需求分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求分析"}},[t._v("#")]),t._v(" 需求分析")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281140392.png",alt:"image-20220128114039062"}})]),t._v(" "),n("p",[t._v("实现步骤")]),t._v(" "),n("p",[t._v("✔️Redis服务器")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("准备redis服务器，端口6379（默认），6378")])]),t._v(" "),n("li",[n("p",[t._v("tar -zxf redis-4.0.14.tar.gz")])]),t._v(" "),n("li",[n("p",[t._v("make PREFIX=/usr/local/redis/redis01 install")]),t._v(" "),n("ul",[n("li",[t._v("编译和安装")])])]),t._v(" "),n("li",[n("p",[t._v("cp redis.conf /usr/local/redis/redis01/bin")])]),t._v(" "),n("li",[n("p",[t._v("修改redis.conf配置文件")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("/搜索，n下一个")])]),t._v(" "),n("li",[n("p",[t._v("port 6379")])]),t._v(" "),n("li",[n("p",[t._v("daemonize yes")])])])]),t._v(" "),n("li",[n("p",[t._v("复制redis01为redis02")]),t._v(" "),n("ul",[n("li",[t._v("cd  /usr/local/redis")]),t._v(" "),n("li",[t._v("==cp -r redis01 redis02==")])])]),t._v(" "),n("li",[n("p",[t._v("启动：")]),t._v(" "),n("ul",[n("li",[t._v("切换到bin：cd bin")]),t._v(" "),n("li",[t._v("./redis-server ../redis.conf")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281147898.png",alt:"image-20220128111647702"}})])])]),t._v(" "),n("p",[t._v("✔️tomcat服务器")]),t._v(" "),n("ol",[n("li",[t._v("tar -zxf apache-tomcat-8.5.56.tar.gz")]),t._v(" "),n("li",[t._v("cd apache-tomcat-8.5.56/bin")]),t._v(" "),n("li",[t._v("./startup")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#四层负载均衡：stream===>upstream===>server\nstream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("upstream redisbackend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("6378"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("upstream tomcatbackend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#redis四层负载均衡\n    server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 81"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_pass redisbackend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#tomcat的四层负载均衡\n    server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 82"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_pass tomcatbackend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h1",{attrs:{id:"nginx缓存集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx缓存集成"}},[t._v("#")]),t._v(" nginx缓存集成")]),t._v(" "),n("h2",{attrs:{id:"缓存的概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存的概念"}},[t._v("#")]),t._v(" 缓存的概念")]),t._v(" "),n("blockquote",[n("p",[t._v("把没有的数据缓存，下次访问速度提高")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281649326.png",alt:"image-20220128164941392"}})]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("场景")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘缓存")]),t._v(" "),n("td",[t._v("减少磁盘操作")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("数据库缓存")]),t._v(" "),n("td",[t._v("减少文件系统IO操作")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("应用程序缓存")]),t._v(" "),n("td",[t._v("减少对数据库查询")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("web服务器缓存")]),t._v(" "),n("td",[t._v("减少请求次数")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("浏览器缓存")]),t._v(" "),n("td",[t._v("减少后台交互次数")])])])]),t._v(" "),n("p",[t._v("✔️优点：")]),t._v(" "),n("ul",[n("li",[t._v("减少数据传输，加快响应，提升体验")]),t._v(" "),n("li",[t._v("减轻服务器压力")])]),t._v(" "),n("p",[t._v("✔️缺点：")]),t._v(" "),n("ul",[n("li",[t._v("数据不同步")]),t._v(" "),n("li",[t._v("增加成本")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281656975.png",alt:"image-20220128165634184"}})]),t._v(" "),n("p",[t._v("nginx作为web缓存服务器，提高访问的响应速度")]),t._v(" "),n("h2",{attrs:{id:"nginx的web缓存服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的web缓存服务"}},[t._v("#")]),t._v(" nginx的web缓存服务")]),t._v(" "),n("blockquote",[n("p",[t._v("原理：把‘URL及相关组合为key，MD5加key得到目录路径，把缓存内存保存在目录")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281658842.png",alt:"image-20220128165841163"}})]),t._v(" "),n("h2",{attrs:{id:"nginx缓存设置的相关指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx缓存设置的相关指令"}},[t._v("#")]),t._v(" nginx缓存设置的相关指令")]),t._v(" "),n("blockquote",[n("p",[t._v("模块：ngx_http_proxy_module")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache-path"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache-path"}},[t._v("#")]),t._v(" proxy_cache_path")]),t._v(" "),n("blockquote",[n("p",[t._v("设置存放缓存的地址")])]),t._v(" "),n("p",[t._v("✔️参数")]),t._v(" "),n("ul",[n("li",[t._v("path：缓存地址")]),t._v(" "),n("li",[t._v("levels：目录层级")]),t._v(" "),n("li",[t._v("keys_zone：目录名称和大小")]),t._v(" "),n("li",[t._v("inactive：多久缓存没有被访问将删除")]),t._v(" "),n("li",[t._v("max_size：最大缓存空间")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache"}},[t._v("#")]),t._v(" proxy_cache")]),t._v(" "),n("blockquote",[n("p",[t._v("开启或关闭缓存")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache-key"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache-key"}},[t._v("#")]),t._v(" proxy_cache_key")]),t._v(" "),n("blockquote",[n("p",[t._v("设置web缓存的key值")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache-valid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache-valid"}},[t._v("#")]),t._v(" proxy_cache_valid")]),t._v(" "),n("blockquote",[n("p",[t._v("设置状态码的缓存时间")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache-min-uses"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache-min-uses"}},[t._v("#")]),t._v(" proxy_cache_min_uses")]),t._v(" "),n("blockquote",[n("p",[t._v("设置资源被访问多少次后开始缓存")])]),t._v(" "),n("h3",{attrs:{id:"proxy-cache-methods"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy-cache-methods"}},[t._v("#")]),t._v(" proxy_cache_methods")]),t._v(" "),n("blockquote",[n("p",[t._v("设置缓存哪些HTTP方法")])]),t._v(" "),n("h2",{attrs:{id:"nginx缓存设置案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx缓存设置案例"}},[t._v("#")]),t._v(" nginx缓存设置案例")]),t._v(" "),n("h3",{attrs:{id:"需求分析-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求分析-2"}},[t._v("#")]),t._v(" 需求分析")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281952888.png",alt:" "}})]),t._v(" "),n("h3",{attrs:{id:"步骤实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤实现"}},[t._v("#")]),t._v(" 步骤实现")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[t._v("        #缓存路径，目录，名称\n        proxy_cache_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("proxy_cache levels"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" keys_zone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("luo"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("200m inactive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1d max_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("20g"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        upstream backend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".164")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".129")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        proxy_cache luo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #缓存的MD5key\n                        proxy_cache_key luomu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("状态码缓存时间\n                        proxy_cache_valid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" 5d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v("缓存时间\n                        proxy_cache_valid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" 30s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #其它状态码缓存时间\n                        proxy_cache_valid "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),t._v(" 1m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #最小开始缓存次数\n                        proxy_cache_min_uses "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        #查看缓存信息\n                        add_header nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cache "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$upstream_cache_status"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("backend"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201290928605.png",alt:"image-20220128135201983"}})]),t._v(" "),n("h2",{attrs:{id:"nginx缓存清除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx缓存清除"}},[t._v("#")]),t._v(" nginx缓存清除")]),t._v(" "),n("h3",{attrs:{id:"方式一-删除缓存目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式一-删除缓存目录"}},[t._v("#")]),t._v(" 方式一：删除缓存目录")]),t._v(" "),n("blockquote",[n("p",[t._v("rm -rf /usr/local/proxy_cache")])]),t._v(" "),n("h3",{attrs:{id:"方式二-第三方扩展模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式二-第三方扩展模块"}},[t._v("#")]),t._v(" 方式二：第三方扩展模块")]),t._v(" "),n("h4",{attrs:{id:"ngx-cache-purge"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ngx-cache-purge"}},[t._v("#")]),t._v(" ngx_cache_purge")]),t._v(" "),n("ol",[n("li",[t._v("tar -zxf ngx_cache_purge-2.3.tar.gz")]),t._v(" "),n("li",[t._v("./configure --add-module=/root/nginx/module/purge")]),t._v(" "),n("li",[t._v("make")]),t._v(" "),n("li",[t._v("make upgrade")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    location ~ /"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("purge")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        #清除缓存\n        proxy_cache_purge luo luomu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"nginx设置资源不缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx设置资源不缓存"}},[t._v("#")]),t._v(" nginx设置资源不缓存")]),t._v(" "),n("p",[t._v("✔️proxy_no_cache")]),t._v(" "),n("blockquote",[n("p",[t._v("不将数据缓存的条件（没缓存过）")]),t._v(" "),n("p",[t._v("配置实例：proxy_no_cache $cookie_mocache $arg_nocache $arg_comment")])]),t._v(" "),n("p",[t._v("✔️proxy_cache_bypass")]),t._v(" "),n("blockquote",[n("p",[t._v("设置不从缓存中获取数据的条件（已经缓存过）")]),t._v(" "),n("p",[t._v("配置实例：proxy_cache_bypass $cookie_nocache $arg_nocache $arg_comment")])]),t._v(" "),n("p",[t._v("注意：条件有一个不为0就生效")]),t._v(" "),n("h3",{attrs:{id:"cookie-nocache、-arg-nocache、-arg-comment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-nocache、-arg-nocache、-arg-comment"}},[t._v("#")]),t._v(" $cookie_nocache、$arg_nocache、$arg_comment")]),t._v(" "),n("ul",[n("li",[t._v("cookie_nocache：==键==nocache对应的值")]),t._v(" "),n("li",[t._v("arg_nocache和arg_comment：==参数==的名为nocache和comment对应的值")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    #演示设置不缓存\n    log_format params "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cookie_nocache")]),t._v(" | "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_nocache")]),t._v(" | "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_comment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen  8083"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            access_log logs/access_params.log params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            #add_header Set-Cookie "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nocache=999'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            root html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[t._v("#")]),t._v(" 案例")]),t._v(" "),n("blockquote",[n("p",[t._v("常见的设置资源不缓存方案")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#设置不缓存两种方法结合（流行）\n    server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 8084"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(" ~ /.*.\\js$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                set "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nocache")]),t._v(" 1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            proxy_cache_bypass "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cookie_nocache")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_nocache")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_comment")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nocache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_no_cache "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cookie_nocache")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_nocache")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$arg_comment")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nocache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h1",{attrs:{id:"nginx实现服务器端集群搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx实现服务器端集群搭建"}},[t._v("#")]),t._v(" nginx实现服务器端集群搭建")]),t._v(" "),n("h2",{attrs:{id:"nginx与tomcat部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx与tomcat部署"}},[t._v("#")]),t._v(" nginx与tomcat部署")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201300839130.png",alt:"image-20220130083948128"}})]),t._v(" "),n("h3",{attrs:{id:"环境准备tomcat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备tomcat"}},[t._v("#")]),t._v(" 环境准备tomcat")]),t._v(" "),n("ol",[n("li",[t._v("安装tomcat")]),t._v(" "),n("li",[t._v("将项目打war放到webapps下")])]),t._v(" "),n("h3",{attrs:{id:"环境准备nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备nginx"}},[t._v("#")]),t._v(" 环境准备nginx")]),t._v(" "),n("blockquote",[n("p",[t._v("反向代理将请求发送给tomcat")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#tomcat的集群\n    upstream myWeb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8180 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8280 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("server ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location / ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html/web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#动态资源\n        location /demo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//myWeb;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"nginx实现动静分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx实现动静分离"}},[t._v("#")]),t._v(" nginx实现动静分离")]),t._v(" "),n("blockquote",[n("p",[t._v("动静分离：静态资源相关的内容交给nginx")])]),t._v(" "),n("p",[t._v("✔️为什么需要动静分离：")]),t._v(" "),n("ul",[n("li",[t._v("nginx处理静态资源效率高")]),t._v(" "),n("li",[t._v("减轻tomcat服务器压力")]),t._v(" "),n("li",[t._v("提高静态资源的访问速度")]),t._v(" "),n("li",[t._v("动态资源宕机不影响静态资源")])]),t._v(" "),n("p",[t._v("动：部署tomcat、weblogic或者websphere")]),t._v(" "),n("p",[t._v("静：部署到CDN、nginx等")]),t._v(" "),n("h3",{attrs:{id:"需求分析-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求分析-3"}},[t._v("#")]),t._v(" 需求分析")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301524216.png",alt:"image-20220130152448591"}})]),t._v(" "),n("h3",{attrs:{id:"动静分离实现步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动静分离实现步骤"}},[t._v("#")]),t._v(" 动静分离实现步骤")]),t._v(" "),n("ul",[n("li",[t._v("首页")])]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Title"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("js/jquery.min.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.164.129/demo/getAddress'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n           "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("images/logo.png"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Nginx如何将请求转发到后端服务器"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("images/mv.png"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("ul",[n("li",[t._v("nginx的配置")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#tomcat的集群\n    upstream myWeb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8180 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server 192.168.164."),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("129")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8280 weight=10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("server ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location / ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html/web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#动态资源\n        location /demo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//myWeb;")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        #静态资源\n        location ~/.*\\."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("js|png|jpg|gif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                root html/web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301535657.png",alt:"image-20220129180704547"}})]),t._v(" "),n("h2",{attrs:{id:"nginx实现tomcat集群搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx实现tomcat集群搭建"}},[t._v("#")]),t._v(" nginx实现tomcat集群搭建")]),t._v(" "),n("blockquote",[n("p",[t._v("如果tomcat宕机了，部署多台tomcat，提高可用性")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301535294.png",alt:"image-20220130153538496"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301536887.png",alt:"image-20220129180701896"}})]),t._v(" "),n("h2",{attrs:{id:"nginx高可用解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx高可用解决方案"}},[t._v("#")]),t._v(" nginx高可用解决方案")]),t._v(" "),n("blockquote",[n("p",[t._v("nginx宕机？两个nginx，用户访问哪个？")])]),t._v(" "),n("h3",{attrs:{id:"keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived"}},[t._v("#")]),t._v(" keepalived")]),t._v(" "),n("blockquote",[n("p",[t._v("通告VRRP协议实现高可用功能")])]),t._v(" "),n("h3",{attrs:{id:"vrrp介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vrrp介绍"}},[t._v("#")]),t._v(" VRRP介绍")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301539003.png",alt:"image-20220130153950716"}})]),t._v(" "),n("p",[t._v("✔️VRRP（virtual route redundancy protocol），虚拟路由冗余协议")]),t._v(" "),n("blockquote",[n("p",[t._v("将两台或多台路由器虚拟成一个设备，对外提高虚拟路由器IP，master（MASTER)对接IP")])]),t._v(" "),n("p",[t._v("作用：")]),t._v(" "),n("ol",[n("li",[t._v("选择协议\n"),n("ul",[n("li",[t._v("路由之间竞选master，剩下的就是backup")])])]),t._v(" "),n("li",[t._v("路由容错协议\n"),n("ul",[n("li",[t._v("master路由宕机后，由backup替代成为新的master")])])])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301551336.png",alt:"image-20220130155141302"}})]),t._v(" "),n("h3",{attrs:{id:"环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[t._v("#")]),t._v(" 环境搭建")]),t._v(" "),n("ol",[n("li",[t._v("官网下载版本：https://keepalived.org/")]),t._v(" "),n("li",[t._v("安装keepalived")]),t._v(" "),n("li",[t._v("cd keepalived/keepalived-2.0.20")]),t._v(" "),n("li",[t._v("./configure --sysconf=/etc --prefix=/usr/local")]),t._v(" "),n("li",[t._v("make && make install")])]),t._v(" "),n("blockquote",[n("p",[t._v("安装后：")]),t._v(" "),n("ul",[n("li",[t._v("系统配置文件：/etc/keepalived/keepalived.conf")]),t._v(" "),n("li",[t._v("启动和关闭keepalived：/usr/local/sbin")])])]),t._v(" "),n("h3",{attrs:{id:"keepalived配置文件介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived配置文件介绍"}},[t._v("#")]),t._v(" keepalived配置文件介绍")]),t._v(" "),n("p",[t._v("✔️keepalived.conf配置文件")]),t._v(" "),n("ul",[n("li",[t._v("global全局配置")]),t._v(" "),n("li",[t._v("vrrp相关配置")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("! Configuration File for keepalived\n#全局模块\nglobal_defs ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#切换通知目的地邮箱\n   notification_email ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        tom"),n("span",{pre:!0,attrs:{class:"token atrule"}},[n("span",{pre:!0,attrs:{class:"token rule"}},[t._v("@qq")]),t._v(".com\n        jack"),n("span",{pre:!0,attrs:{class:"token rule"}},[t._v("@qq")]),t._v(".com\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   #发件人邮箱\n   notification_email_from wangwu"),n("span",{pre:!0,attrs:{class:"token rule"}},[t._v("@qq")]),t._v(".com\n   #邮箱服务地址\n   smtp_server 192.168.200.1\n   #服务连接超时时间\n   smtp_connect_timeout 30\n   #标识\n   router_id LVS_DEVEL\n   #检查地址\n   vrrp_skip_check_adv_addr\n   #遵守vrrp协议\n   vrrp_strict\n   #延迟\n   vrrp_garp_interval 0\n   #网卡延迟\n   vrrp_gna_interval 0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#控制keepalived什么时候关闭的脚本vrrp_script\nvrrp_script ck_nginx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        #脚本位置\n        script "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'usr/local/sbin/ck_nginx.sh'")]),t._v("\n        #执行时间间隔\n        interval 3\n        #权重，即优先级\n        weight -20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#实例，VI_1实例名称\nvrrp_instance VI_1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#MASTER或BACKUP master主 backup备\n    state BACKUP\n    #网卡名称\n    interface ens33\n    #实例ID，范围0~255\n    virtual_router_id 51\n    #优先级\n    priority 100\n    #发送vrrp通告间隔时间\n    advert_int 1\n    #通信认证模块\n    authentication ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        #密码认证\n        auth_type PASS\n        #具体密码\n        auth_pass 1111\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#虚拟IP地址\n    virtual_ipaddress ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        192.168.164.129\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"访问测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问测试"}},[t._v("#")]),t._v(" 访问测试")]),t._v(" "),n("blockquote",[n("p",[t._v("ip a：查看IP")])]),t._v(" "),n("p",[t._v("存在的问题：")]),t._v(" "),n("ul",[n("li",[t._v("想让master切换，需把对应的服务器上的keepalived关闭（手动）")])]),t._v(" "),n("h3",{attrs:{id:"keepalived之vrrp-script"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived之vrrp-script"}},[t._v("#")]),t._v(" keepalived之vrrp_script")]),t._v(" "),n("blockquote",[n("p",[t._v("解决需手动关闭keepalived")])]),t._v(" "),n("p",[t._v("✔️实现步骤")]),t._v(" "),n("ul",[n("li",[t._v("配置文件中添加对应的配置像")])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#控制keepalived什么时候关闭的脚本vrrp_script\nvrrp_script ck_nginx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        #脚本位置\n        script "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'usr/local/sbin/ck_nginx.sh'")]),t._v("\n        #执行时间间隔\n        interval 3\n        #权重，即优先级\n        weight -20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[t._v("脚本\n"),n("ul",[n("li",[t._v("-C：指定命令的所有进程")]),t._v(" "),n("li",[t._v("--no-header：排除标题")])])])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("#!/bin/bash\nnginx开启的个数\nnum=`ps -C nginx --no-header | wc -l`\nif [ "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num")]),t._v(" -eq 0 ]"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("then\n /usr/local/nginx/sbin/nginx\n sleep 2\n if [ `ps -C nginx --no-header | wc -l` -eq 0 ]"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" then\n\t如果nginx为0，关闭keepalived\n  killall keepalived\n fi\nfi\n")])])]),n("ul",[n("li",[t._v("注意：设置master和backup状态时，都设为backup，可通过优先级（priority）竞争")])]),t._v(" "),n("h2",{attrs:{id:"nginx制作下载站点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx制作下载站点"}},[t._v("#")]),t._v(" nginx制作下载站点")]),t._v(" "),n("blockquote",[n("p",[t._v("模块：ngx_http_autoindex_module")])]),t._v(" "),n("p",[t._v("例：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(832),alt:"image-20220130161744226"}})]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /download")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root /usr/local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #开启资源列表\n        autoindex on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #资源大小详细信息\n        autoindex_exact_size off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #资源展示的格式\n        autoindex_format html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #目录的资源展示时间\n        autoindex_localtime off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"nginx的用户认证模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的用户认证模块"}},[t._v("#")]),t._v(" nginx的用户认证模块")]),t._v(" "),n("blockquote",[n("p",[t._v("设置资源允许谁访问")])]),t._v(" "),n("p",[t._v("✌️auth_basic string|off：开启后，提示用户需要用户名和密码验证")]),t._v(" "),n("p",[t._v("✌️auth_basic_user_file：用户名和密码路径，可以使用工具"),n("code",[t._v("htpasswd")]),t._v("生产")]),t._v(" "),n("ul",[n("li",[t._v("yum install -y httpd-tools")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("htpasswd -c /usr/local/nginx/conf/htpasswd username //创建一个新文件记录用户名和密码\nhtpasswd -b /usr/local/nginx/conf/htpasswd username password //在指定文件新增一个用户名和密码\nhtpasswd -D /usr/local/nginx/conf/htpasswd username //从指定文件删除一个用户信息\nhtpasswd -v /usr/local/nginx/conf/htpasswd username //验证用户名和密码是否正确\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("location /download{\n    root /usr/local;\n    autoindex on;\n    autoindex_exact_size on;\n    autoindex_format html;\n    autoindex_localtime on;\n    auth_basic 'please input your auth';\n    auth_basic_user_file htpasswd;\n}\n")])])]),n("h1",{attrs:{id:"nginx的扩展模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的扩展模块"}},[t._v("#")]),t._v(" nginx的扩展模块")]),t._v(" "),n("h2",{attrs:{id:"lua"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lua"}},[t._v("#")]),t._v(" Lua")]),t._v(" "),n("h3",{attrs:{id:"概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),n("blockquote",[n("p",[t._v("脚本语言，灵活扩展和定制功能")])]),t._v(" "),n("h3",{attrs:{id:"特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[t._v("#")]),t._v(" 特性")]),t._v(" "),n("ol",[n("li",[t._v("轻量级：方便嵌入")]),t._v(" "),n("li",[t._v("可扩展")]),t._v(" "),n("li",[t._v("支持面向过程和函数式编程")])]),t._v(" "),n("h3",{attrs:{id:"应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),n("blockquote",[n("p",[t._v("游戏开发、web脚本、独立应用脚本等")])]),t._v(" "),n("h3",{attrs:{id:"lua的安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lua的安装"}},[t._v("#")]),t._v(" Lua的安装")]),t._v(" "),n("ul",[n("li",[t._v("官网：https://www.lua.org")])]),t._v(" "),n("ol",[n("li",[t._v("wget https://www.lua.org/ftp/lua-5.4.1.tar.gz")]),t._v(" "),n("li",[t._v("cd lua-5.4.1")]),t._v(" "),n("li",[t._v("make linux test")]),t._v(" "),n("li",[t._v("make install")])]),t._v(" "),n("h3",{attrs:{id:"第一个lua程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一个lua程序"}},[t._v("#")]),t._v(" 第一个Lua程序")]),t._v(" "),n("ol",[n("li",[t._v("lua")]),t._v(" "),n("li",[t._v("print('hello world')")])]),t._v(" "),n("h3",{attrs:{id:"注释"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[t._v("#")]),t._v(" 注释")]),t._v(" "),n("ul",[n("li",[t._v("单行注释：--")]),t._v(" "),n("li",[t._v("多行注释：--[[        注释内容      --]]")])]),t._v(" "),n("h3",{attrs:{id:"语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[t._v("#")]),t._v(" 语法")]),t._v(" "),n("p",[t._v("✌️运算符：")]),t._v(" "),n("ol",[n("li",[t._v("^：幂")]),t._v(" "),n("li",[t._v("~=：不等")]),t._v(" "),n("li",[t._v("..：连接两个字符串\n"),n("ul",[n("li",[t._v('例："hello".."world"===>helloworld')])])]),t._v(" "),n("li",[t._v("井号：返回字符串或表的长度")])]),t._v(" "),n("p",[t._v("✌️变量")]),t._v(" "),n("ol",[n("li",[t._v("默认变量为全局，局部定义前面加local")])]),t._v(" "),n("p",[t._v("✌️数据类型")]),t._v(" "),n("ol",[n("li",[t._v("nil：空")]),t._v(" "),n("li",[t._v("number：数值")]),t._v(" "),n("li",[t._v("table：表\n"),n("ul",[n("li",[t._v('例：arr={"java","lisi","wangwu"}')])])]),t._v(" "),n("li",[t._v("userdata：用户数据")])]),t._v(" "),n("p",[t._v("》例：print(type(12))===>number")]),t._v(" "),n("p",[t._v("✌️控制结构")]),t._v(" "),n("ol",[n("li",[t._v("if elseif else\n"),n("ul",[n("li",[t._v("例：if (5>3) then elseif (4>3) then else  end")]),t._v(" "),n("li",[t._v("注意：else后面没有then，其他都有")])])]),t._v(" "),n("li",[t._v("whille 条件 do 循环 end")]),t._v(" "),n("li",[t._v("for k,v in ipairs(x) do end\n"),n("ul",[n("li",[t._v("x：表（Java中的数据）")])])])]),t._v(" "),n("h2",{attrs:{id:"ngx-lua模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ngx-lua模块"}},[t._v("#")]),t._v(" ngx_lua模块")]),t._v(" "),n("h3",{attrs:{id:"openresty"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#openresty"}},[t._v("#")]),t._v(" OpenResty")]),t._v(" "),n("blockquote",[n("p",[t._v("基于nginx与Lua（集成两者）的高性能web平台")])]),t._v(" "),n("h3",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),n("ol",[n("li",[t._v("wget https://openresty.org/download/openresty-1.15.8.2.tar.gz")]),t._v(" "),n("li",[t._v("tar -zxf openresty-1.15.8.2.tar.gz")]),t._v(" "),n("li",[t._v("cd openresty-1.15.8.2")]),t._v(" "),n("li",[t._v("./configure")]),t._v(" "),n("li",[t._v("make && make install")]),t._v(" "),n("li",[t._v("cd /usr/local/openresty/nginx/")])]),t._v(" "),n("h2",{attrs:{id:"ngx-lua的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ngx-lua的使用"}},[t._v("#")]),t._v(" ngx_lua的使用")]),t._v(" "),n("p",[t._v("✔️指令执行顺序")]),t._v(" "),n("p",[n("img",{attrs:{src:s(833),alt:"image-20220204221208361"}})]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("*（xxx_by_lua）：表示指令\n*（xxx_by_lua_block）：表示文件\n")])])]),n("ol",[n("li",[t._v("==init_by_lua==*：初始化的全局配置")]),t._v(" "),n("li",[t._v("init_worker_by_lua*：定时任务")]),t._v(" "),n("li",[t._v("==set_by_lua*==：给变量赋值")]),t._v(" "),n("li",[t._v("rewrite_by_lua*：重写")]),t._v(" "),n("li",[t._v("access_by_lua*：访问控制")]),t._v(" "),n("li",[t._v("==content_by_lua*==（常用）：这个阶段大部分任务完成，其他阶段是准备")]),t._v(" "),n("li",[t._v("header_fiter_by_lua*：设置头部信息")]),t._v(" "),n("li",[t._v("body_filter_by_lua&：对响应数据过滤")])]),t._v(" "),n("h3",{attrs:{id:"需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http://192.168.111.130?name=zhangsan&gender=1\ngender：1输出名字加先生，0输出女士\n")])])]),n("p",[t._v("✌️代码")]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("\t"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#地址参数，gender（1是先生，0是女士），name\n\tlocation /getGender")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tdefault_type "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tset_by_lua "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),t._v(' "\n\t\t\tlocal msg=ngx.req.get_uri_'),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tgender = msg["),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gender'")]),t._v("]\n\t\t\tname = msg["),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),t._v("]\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gender=="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" then\n\t\t\t\treturn name.."),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'先生'")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("elseif")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gender=="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" then\n\t\t\t\treturn name.."),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'女士'")]),t._v('\n\t\t\telse\n\t\t\t\treturn name\n\t\t\tend\n\t\t"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\treturn 200 "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:s(834),alt:"image-20220204123425989"}})]),t._v(" "),n("h2",{attrs:{id:"ngx-lua操作redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ngx-lua操作redis"}},[t._v("#")]),t._v(" ngx_lua操作redis")]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location / ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    default_type "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("content_by_lua_block")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        local redis = require "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resty.redis"')]),t._v(" -- 引入Redis\n        local redisObj = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  --创建Redis对象\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redisObj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("set_"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" --设置超时数据为1s\n        local ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redisObj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.200.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" --设置redis连接信息\n        if "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" ok then --判断是否连接成功\n         ngx."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"failed to connection redis"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         return\n        end\n        ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redisObj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TOM"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("--存入数据\n        if "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" ok then --判断是否存入成功\n         ngx."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"failed to set username"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         return\n        end\n        local res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redisObj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" --从redis中获取数据\n        ngx."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t--将数据写会消息体中\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("redisObj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"ngx-lua操作mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ngx-lua操作mysql"}},[t._v("#")]),t._v(" ngx_lua操作mysql")]),t._v(" "),n("blockquote",[n("p",[t._v("注意：注释是--，不是#")])]),t._v(" "),n("p",[t._v("连接不到本地数据库原因")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("IP问题：关闭防火墙，或者给对应IP防火墙放行add-port")])]),t._v(" "),n("li",[n("p",[t._v("数据库问题：mysql没有对你登录的用户开启远程登录的权限。")]),t._v(" "),n("div",{staticClass:"language-mysql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mysql -u root -p 密码\nuse mysql\nupdate user set host = '%' where user='root'\n")])])])])]),t._v(" "),n("div",{staticClass:"language-scss extra-class"},[n("pre",{pre:!0,attrs:{class:"language-scss"}},[n("code",[t._v("\t"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("init_by_lua_block")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t    redis = require "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resty.redis"')]),t._v("\n\t    mysql = require "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resty.mysql"')]),t._v("\n\t    cjson = require "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cjson"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("server ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        #charset koi8-r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        #access_log  logs/host.access.log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n\t"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("location /")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdefault_type "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("content_by_lua_block")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        --创建数据库对象\n        local db = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("mysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("local ok,err = db:connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        host="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.111.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        port=3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        user="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        password="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        database="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx_db"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        max_packet_size=1024"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        compact_arrays="),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        --输出错误信息\n\t    ngx."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("set_"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        --删除\n        local res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("errcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sqlstate = "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delete from users where id=3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        --local sql="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"update users set username='lisi' where id = 3\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t--local res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("errcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sqlstate="),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        --数据转换为json格式\n\t\tngx."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cjson."),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);