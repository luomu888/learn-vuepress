<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx简介 | luomu</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="luomu">
    
    <link rel="preload" href="/learn-vuepress/assets/css/0.styles.216a5ded.css" as="style"><link rel="preload" href="/learn-vuepress/assets/js/app.057a2b8d.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/7.4fee6b00.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/1.a3f35cab.js" as="script"><link rel="preload" href="/learn-vuepress/assets/js/12.2bac5d18.js" as="script"><link rel="prefetch" href="/learn-vuepress/assets/js/10.f98da735.js"><link rel="prefetch" href="/learn-vuepress/assets/js/11.909c0978.js"><link rel="prefetch" href="/learn-vuepress/assets/js/13.20f0b439.js"><link rel="prefetch" href="/learn-vuepress/assets/js/14.9ae294ad.js"><link rel="prefetch" href="/learn-vuepress/assets/js/15.88ea31f3.js"><link rel="prefetch" href="/learn-vuepress/assets/js/16.26aec435.js"><link rel="prefetch" href="/learn-vuepress/assets/js/17.be793736.js"><link rel="prefetch" href="/learn-vuepress/assets/js/18.87fe0efd.js"><link rel="prefetch" href="/learn-vuepress/assets/js/19.d6b74ddf.js"><link rel="prefetch" href="/learn-vuepress/assets/js/20.0609e649.js"><link rel="prefetch" href="/learn-vuepress/assets/js/21.fcc0b106.js"><link rel="prefetch" href="/learn-vuepress/assets/js/22.54ced2a1.js"><link rel="prefetch" href="/learn-vuepress/assets/js/23.47e9016d.js"><link rel="prefetch" href="/learn-vuepress/assets/js/3.144562e9.js"><link rel="prefetch" href="/learn-vuepress/assets/js/4.ed2bd9b2.js"><link rel="prefetch" href="/learn-vuepress/assets/js/5.e401998d.js"><link rel="prefetch" href="/learn-vuepress/assets/js/6.68b73da4.js"><link rel="prefetch" href="/learn-vuepress/assets/js/8.80faf5c4.js"><link rel="prefetch" href="/learn-vuepress/assets/js/9.2360727d.js">
    <link rel="stylesheet" href="/learn-vuepress/assets/css/0.styles.216a5ded.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>luomu</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>luomu</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">luomu</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-vuepress/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      luomu的 Java 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/luomu888" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>13</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/learn-vuepress/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      luomu的 Java 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/luomu888" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机底层</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面经</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python学习笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-vuepress/frame/MySQL.html" class="sidebar-link">数据库</a></li><li><a href="/learn-vuepress/frame/nginx.html" aria-current="page" class="active sidebar-link">Nginx</a></li><li><a href="/learn-vuepress/frame/Redis.html" class="sidebar-link">Redis</a></li><li><a href="/learn-vuepress/frame/springboot.html" class="sidebar-link">SpringBoot</a></li><li><a href="/learn-vuepress/frame/vue3.html" class="sidebar-link">Vue3</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">nginx简介</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="nginx简介"><a href="#nginx简介" class="header-anchor">#</a> nginx简介</h1> <h2 id="背景介绍"><a href="#背景介绍" class="header-anchor">#</a> 背景介绍</h2> <blockquote><p>高性能的【HTTP】和【反向代理】的【web服务器】，同时是【POP3、SMTP、IMAP代理服务器】，使用c语言编写的，开源</p></blockquote> <h3 id="名词解释"><a href="#名词解释" class="header-anchor">#</a> 名词解释</h3> <ol><li><p>web服务器：</p> <ul><li>也叫==页面服务器==，给用户提供网上信息浏览服务</li></ul></li> <li><p>HTTP：</p> <ul><li>超文本传输协议的缩写，从web服务器传输超文本到本地浏览器的传输协议，客户端是终端用户，服务器是网站</li></ul></li> <li><p>POP3、SMTP、IMAP：</p> <ul><li>POP3（post office protocol）：邮局协议的第三个版本</li> <li>SMTP（simple mail transfer protocol）：简单邮件传输协议</li> <li>IMAP（Internet mail access protocol）：交互式邮件存取协议</li></ul></li> <li><p>反向代理：nginx可以作为==电子邮件==代理服务器</p> <ul><li><p>正向代理：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112062117719.png" alt="image-20211206211713665"></p></li> <li><p>反向代理：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112062117309.png" alt="image-20211206211717992"></p></li></ul></li></ol> <h2 id="常见服务器对比"><a href="#常见服务器对比" class="header-anchor">#</a> 常见服务器对比</h2> <blockquote><p>==netcraft==公司官网每月公布调研数据（web server survey），成为人们了解全球网站数量及服务器份额情况必不可少网站</p></blockquote> <p>https://news.netcraft.com/</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112072003804.png" alt="image-20211207200319533"></p> <h3 id="iis"><a href="#iis" class="header-anchor">#</a> IIS</h3> <blockquote><p>Internet information services即互联网信息服务，由微软公司提供的基于Windows系统的互联网服务</p></blockquote> <ul><li>缺点：
<ul><li>服务器的稳定性</li> <li>性能不如unix操作系统</li></ul></li></ul> <h3 id="tomcat"><a href="#tomcat" class="header-anchor">#</a> tomcat</h3> <blockquote><p>运行==servlet和jsp==的web应用软件，开源</p></blockquote> <ul><li>缺点：
<ul><li>重量级</li> <li>对静态文件和高并发的处理比较弱</li></ul></li></ul> <h3 id="apache"><a href="#apache" class="header-anchor">#</a> apache</h3> <blockquote><p>稳定、开源。跨平台等，出现时间太久了</p></blockquote> <ul><li>缺点：
<ul><li>重量级、不支持高并发</li> <li>消耗大量的CPU资源</li></ul></li></ul> <h3 id="lighttpd"><a href="#lighttpd" class="header-anchor">#</a> lighttpd</h3> <blockquote><p>德国开源的web服务器软件</p></blockquote> <ul><li>优点：
<ul><li>轻量级，高性能</li> <li>欧美常用，国内常用nginx</li></ul></li></ul> <h3 id="其它的服务器"><a href="#其它的服务器" class="header-anchor">#</a> 其它的服务器</h3> <blockquote><p>Google servers、weblogic……</p></blockquote> <h3 id="nginx的优点"><a href="#nginx的优点" class="header-anchor">#</a> nginx的优点</h3> <h4 id="速度更快、并发更高"><a href="#速度更快、并发更高" class="header-anchor">#</a> 速度更快、并发更高</h4> <blockquote><p>采用了==多进程和I/O多路复用（epoll）==的底层实现</p></blockquote> <h4 id="配置简单-扩展性强"><a href="#配置简单-扩展性强" class="header-anchor">#</a> 配置简单，扩展性强</h4> <blockquote><p>很多模块组成，可以使用==配置文件的配置来添加模块==，也可以自己==定制模块==</p></blockquote> <h4 id="高可靠性"><a href="#高可靠性" class="header-anchor">#</a> 高可靠性</h4> <blockquote><p>多进程，其中有一个master主进程和N多个worker进程，==worker进程数量可以手动设置==，worker相互==独立==</p></blockquote> <h4 id="热部署"><a href="#热部署" class="header-anchor">#</a> 热部署</h4> <blockquote><p>在==nginx不停止==的情况下，对nginx进行文件升级、更新配置和更换日志文件等功能</p></blockquote> <h4 id="成本低、bsd许可证"><a href="#成本低、bsd许可证" class="header-anchor">#</a> 成本低、BSD许可证</h4> <blockquote><p>BSD是一个开源的许可证。nginx不仅可以免费的应用在商业领域，还可以在项目中直接修改nginx的源码</p></blockquote> <ul><li><p>比较流行的开源许可证：</p> <ul><li><p>GPL、BSD、MIT、Mozilla、Apache、LGPL</p></li> <li><p>OpenRestry [Nginx+Lua]   Tengine[淘宝]</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112072015644.png" alt="image-20211207201540414"></p></li></ul></li></ul> <h2 id="nginx的功能特性及常用功能"><a href="#nginx的功能特性及常用功能" class="header-anchor">#</a> nginx的功能特性及常用功能</h2> <h3 id="基本http服务"><a href="#基本http服务" class="header-anchor">#</a> 基本HTTP服务</h3> <p>作为HTTP代理服务器和反向代理服务器，支持通过==缓存加速访问==，可以完成简单的==负载均衡和容错==，支持==包过滤、SSl==等</p> <ul><li>处理静态文件、索引文件以及支持自动索引</li> <li>提供反向代理服务器、并可以使用缓存加上反向代理，同时完成负载均衡和容错</li> <li>提供对fastcgl、memcached等访问的缓存机制，同时完成负载均衡和容错</li> <li>提供过滤器功能，基本过滤器包括gzip压缩、ranges支持、chunked响应、XSLT、SSI以及图像缩放等</li> <li>支持HTTP下的==安全套接层安全协议SSL==</li> <li>支持基于加权和依赖的优先权的HTTP/2</li></ul> <h3 id="高级http服务"><a href="#高级http服务" class="header-anchor">#</a> 高级HTTP服务</h3> <ul><li>支持基于名字和IP的虚拟主机设置</li> <li>支持http/1.0中的keep-alive模式和管线（PipeLined）模型连接</li> <li>自定义访问日志格式、带缓存的日志写操作以及快速日志轮转</li> <li>提供3xx-5xx错误代码重定向功能</li> <li>支持重写（Rewrite）模块扩展</li> <li>支持重写加载配置以及在线升级无需中断正在处理的请求</li> <li>支持网络监控</li> <li>支持FLV和MP4流媒体传输</li></ul> <h3 id="邮件服务"><a href="#邮件服务" class="header-anchor">#</a> 邮件服务</h3> <ul><li>支持IMPA、POP3代理服务功能</li> <li>支持内部SMTP代理服务功能</li></ul> <h3 id="nginx常用的功能模块"><a href="#nginx常用的功能模块" class="header-anchor">#</a> nginx常用的功能模块</h3> <div class="language- extra-class"><pre class="language-text"><code>静态资源部署
Rewrite地址重写
	正则表达式
反向代理
负载均衡
	轮询、加权轮询、ip_hash、url_hash、fair
web缓存
环境部署
	高可用的环境
用户认证模块..
</code></pre></div><p>nginx的核心组成</p> <div class="language- extra-class"><pre class="language-text"><code>nginx二进制可执行文件
nginx.conf配置文件
error.log错误的日志记录
access.og访问日志记录
</code></pre></div><h1 id="nginx环境准备"><a href="#nginx环境准备" class="header-anchor">#</a> nginx环境准备</h1> <h2 id="nginx版本介绍"><a href="#nginx版本介绍" class="header-anchor">#</a> nginx版本介绍</h2> <p>官网：http://nginx.org/</p> <p>右边导航栏：</p> <ol><li>语言：英文和俄罗斯</li> <li>不同年份更新说明</li> <li>关于nginx介绍</li> <li>download：下载不同版本链接</li> <li>security：和nginx安全相关的问题描述</li> <li>documentation：官方文档</li> <li>==faq：nginx的问答==</li> <li>books：nginx书籍</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081930691.png" alt="image-20211208193032993"></p> <p>下载页面：</p> <ol><li>mainline version：主线版本，即最新的</li> <li>stable version：稳定版本，做web服务器通常考虑的</li> <li>legacy version：旧版本</li> <li>changes：对应版本功能变更日志</li> <li>nginx：一点就下载，Linux版本的下载链接</li> <li>pgp：一点就下载，使用PGP加密自由软件GnuPG计算后的签名信息</li> <li>windows：Windows版本下载链接	<img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081939722.png" alt="image-20211208193950598"></li></ol> <h2 id="获取nginx源码"><a href="#获取nginx源码" class="header-anchor">#</a> 获取nginx源码</h2> <p>官网：http://nginx.org/download/</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081947134.png" alt="image-20211208194727177"></p> <h2 id="准备服务器系统"><a href="#准备服务器系统" class="header-anchor">#</a> 准备服务器系统</h2> <p>环境：</p> <div class="language- extra-class"><pre class="language-text"><code>Vmware workStation
Centos7
MobaXterm(或者Xshell，SecureCRT)
网络
</code></pre></div><ol><li><p>确认centos的内核，==centos7.6默认高于Linux2.6==，2.6以上才支持epoll，因为nginx需要解==决高并发问题是需要epoll==</p> <ul><li><p>查看内核版本</p> <ul><li><p>==uname -a==：查看当前</p></li> <li><p>==yum list kernel -q==：查看已经安装的内核版本</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081953011.png" alt="image-20211208195338513"></p></li></ul></li></ul></li> <li><p>确保联网：ping baidu.com</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081954654.png" alt="image-20211208195425573"></p></li> <li><p>确保关闭防火墙，省去学习配置的问题，可以自己配置端口号，这样就不会被防火墙拦住</p> <ul><li>systemctl stop firewalld：重启失效</li> <li>==systemctl disable firewalld==：永久关闭</li> <li>systemctl status firewalld：查看服务器状态</li></ul></li> <li><p>停用selinux：杰出安全子系统</p> <ul><li><p>==sestatus==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112081959081.png" alt="image-20211208195908479"></p></li> <li><p>如果不是disabled</p> <ul><li><p>==vim /etc/selinux/config==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082000818.png" alt="image-20211208200039591"></p></li></ul></li></ul></li></ol> <h2 id="nginx安装方式介绍"><a href="#nginx安装方式介绍" class="header-anchor">#</a> nginx安装方式介绍</h2> <p>两个方式</p> <div class="language- extra-class"><pre class="language-text"><code>通过nginx源码
	简单安装（1）
	复杂安装（2）
通过yum安装
</code></pre></div><h3 id="源码安装条件"><a href="#源码安装条件" class="header-anchor">#</a> 源码安装条件</h3> <blockquote><p>centos7.6已经全部安装，不需要自己安装</p></blockquote> <h4 id="gcc编译器"><a href="#gcc编译器" class="header-anchor">#</a> GCC编译器</h4> <blockquote><p>GCC是一个开源的==编译器集合==，用于处理各种各样的语言，其中包括C语言</p></blockquote> <h4 id="pcre"><a href="#pcre" class="header-anchor">#</a> PCRE</h4> <blockquote><p>perl Compatible Regular Expressoin兼容正则表达式库，因为nginx的Rewrite模块和http科学模块会使用到</p></blockquote> <h4 id="zlib"><a href="#zlib" class="header-anchor">#</a> zlib</h4> <blockquote><p>因为nginx的需要==gzip压缩==，所以需要提前安装zlib(库)和zlib-devel(源代码)</p></blockquote> <h4 id="openssl"><a href="#openssl" class="header-anchor">#</a> OpenSSL</h4> <blockquote><p>安全通信，SSL：Secure Sockets Layer 安全套接协议，保证两个应用间通信的保密性和可靠性</p></blockquote> <p>一行命令安装所有：yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</p> <h3 id="方案一-源码简单安装"><a href="#方案一-源码简单安装" class="header-anchor">#</a> 方案一：源码简单安装</h3> <ol><li><p>进入官网找到下载版本的链接地址，使用wget命令下载</p> <div class="language- extra-class"><pre class="language-text"><code>wget http://nginx.org/download/nginx-1.16.1.tar.gz
</code></pre></div></li> <li><p>创建目录</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir -p nginx/core：创建多级	
</code></pre></div></li> <li><p>解压缩</p> <div class="language- extra-class"><pre class="language-text"><code>tar -zxf nginx-1.16.1.tar.gz：不加v是不显示解压时的信息
</code></pre></div></li> <li><p>找到configure执行脚本</p> <div class="language- extra-class"><pre class="language-text"><code>./configure
</code></pre></div></li> <li><p>编译和安装</p> <div class="language- extra-class"><pre class="language-text"><code>make &amp;&amp; make install
</code></pre></div></li></ol> <h3 id="方案二-yum安装"><a href="#方案二-yum安装" class="header-anchor">#</a> 方案二：yum安装</h3> <blockquote><p>源码安装比较繁琐，需要准备GCC、PCRE、zlib、OpenSSL等，而yum不需要</p></blockquote> <p>官网安装：http://nginx.org/en/linux_packages.html#RHEL-CentOS</p> <ol><li><p>安装yum-utils</p> <div class="language- extra-class"><pre class="language-text"><code>sudo yum install yum-utils
</code></pre></div></li> <li><p>添加yum源文件</p> <div class="language- extra-class"><pre class="language-text"><code>vim sudo yum install yum-utils
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre></div></li> <li><p>使用yum安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y nginx：加—y是默认输入y，即确认
</code></pre></div></li> <li><p>查看nginx的安装位置</p> <div class="language- extra-class"><pre class="language-text"><code>whereis nginx
</code></pre></div></li></ol> <h3 id="源码简单安装和yum安装的差异"><a href="#源码简单安装和yum安装的差异" class="header-anchor">#</a> 源码简单安装和yum安装的差异</h3> <p><code>./nginx -V</code>，开源查看nginx版本及相关配置信息，这里的./nginx是绝对路径，完整路径==/usr/local/nginx/sbin/nginx -V==</p> <p>简单安装：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082045043.png" alt="image-20211208204542962"></p> <p>yum安装：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082046991.png" alt="image-20211208204605990"></p> <h4 id="解压nginx目录"><a href="#解压nginx目录" class="header-anchor">#</a> 解压nginx目录</h4> <p>解压后还没有Makefile、objs</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082051945.png" alt="image-20211208205158683"></p> <p>内容解释：</p> <ol><li>auto：存放编译相关的脚本</li> <li>changes：版本变更记录</li> <li>changes.ru：俄罗斯版本变更记录</li> <li>==conf==：nginx默认的配置文件</li> <li>==configure==：nginx的自动脚本程序，重要，作用如下：
<ul><li>==检查环境及根据环境检查结构生成C代码==</li> <li>==生成编译代码需要的Makefile文件==</li></ul></li> <li>==contrib==：存放结构特殊的脚本文件，其中readme对脚本有详细的说明</li> <li>html：nginx自带两个页面，首页和错误页面</li> <li>license：许可证</li> <li>man：nginx的man手册</li> <li>src：源代码</li></ol> <h3 id="方案三-nginx的源码复杂安装"><a href="#方案三-nginx的源码复杂安装" class="header-anchor">#</a> 方案三：Nginx的源码复杂安装</h3> <blockquote><p>和简单安装不同在第一步，手动指定./configure的配置</p></blockquote> <ul><li>PATH：和路径相关的配置</li> <li>==with：启动模块，默认关闭==</li> <li>==without：关闭模块，默认开启==</li></ul> <p>配置：</p> <ol><li><p>--prefix=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>指向nginx的安装目录，默认是/usr/local/nginx
</code></pre></div></li> <li><p>--sbin-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>指向执行程序文件路径，默认/usr/local/nginx/sbin/nginx
</code></pre></div></li> <li><p>--modules-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>动态模块安装目录，默认/usr/local/nginx/modules
</code></pre></div></li> <li><p>--conf-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>执行配置文件的路径，默认/usr/local/nginx/conf/nginx.conf
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082104546.png" alt="image-20211208210404057"></p></li> <li><p>--error-log-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>错误日志文件路径，默认值/usr/local/nginx/logs/error.log
</code></pre></div></li> <li><p>--http-log-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>访问日志路径，默认/usr/local/nginx/logs/access.log
</code></pre></div></li> <li><p>--pid-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>nginx启动后ID的路径，默认/usr/local/nginx/logs/nginx.pid
</code></pre></div></li> <li><p>--lock-path=PATH</p> <div class="language- extra-class"><pre class="language-text"><code>nginx锁文件的路径，默认/usr/local/nginx/logs/nginx.lock
</code></pre></div></li></ol> <p>使用以上命令</p> <div class="language- extra-class"><pre class="language-text"><code>./configure --prefix=/usr/local/nginx \
--sbin-path=/usr/local/nginx/sbin/nginx \
--modules-path=/usr/local/nginx/modules \
--conf-path=/usr/local/nginx/conf/nginx.conf \
--error-log-path=/usr/local/nginx/logs/error.log \
--http-log-path=/usr/local/nginx/logs/access.log \
--pid-path=/usr/local/nginx/logs/nginx.pid \
--lock-path=/usr/local/nginx/logs/nginx.lock
</code></pre></div><p>编译和安装</p> <div class="language- extra-class"><pre class="language-text"><code>make &amp;&amp; make install
</code></pre></div><h2 id="卸载nginx"><a href="#卸载nginx" class="header-anchor">#</a> 卸载nginx</h2> <ol><li><p>关闭进程</p> <div class="language- extra-class"><pre class="language-text"><code>./nginx -s stop
</code></pre></div></li> <li><p>删除安装的nginx</p> <div class="language- extra-class"><pre class="language-text"><code>rm -rf /usr/local/nginx
</code></pre></div></li> <li><p>之前编译的环境清除掉（注意：make命令要在有Makefile的目录中执行）</p> <div class="language- extra-class"><pre class="language-text"><code>make clean
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112092007451.png" alt="image-20211209200746888"></p></li> <li><p>如果在这此之前安装过复杂源码安装，yum安装后nginx目录可能不在/usr/local/nginx</p> <ul><li><p>==find / -name nginx==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112082130898.png" alt="image-20211208213027143"></p></li> <li><p>找到nginx目录把它给删除</p></li> <li><p>然后在make clean将之前编译的环境清除掉</p></li></ul></li></ol> <h2 id="nginx目录结构分析"><a href="#nginx目录结构分析" class="header-anchor">#</a> nginx目录结构分析</h2> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091549221.png" alt="image-20211209154908119"></p> <ul><li>conf：nginx所有配置文件目录</li> <li>CGI（common gateway interface）通用网关接口，客户端发送请求和数据，服务端调用cgi处理相应结果给客户端的一种==标准规范==</li> <li>fastcgi.conf：相关配置文件</li> <li>fastcgi.conf.default：对应的备份</li> <li>fastcgi_params：参数文件</li> <li>scgi_params：scgi的参数文件</li> <li>uwsgi_params：uwsgi的参数文件</li> <li>mine.types：记录HTTP协议中的Content-Type的==值==和==文件后缀名==的对应关系</li> <li>==nginx.conf==：==核心配置文件==，非常重要，学习的重点</li> <li>koi-utf、koi-win、win-utf：与编码转换映射相关的配置文件，一种==编码转换另一种编码==</li> <li>html：存放两个静态页面
<ul><li>50x.html：访问失败</li> <li>index.html：访问成功页面</li></ul></li> <li>logs：服务器启动后，这里会有==access.log、error.log、nginx.pid==三个文件</li> <li>sbin：存放执行程序nginx文件</li></ul> <h2 id="nginx服务器启停命令"><a href="#nginx服务器启停命令" class="header-anchor">#</a> nginx服务器启停命令</h2> <h3 id="方式一-nginx服务的信号控制"><a href="#方式一-nginx服务的信号控制" class="header-anchor">#</a> 方式一：Nginx服务的信号控制</h3> <ol><li><p>==ps -ef | grep nginx==：查看nginx进程号</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091838307.png" alt="image-20211209183823884"></p></li> <li><p>关系：</p> <p><img src="E:%5CTypora_BI_JI%5Ctu-pian%5Cimage-20211209184041084.png" alt="image-20211209184041084"></p></li> <li><p>我们是管理员，只需给master进程发送信号就可以控制nginx</p> <ul><li>master进程</li> <li>信号</li></ul></li> <li><p>信号</p> <ul><li>TERM/INT：立即关闭服务</li> <li>QUIT：先执行完当前然后关闭全部服务</li> <li>HUP：重新启动work进程</li> <li>USR1：重新开启日志文件</li> <li>USR2：平滑升级到最新版的nginx</li> <li>WINCH：和quit差不多，区别在于这个master进程不会被关闭</li></ul></li> <li><p>==kill -signal PID==</p> <ol><li><p>立即关闭</p> <div class="language- extra-class"><pre class="language-text"><code>kill -TERM `cat /usr/local/nginx/logs/nginx.pid`
</code></pre></div></li> <li><p>先执行完当前然后关闭全部服务</p> <div class="language- extra-class"><pre class="language-text"><code>kill -quit 11044
</code></pre></div></li> <li><p>重新启动work进程</p> <div class="language- extra-class"><pre class="language-text"><code>kill -HUP 11044
</code></pre></div></li> <li><p>重新开启日志文件</p> <div class="language- extra-class"><pre class="language-text"><code>//删除日志文件
rm -rf access.log error.log
//恢复
kill -usr1 11044
</code></pre></div></li> <li><p>平滑升级到最新版的nginx</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>kill -usr2 11044
此时出现两个master，日志多了nginx.pid.oldbin
//关闭旧的master
kill -quit 11044
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091932811.png" alt="image-20211209193256555"></p></li> <li><p>和quit差不多，区别在于这个master进程不会被关闭</p> <div class="language- extra-class"><pre class="language-text"><code>kill -winch 11044
</code></pre></div></li></ol></li></ol> <h3 id="方式二-nginx的命令行控制"><a href="#方式二-nginx的命令行控制" class="header-anchor">#</a> 方式二：Nginx的命令行控制</h3> <blockquote><p>通过sbin下的nginx实现命令行控制，先./nginx -h查看有哪些参数可以用</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112091921971.png" alt="image-20211209192136967"></p> <ol><li>-v：打印版本号信息</li> <li>-V：打印版本号和配置信息</li> <li>-t：测试nginx的配置文件是否正确</li> <li>-T：测试nginx的配置文件是否正确并==列出配置文件信息==</li> <li>==-q：只打印错误信息==</li> <li>-s：信号，后面可以跟：
<ul><li>stop【快速关闭，相当于int】</li> <li>quit【QUIT】</li> <li>==reopen==【重启日志文件，相当于==usr1==】</li> <li>==reload==【hup，即==重新加载worker==】</li></ul></li> <li>-p：指定nginx的路径，默认/usr/local/nginx</li> <li>-c：指定nginx的配置文件路径。默认/usr/local/nginx/conf/nginx.conf</li> <li>-g：补充全局配置文件，很少用，可以在/usr/local/nginx/conf/nginx.conf配置就行</li></ol> <h2 id="nginx服务器版本升级和新增模块"><a href="#nginx服务器版本升级和新增模块" class="header-anchor">#</a> nginx服务器版本升级和新增模块</h2> <h3 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h3> <ol><li><p>准备要安装的新版本包</p></li> <li><p>==对新版本进行参数配置和编译，不需要安装make install==</p> <div class="language- extra-class"><pre class="language-text"><code>./configure
make
</code></pre></div></li></ol> <h3 id="方案一-使用nginx服务信号进行升级"><a href="#方案一-使用nginx服务信号进行升级" class="header-anchor">#</a> 方案一：使用nginx服务信号进行升级</h3> <ol><li><p>==对老版本sbin下的nginx进行备份==</p> <div class="language- extra-class"><pre class="language-text"><code>cd /usr/local/nginx/sbin
//改名
mv nginx nginxOld
</code></pre></div></li> <li><p>进入==新版本的objs==，==把里面的nginx文件拷贝到/usr/local/nginx/sbin目录下==</p> <div class="language- extra-class"><pre class="language-text"><code>cd ~/nginx/core/nginx-1.16.1/objs
cp nginx /usr/local/nginx/sbin
</code></pre></div></li> <li><p>使用usr2</p> <ul><li>==kill -usr2 老版本号的PID==</li> <li>==kill -quit 老版本号的PID==</li></ul></li> <li><p>检查是否更新成功</p> <ul><li>==./nginx -v==</li></ul></li></ol> <h3 id="方案二-使用nginx安装目录的make命令完成升级"><a href="#方案二-使用nginx安装目录的make命令完成升级" class="header-anchor">#</a> 方案二：使用nginx安装目录的make命令完成升级</h3> <p>前两步一样，第三步有变化</p> <p>==make upgrade（使用make前提在有Makefile的目录），底层实现还是调用了usr2、quit==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112092020558.png" alt="image-20211209202016477"></p> <h1 id="nginx核心配置文件结构"><a href="#nginx核心配置文件结构" class="header-anchor">#</a> nginx核心配置文件结构</h1> <blockquote><p>目录：/usr/local/nginx/conf/nginx.conf</p></blockquote> <ul><li><p>除了注释，nginx.conf的内容：</p> <div class="language- extra-class"><pre class="language-text"><code>worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;
        location / {
            root   html;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

}
</code></pre></div></li> <li><p>全局块：设置nginx服务器==整体运行的配置指令==</p> <ul><li>指令名  指令值</li></ul></li> <li><p>events块：设置服务器与用户的==网络连接==</p></li> <li><p>http块：==代理、缓存、日志记录、第三方模块配置……==</p></li></ul> <p>🚅nginx.conf配置文件默认有三大块：全局块、events块、http块</p> <p>📧==http==可以设置==多个server块==，每个==server块==又可以配置==多个location块==</p> <h2 id="全局块"><a href="#全局块" class="header-anchor">#</a> 全局块</h2> <h3 id="user指令"><a href="#user指令" class="header-anchor">#</a> user指令</h3> <blockquote><p>配置worker进程的用户和用户组</p> <p>✔️默认值：nobody</p> <p>✔️位置：全局块</p></blockquote> <ol><li><p>user www;</p></li> <li><p>==useradd www==</p></li> <li><p>创建/root/html/index.html，内容如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 35em<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>For online documentation and support please refer to
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://nginx.org/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>nginx.org<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
Commercial support is available at
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://nginx.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>nginx.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Thank you for using nginx.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>I am WWW<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>修改nginx.conf</p> <div class="language- extra-class"><pre class="language-text"><code>location / {
	root /root/html
	index index.html index.htm
}
</code></pre></div></li> <li><p>启动访问失败：403</p></li> <li><p>原因：当前用户(www)没有访问/root/html目录权限</p> <ul><li>这个可以自己测试，即==用要测试的用户登录，然后看能不能进入想要的目录==</li></ul></li> <li><p>将文件创建到/home/www/html/index.html</p> <div class="language- extra-class"><pre class="language-text"><code>location / {
	root /home/www/html
	index index.html index.htm
}
</code></pre></div></li> <li><p>访问成功</p></li></ol> <p>:happy:使用user指令，对于系统的权限访问控制的==更加精细和安全==</p> <h3 id="work-process-指令"><a href="#work-process-指令" class="header-anchor">#</a> work process 指令</h3> <ol><li><p>==master_process==   on|off</p> <ul><li>默认值：on（开启）</li> <li>位置：全局块</li> <li>作用：是否==开启worker进程==</li></ul></li> <li><p>==worker_processes==</p> <ul><li><p>默认值：1</p></li> <li><p>位置：全局块</p></li> <li><p>作用：开启==worker进程数量==，尽量和CPU的内核数保存一致</p></li> <li><p>设置为2，会看到如下所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101658374.png" alt="image-20211210165834580"></p></li></ul></li></ol> <h3 id="其它指令"><a href="#其它指令" class="header-anchor">#</a> 其它指令</h3> <ol><li><p>==daemon== on|off</p> <ul><li>默认值：on</li> <li>全局块</li> <li>作用：是否==守护进程==，不守护开启nginx后，不能进行任何操作，只能等进程结束（即ctrl+c退出进程）</li></ul></li> <li><p>pid file</p> <ul><li>默认值：/usr/local/nginx/logs/nginx.pid</li> <li>位置：全局块</li> <li>作用：master进程的进程号ID存储路径</li></ul></li> <li><p>==error_log==</p> <ul><li><p>默认值：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101706026.png" alt="image-20211210170617415"></p></li> <li><p>位置：除了event都有</p></li> <li><p>日志级别：debug|info|notice|warn|error|crit|alert|emerg|：调试、信息、通知、警告、错误、临界、警报、紧急，要在info之上，减少磁盘I/O消耗</p></li></ul></li> <li><p>==include==：引入其它配置文件，使nginx配置更灵活</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101712728.png" alt="image-20211210171241156"></p></li></ol> <h2 id="events块"><a href="#events块" class="header-anchor">#</a> events块</h2> <ol><li><p>==accept_mutex==：设置网络连接序列化</p> <ul><li><p>默认值：on</p></li> <li><p>位置：events</p></li> <li><p>开启后，一个一个唤醒接收，不开启会争夺，但最后还是只能一个狗获得</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101715893.png" alt="image-20211210171426417"></p></li></ul></li> <li><p>==multi_accept==：是否允许==多个网络连接worker==</p> <ul><li>默认值：off</li> <li>位置：events</li></ul></li> <li><p>==worker_connections==：一个worker最大连接数</p> <ul><li>默认值：512</li> <li>位置：events</li></ul></li> <li><p>use：选择哪种==事件驱动==来==处理网络消息==</p> <ul><li><p>默认值：操作系统定</p></li> <li><p>位置：events</p></li> <li><p>可选：select/poll/epoll/kqueue等</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101722894.png" alt="image-20211210172231629"></p></li></ul></li></ol> <h3 id="events指令配置实例"><a href="#events指令配置实例" class="header-anchor">#</a> events指令配置实例</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>events <span class="token punctuation">{</span>
    <span class="token comment">#设置网络连接序列号，默认on，即一个一个唤醒连接</span>
    accept_mutex on<span class="token punctuation">;</span>
    <span class="token comment">#默认off，设置进程是否可以多个网络连接</span>
    multi_accept on<span class="token punctuation">;</span>
    <span class="token comment">#单个worker最大连接数</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token comment">#设置哪种事件驱动来处理网络信息，linux2.6以上才支持epoll(多路复用)</span>
    use epoll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="http块"><a href="#http块" class="header-anchor">#</a> http块</h2> <h3 id="定义mime-type"><a href="#定义mime-type" class="header-anchor">#</a> 定义MIME-Type</h3> <blockquote><p>MIME-Type网络资源的媒体类型</p></blockquote> <p>✔️include mine.types相当于把mine.types文件加入nginx.conf的配置文件中</p> <p>✔️位置：http、server、location</p> <p>✔️例：请求文本或者json字符串，使用固定字符串，可以使用nginx快速实现，就不用程序响应请求</p> <ul><li><div class="language-shell extra-class"><pre class="language-shell"><code>      <span class="token comment">#自定义普通文本文件</span>
      location /get_text <span class="token punctuation">{</span>
          <span class="token comment">#access_log   logs/text.log myFormat;</span>
          default_type text/html<span class="token punctuation">;</span>
          <span class="token builtin class-name">return</span> <span class="token number">200</span> <span class="token string">&quot;&lt;h1&gt;This is a nginx's text&lt;/h1&gt;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      location /get_json <span class="token punctuation">{</span>
          default_type application/json<span class="token punctuation">;</span>
          <span class="token builtin class-name">return</span> <span class="token number">200</span> <span class="token string">'{name:&quot;luo&quot;,age:18}'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="自定义服务日志"><a href="#自定义服务日志" class="header-anchor">#</a> 自定义服务日志</h3> <blockquote><p>对日志的格式、大小、输出等进行自定义，需要两个指令</p> <ul><li>==access_log==</li> <li>==log_format==</li></ul></blockquote> <ol><li><p>access_log：成功日志路径</p></li> <li><p>log_format：日志输出格式</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101733957.png" alt="image-20211210173348925"></p></li></ol> <h3 id="其它配置指令"><a href="#其它配置指令" class="header-anchor">#</a> 其它配置指令</h3> <ol><li>==sendfile==：传输文件，提高处理静态资源的性能
<ul><li>默认值：off</li> <li>位置：http、server、location</li></ul></li> <li>==keepalive_timeout==：设置长连接的超时时间
<ul><li>即三次握手，四次挥手</li> <li>处理完一个请求后保存TCP连接打开状态，若有其它请求，服务端利用这个未被关闭的连接，不需要创建新连接</li> <li>默认值：75s</li> <li>位置：http、server、location</li></ul></li> <li>==keepalive_requests==：设置一个keep-alive连接使用次数
<ul><li>默认值：100</li> <li>位置：http、server、location</li></ul></li></ol> <h2 id="server和location块"><a href="#server和location块" class="header-anchor">#</a> server和location块</h2> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112101740025.png" alt="image-20211210174053086"></p> <h1 id="nginx进阶篇"><a href="#nginx进阶篇" class="header-anchor">#</a> nginx进阶篇</h1> <h2 id="nginx服务器基础配置实例"><a href="#nginx服务器基础配置实例" class="header-anchor">#</a> nginx服务器基础配置实例</h2> <p>:happy:需求：</p> <div class="language- extra-class"><pre class="language-text"><code>1、访问192.168.200.129:8081/server1/location1：返回index_sr1_location1.html
2、访问192.168.200.129:8081/server2/location2：返回index_sr1_location2.html
3、访问192.168.200.129:8082/server1/location1：返回index_sr2_location1.html
4、访问192.168.200.129:8082/server2/location1：返回index_sr2_location2.html
5、404返回自定义404页面
6、server1和server2配置分开放
7、server1和server2格子有访问日志文件
</code></pre></div><p>:happy:目录如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112112246532.png" alt="image-20211211224611486"></p> <ul><li><p>nginx.conf的配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#更改用户</span>
user  www<span class="token punctuation">;</span>
<span class="token comment">#设置worker数量</span>
worker_processes  <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">#默认错误路径在logs/error.log</span>
<span class="token comment">#error_log  logs/error.log;</span>

<span class="token comment">#默认masterPID路径在logs/nginx.pid</span>
<span class="token comment">#pid        logs/nginx.pid;</span>

<span class="token comment">#默认以守护进程方式启动</span>
<span class="token comment">#daemon on;</span>

<span class="token comment">#以后这个直接复制</span>
events <span class="token punctuation">{</span>
    <span class="token comment">#设置网络连接序列化</span>
    accept_mutex on<span class="token punctuation">;</span>
    <span class="token comment">#设置worker是否可以同时连接多个</span>
    multi_accept on<span class="token punctuation">;</span>
    <span class="token comment">#同时连接多个上限</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token comment">#事件驱动模型</span>
    use epoll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    <span class="token comment">#使用default_type代表application/octet-stream</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>

    <span class="token comment">#使用sendfile传输</span>
    sendfile        on<span class="token punctuation">;</span>

    <span class="token comment">#配置连接超时时间</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#配置日志格式</span>
    log_format server1 <span class="token string">'===&gt;server1 access log'</span><span class="token punctuation">;</span>
    log_format server2 <span class="token string">'===&gt;server2 access log'</span><span class="token punctuation">;</span>

    <span class="token comment">#引入自定义配置</span>
    include /home/www/conf.d/*.conf<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>server1.conf</p> <div class="language-shell extra-class"><pre class="language-shell"><code>server<span class="token punctuation">{</span>
        <span class="token comment">#监听的端口</span>
        listen <span class="token number">8081</span><span class="token punctuation">;</span>
        <span class="token comment">#主机名</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token comment">#成功访问后日志路径（试试能不能改路径/myweb/server1/logs/access.log,答案不行,其实每个location最后都用了绝对路径）</span>
        access_log /home/www/myweb/server1/logs/access.log server1<span class="token punctuation">;</span>
        <span class="token comment">#设置访问的路径</span>
        location /server1/location1 <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                index index_sr1_location1.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location /server1/location2 <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                index index_sr1_location2.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#错误日志路径</span>
        error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /404.html <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                <span class="token comment">#可以试试把这个删了，因为上面写了404.html(error_page),root可以不用写，但alias需要</span>
                <span class="token comment">#index 404.html;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>server2.conf</p> <div class="language-shell extra-class"><pre class="language-shell"><code>server<span class="token punctuation">{</span>
        <span class="token comment">#监听的端口</span>
        listen <span class="token number">8082</span><span class="token punctuation">;</span>
        <span class="token comment">#主机名</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token comment">#成功访问后日志路径（试试能不能改路径/server2/logs/access.log）</span>
        access_log /home/www/myweb/server2/logs/access.log server1<span class="token punctuation">;</span>
        <span class="token comment">#设置访问的路径</span>
        location /server2/location1 <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                index index_sr2_location1.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location /server2/location2 <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                index index_sr2_location2.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#错误日志路径</span>
        error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /404.html <span class="token punctuation">{</span>
                root /home/www/myweb<span class="token punctuation">;</span>
                <span class="token comment">#可以试试把这个删了，因为上面写了404.html(error_page)</span>
                index <span class="token number">404</span>.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></li></ul> <h2 id="nginx服务操作的问题"><a href="#nginx服务操作的问题" class="header-anchor">#</a> nginx服务操作的问题</h2> <blockquote><p>如果想启动、关闭或重新加载nginx，需要进入它的配置文件，有点繁琐</p></blockquote> <p>优化：</p> <p>​	✔️配置为系统服务</p> <p>​	✔️命令配置到系统环境</p> <h2 id="nginx配置成系统服务"><a href="#nginx配置成系统服务" class="header-anchor">#</a> nginx配置成系统服务</h2> <ol><li><p>==vim /usr/lib/systemd/system/nginx.service==</p></li> <li><p>添加如下内容：</p> <div class="language-scss extra-class"><pre class="language-scss"><code>[Unit]
Description=nginx web service
Documentation=<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//nginx.org/en/docs/</span>
After=network.target

[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid
ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
ExecStart=/usr/local/nginx/sbin/nginx
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s stop
PrivateTmp=<span class="token boolean">true</span>

[Install]
WantedBy=default.target
</code></pre></div></li> <li><p>修改权限：==chmod 755  /usr/lib/systemd/system/nginx.service==</p></li> <li><p>接下来可以使用：</p> <ul><li>启动：systemctl start nginx</li> <li>停止：systemctl stop nginx</li> <li>重启：systemctl restart nginx</li> <li>重新加载：systemctl reload nginx</li> <li>状态：systemctl status nginx</li></ul></li></ol> <h2 id="nginx命令配置到系统环境"><a href="#nginx命令配置到系统环境" class="header-anchor">#</a> nginx命令配置到系统环境</h2> <ol><li><p>vim /etc/profile</p></li> <li><p>在最后一行加：==export PATH=$PATH:$JAVA_HOME/bin:/usr/local/nginx/sbin==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112120952172.png" alt="image-20211212095247984"></p></li> <li><p>生效：==source /etc/profile==</p></li> <li><p>执行命令：</p> <ul><li>nginx -V</li> <li>nginx -t</li> <li>nginx -s reload</li> <li>nginx -s stop</li></ul></li></ol> <h2 id="nginx静态资源部署"><a href="#nginx静态资源部署" class="header-anchor">#</a> nginx静态资源部署</h2> <h3 id="nginx静态资源概述"><a href="#nginx静态资源概述" class="header-anchor">#</a> nginx静态资源概述</h3> <p>✔️静态资源：服务端真实存在，能直接拿出来，例：html、css、js、图片、视频等</p> <p>✔️动态资源：服务端真实存在，但需要业务逻辑处理才能取出来 ，例报表数据、登录用户不同展示不同数据等</p> <p>:happy:nginx处理静态内容，考虑如下问题：</p> <div class="language- extra-class"><pre class="language-text"><code>静态资源的配置指令
静态资源的配置优化
静态资源的压缩配置指令
静态资源的缓存处理
静态资源的访问控制，包括跨域问题和防盗链问题
</code></pre></div><h3 id="nginx静态资源的配置指令"><a href="#nginx静态资源的配置指令" class="header-anchor">#</a> nginx静态资源的配置指令</h3> <h4 id="listen指令"><a href="#listen指令" class="header-anchor">#</a> listen指令</h4> <ul><li>listen：配置监听端口
<ul><li>默认值：80</li> <li>位置：server</li> <li>例：
<ul><li>listen 8080;            指定端口</li></ul></li> <li>default_server属性是标识符，默认主机，如果==不指定默认，==则==默认是第一个server==</li> <li><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121014586.png" alt="image-20211212101453776"></li></ul></li></ul> <h4 id="server-name指令"><a href="#server-name指令" class="header-anchor">#</a> server_name指令</h4> <ul><li>server_name：设置虚拟主机服务名称</li> <li>例：127.0.0.1、localhos、域名【www.baidu.com】【www.jd.com】</li> <li>三种配置：
<ul><li>精确匹配</li> <li>通配符匹配</li> <li>正则表达式匹配</li></ul></li></ul> <p>✔️精确匹配</p> <div class="language- extra-class"><pre class="language-text"><code>server {
	listen 80;
	server_name www.baidu.com  www.itcast.cn;
	……
}
</code></pre></div><p>😄补充小知识点：hosts是一个没有扩展名的系统文件，登录网址时，系统==首先从hosts==文件中寻找对应的IP地址，如果没有找到，再从==DNS域名解析服务器进行IP地址解析==</p> <ul><li>windows：C:\Windows\System32\drivers\etc</li> <li>cenots：/etc/hosts</li> <li>配置虚拟域名：
<ol><li>==vim /etc/hosts==</li> <li>127.0.0.1 www.baidu.com       127.0.0.1 www.itheima.com</li></ol></li></ul> <p>✔️通配符匹配</p> <ul><li><p>通配符不能出现在域名中间，只能在首段或尾段</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code>server<span class="token punctuation">{</span>
	<span class="token comment">#通配符在前</span>
    server<span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name *<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        default_type text/plain<span class="token punctuation">;</span>
        return <span class="token number">200</span> <span class="token string">'wildcard_before_success'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">#通配符在后</span>
    server<span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
        default_type text/plain<span class="token punctuation">;</span>
        return <span class="token number">200</span> <span class="token string">'wildcard_after_success'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>✔️正则表达式配置</p> <ul><li><p>正则表达式开始的标记~</p></li> <li><p>常见的正则表达式：</p> <ol><li>^(常用)：字符串开始</li> <li>$(常用)：字符串结束</li> <li>(常用)：转义字符</li> <li>[xyz]：字符集，与其中任意一个指定字符匹配</li> <li>[a-z]：字符范围</li> <li>\w(常用)：A-Z、a-z、0-9和下划线_ ，等效于[A-Za-z0-9_]</li> <li>\d：数字匹配，等效于[0-9]</li> <li>{n}：正好匹配n次</li> <li>{n,}：至少匹配n次</li> <li>{n,m}：至少n次，至多m次</li> <li>*(常用)：零次或多次，等价于{0,}</li> <li>+：一次或多次，等价于{1,}</li> <li>?：零次或一次，等价于{0,1}</li></ol></li> <li><p>例：</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code>	<span class="token comment">#正则表达式</span>
    server<span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token comment">#\.转义，\w+，输入一次或多次</span>
        <span class="token comment">#~^开始</span>
        <span class="token comment">#$结束</span>
        server_name ~^www\<span class="token punctuation">.</span><span class="token punctuation">(</span>\w+<span class="token punctuation">)</span>\<span class="token punctuation">.</span>com$<span class="token punctuation">;</span>
        default_type text/plain<span class="token punctuation">;</span>
        return <span class="token number">200</span> <span class="token string">'regex_success'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h5 id="匹配执行顺序"><a href="#匹配执行顺序" class="header-anchor">#</a> 匹配执行顺序</h5> <ul><li><p>三种匹配都有，哪个优先？</p> <div class="language- extra-class"><pre class="language-text"><code>  	#server
    #精确匹配
    server{
        listen 80;
        server_name www.baidu.com;
        default_type text/plain;
        return 200 'exact_success';
    }
    #通配符在前
    server{
        listen 80;
        server_name *.baidu.com;
        default_type text/plain;
        return 200 'wildcard_before_success';
    }
    #通配符在后
    server{
        listen 80;
        server_name www.baidu.*;
        default_type text/plain;
        return 200 'wildcard_after_success';
    }
    #正则表达式
    server{
        listen 80;
        server_name ~^www\.(\w+)\.com$;
        default_type text/plain;
        return 200 'regex_success';
    }
    #默认
    server{
        listen 80 default_server;
        server_name localhost;
        default_type text/plain;
        return 444 'default_server error';
	}
</code></pre></div><p>😙结论</p> <div class="language- extra-class"><pre class="language-text"><code>exact_success	精确
wildcard_before_success		通配符前
wildcard_after_success		通配符后
regex_success		正则表达式
default_server not found server!!	默认
</code></pre></div></li></ul> <h4 id="location指令"><a href="#location指令" class="header-anchor">#</a> location指令</h4> <ul><li>location：设置请求的URL</li> <li>属性介绍：</li></ul> <p>✔️不带符号</p> <div class="language- extra-class"><pre class="language-text"><code>server {
	listen 80;
	server_name 127.0.0.1;
	location =/abc{
		default_type text/plain;
		return 200 &quot;access success&quot;;
	}
}
只要加了abc，后面什么都可以加
http://192.168.164.129/abc
http://192.168.164.129/abc?p1=TOM
http://192.168.164.129/abc/
http://192.168.164.129/abcdef
</code></pre></div><p>✔️带等号=</p> <div class="language- extra-class"><pre class="language-text"><code>server {
	listen 80;
	server_name 127.0.0.1;
	location =/abc{
		default_type text/plain;
		return 200 &quot;access success&quot;;
	}
}
可以访问（精确访问，?相当于传参不影响）
http://192.168.164.129/abc
http://192.168.164.129/abc?p1=TOM
不可以
http://192.168.164.129/abc/
http://192.168.164.129/abcdef
</code></pre></div><p>✔️带正则表达式，使用~(区分大小写) 或 ~*(不区分大小写)</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code>server <span class="token punctuation">{</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>
	server_name <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">;</span>
	location ~^/abc\w$<span class="token punctuation">{</span>
		default_type text/plain<span class="token punctuation">;</span>
		return <span class="token number">200</span> <span class="token string">&quot;access success&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>
	server_name <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">;</span>
	<span class="token comment">#/abc：即地址后面加/abc</span>
	location ~*^/abc\w$<span class="token punctuation">{</span>
		default_type text/plain<span class="token punctuation">;</span>
		return <span class="token number">200</span> <span class="token string">&quot;access success&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>✔️带符号^~(不是正则表达式)，而==正则表达式是 ~^==，作用是如果匹配到了，就不继续找后面server(后面可能有相同的URL)</p> <h4 id="设置请求资源的目录root-alias"><a href="#设置请求资源的目录root-alias" class="header-anchor">#</a> 设置请求资源的目录root/alias</h4> <ul><li>root：设置请求的根目录</li> <li>alias：更改location的URL，即location后面配置的无效</li></ul> <p>✔️root</p> <ul><li>默认值：html</li> <li>位置：http、server、location</li></ul> <p>✔️两者区别</p> <ol><li>root处理结果是：==root路径+location路径==</li> <li>alias处理结果是：==alias路径替换location路径==</li></ol> <h4 id="index指令"><a href="#index指令" class="header-anchor">#</a> index指令</h4> <ul><li>index：设置网站默认首页
<ul><li>默认值：index.html、index.htm，从左往右找，直到找到第一个为止</li></ul></li></ul> <h4 id="error-page指令"><a href="#error-page指令" class="header-anchor">#</a> error_page指令</h4> <ul><li><p>error_page：设置网站错误页面</p> <ol><li><p>可以指定具体跳转地址：erroe_page 404 http://www.baidu.com</p></li> <li><p>指定重定向地址和使用=200把状态码改掉</p> <div class="language- extra-class"><pre class="language-text"><code>    #设置错误后状态码改为200，使用=200即可,/50x.html使重定向
    error_page 404 =200 /50x.html;
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
    	root   html;
    }
</code></pre></div></li> <li><p>使用location的@完成错误信息展示（等同于使用重定向展示错误信息）</p> <div class="language- extra-class"><pre class="language-text"><code>server{
	error_page 404 @jump_to_error;
	location @jump_to_error {
		default_type text/plain;
		return 404 'Not Found Page...';
	}
}
</code></pre></div></li></ol></li></ul> <h3 id="静态资源优化配置语法"><a href="#静态资源优化配置语法" class="header-anchor">#</a> 静态资源优化配置语法</h3> <p>:happy:三个属性配置优化：一般三个都一起开</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code>    <span class="token comment">#传输方式</span>
    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#不推送，即先存储</span>
    tcp_nopush      on<span class="token punctuation">;</span>
    <span class="token comment">#没有延迟，即实时推送</span>
    tcp_nodelay     on<span class="token punctuation">;</span>
</code></pre></div><p>✔️sendfile，开启高效的文件传输模式</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121113110.png" alt="image-20211212111335833"></p> <p>✔️==tcp_nopush==：必须在==sendfile==打开状态下才生效，提高传输效率</p> <p>✔️==tcp_nodelay==：必须在==keep-alive==开启下才生效，提高网络包传输的实时性</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121115350.png" alt="image-20211212111529259"></p> <h3 id="nginx静态资源压缩实战"><a href="#nginx静态资源压缩实战" class="header-anchor">#</a> nginx静态资源压缩实战</h3> <p>nginx通过如下模块对压缩指令进行解析和处理</p> <div class="language- extra-class"><pre class="language-text"><code>ngx_http_gzip_module模块
ngx_http_gzip_static_module模块
ngx_http_gunzip_module模块
</code></pre></div><p>学习内容如下：</p> <ol><li>Gzip各模块支持的配置指令</li> <li>Gzip压缩功能的配置</li> <li>Gzip和sendfile的冲突解决</li> <li>浏览器不支持Gzip的解决方案</li></ol> <h4 id="gzip模块配置指令"><a href="#gzip模块配置指令" class="header-anchor">#</a> Gzip模块配置指令</h4> <blockquote><p>接下来指令来自ngx_http_gzip_module模块</p></blockquote> <ol><li><p>gzip指令：开启或关闭gzip功能</p></li> <li><p>==gzip_types==：根据响应页的MIME类型选择性开启Gzip压缩功能</p> <div class="language- extra-class"><pre class="language-text"><code>    #选择性开启gzip压缩
    gzip_types application/javascript;
</code></pre></div></li> <li><p>==gzip_comp_level==：设置压缩程度，1-9，1压缩程度低，但效率高，时间少，而9相反</p></li> <li><p>==gzip_vary==：告诉接收方所发送的数据经过Gzip压缩处理</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121128138.png" alt="image-20211212112810166"></p></li> <li><p>==gzip_buffers==：处理请求压缩的缓冲区数量和大小，和服务器的操作系统有关，使用默认值即可</p></li> <li><p>==gzip_disable==：针对客户端种类发起的请求，选择性开启和关闭Gzip功能</p> <ul><li>gzip_disable &quot;~^Mozilla/5.0.*$&quot;;</li></ul></li> <li><p>==gzip_http_version==：针对不同的HTTP协议版本，选择性开启和关闭Gzip功能，默认即可</p></li> <li><p>==gzip_min_length==：对传输数据大小做要求，不能小于指定的</p> <ul><li>gzip_min_length 252874;</li></ul></li> <li><p>==gzip_proxied==：是否对==服务器返回的结果==进行Gzip压缩，反向代理方面的</p> <ul><li>off：关闭</li> <li>expired：header头中包含&quot;Expires&quot;，启用压缩</li> <li>no-cache：header头中包含&quot;Cache-Control:no-cache&quot;，启用压缩</li> <li>no-store：header头中包含&quot;Cache-Control:no-store&quot;，启用压缩</li> <li>private：header头中包含&quot;Cache-Control:private&quot;，启用压缩</li> <li>no_last_modified：header头中不包含&quot;Last-Modified&quot;，启用压缩</li> <li>no_etag：header头中不包含&quot;ETag&quot;，启用压缩</li> <li>auth：header头中包含&quot;Authorization&quot;，启用压缩</li> <li>any：无条件启用压缩</li></ul></li></ol> <h4 id="gzip压缩功能的实例匹配"><a href="#gzip压缩功能的实例匹配" class="header-anchor">#</a> Gzip压缩功能的实例匹配</h4> <blockquote><p>很多地方可能用到该指令，抽取到一个配置文件中，使用的时候使用include指令</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>  	#是否开启gzip压缩
    gzip on;
    #选择性开启gzip压缩
    gzip_types application/javascript;
    #压缩的程度，1~9，9压缩程度高，但费时间，影响效率
    gzip_comp_level 6;
    #告诉接收方，自己使用了gzip压缩
    gzip_vary   on;
    #针对不同种类客户端开启gzip，使用正则表达式
    gzip_disable &quot;MSIE [1-6]\.&quot;; #对IE6以下的版本都不进行压缩
    #设置最小压缩大小
    gzip_min_length 252874;
    gzip_buffers 4 16K;	  #缓存空间大小
    gzip_http_version 1.1; #指定压缩响应所需要的最低HTTP请求版本
    gzip_proxied  off; #nginx作为反向代理压缩服务端返回数据的条件
</code></pre></div><h4 id="gzip和sendfile共存问题"><a href="#gzip和sendfile共存问题" class="header-anchor">#</a> Gzip和sendfile共存问题</h4> <blockquote><p>sendfile不经过用户进程，但是Gzip需要经过用户进程</p> <p>解决方法：使用==ngx_gzip_static_module==模块的==gzip_static==指令解决</p></blockquote> <h5 id="gzip-static指令"><a href="#gzip-static指令" class="header-anchor">#</a> gzip_static指令</h5> <ul><li><p>gzip_static：检查与==访问资源同名的.gz文件==</p> <ul><li><p>默认值：off，可选on、always</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121625009.png" alt="image-20211210220035393"></p></li> <li><p>添加上述命令后报错，找不到gzip_static，因为配置./configure没有添加</p></li></ul></li></ul> <h5 id="添加模块到nginx的实现步骤"><a href="#添加模块到nginx的实现步骤" class="header-anchor">#</a> 添加模块到nginx的实现步骤</h5> <ol><li><p>==nginx -V==</p> <div class="language- extra-class"><pre class="language-text"><code>./configure --prefix=/usr/local/nginx \
--sbin-path=/usr/local/nginx/sbin/nginx \
--modules-path=/usr/local/nginx/modules \
--conf-path=/usr/local/nginx/conf/nginx.conf \
--error-log-path=/usr/local/nginx/logs/error.log \
--http-log-path=/usr/local/nginx/logs/access.log \
--pid-path=/usr/local/nginx/logs/nginx.pid \
--lock-path=/usr/local/nginx/logs/nginx.lock
</code></pre></div></li> <li><p>==cd /usr/local/nginx/sbin==                ==mv nginx nginxold==：改名（相等于备份）</p></li> <li><p>==cd /root/nginx/core/nginx-1.16.1==</p></li> <li><p>==make clean==：清空之前编译的内容</p></li> <li><p>使用configure来重新配置参数</p> <div class="language- extra-class"><pre class="language-text"><code>./configure --prefix=/usr/local/nginx \
--sbin-path=/usr/local/nginx/sbin/nginx \
--modules-path=/usr/local/nginx/modules \
--conf-path=/usr/local/nginx/conf/nginx.conf \
--error-log-path=/usr/local/nginx/logs/error.log \
--http-log-path=/usr/local/nginx/logs/access.log \
--pid-path=/usr/local/nginx/logs/nginx.pid \
--lock-path=/usr/local/nginx/logs/nginx.lock  --with-http_gzip_static_module
</code></pre></div></li> <li><p>make：重新编译</p></li> <li><p>==mv objs/nginx /usr/local/nginx/sbin== ：把脚本移到sbin目录下</p></li> <li><p>执行更新命令：==make upgrade==</p> <p>✔️注意：有make必须在MakeFile下才能执行</p></li></ol> <h5 id="gzip-static测试使用"><a href="#gzip-static测试使用" class="header-anchor">#</a> gzip_static测试使用</h5> <p>✔️压缩前</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121631823.png" alt="image-20211212163149810"></p> <p>✔️压缩后：</p> <ul><li><p>cd /usr/local/nginx/html</p></li> <li><p>gzip jquery.js</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112121632351.png" alt="image-20211212163231170"></p></li></ul> <h2 id="静态资源的缓存处理"><a href="#静态资源的缓存处理" class="header-anchor">#</a> 静态资源的缓存处理</h2> <h3 id="什么是缓存"><a href="#什么是缓存" class="header-anchor">#</a> 什么是缓存</h3> <blockquote><p>访问速度比随机存取存储器（RAM）快</p></blockquote> <h3 id="什么是web缓存"><a href="#什么是web缓存" class="header-anchor">#</a> 什么是web缓存</h3> <blockquote><p>web资源存在于web服务器和客户端（浏览器）之间的副本，例：浏览器缓存过网站的网页，当再次访问URL地址时，直接使用本地缓存的网页</p></blockquote> <h3 id="web缓存的种类"><a href="#web缓存的种类" class="header-anchor">#</a> web缓存的种类</h3> <div class="language- extra-class"><pre class="language-text"><code>客户端缓存
	浏览器缓存
服务端缓存
	Nginx/Redis/Mencached等
</code></pre></div><h3 id="为什么要用浏览器缓存"><a href="#为什么要用浏览器缓存" class="header-anchor">#</a> 为什么要用浏览器缓存</h3> <div class="language- extra-class"><pre class="language-text"><code>成本最低的缓存
减少网络带宽消耗
降低服务器压力
减少网络延迟，加快页面打开速度
</code></pre></div><h3 id="浏览器缓存的执行流程"><a href="#浏览器缓存的执行流程" class="header-anchor">#</a> 浏览器缓存的执行流程</h3> <p>✔️和页面(header)缓存相关的字段：</p> <ul><li>Expires：缓存过期的日期和时间</li> <li>Cache-Control：和==缓存相关的配置信息==</li> <li>Last-Modified：资源最后修改时间</li> <li>ETag：请求变量实体标签的的的当前值，比如文件的==MD5值==</li></ul> <p><img src="/learn-vuepress/assets/img/202112142227793.99b6f827.png" alt="image-20211212213127899"></p> <ol><li>第一次请求，发送request获取数据</li> <li>服务端返回200状态码并且在响应头附上对应资源以及缓存信息</li> <li>==再次访问==，客户端在浏览器的缓存中找资源</li> <li>如果没有，走第二步</li> <li>有，接下来判断是否过期，过期判断标准是Expires</li> <li>没有==过期==，返回数据</li> <li>过期，判断缓存是否发生变化
<ul><li>一个是ETag，一个是Last-Modified</li></ul></li> <li>==未发生变化，返回304==，直接从缓存取数据</li> <li>发生变化，重新从服务端获取数据</li></ol> <h3 id="浏览器缓存相关指令"><a href="#浏览器缓存相关指令" class="header-anchor">#</a> 浏览器缓存相关指令</h3> <h4 id="expires指令"><a href="#expires指令" class="header-anchor">#</a> expires指令</h4> <ul><li><p>==expires==：控制页面缓存，HTTP应答中的Expires和Cache-Control</p> <ul><li><p>max：Cache-Control值为10年</p></li> <li><p>time：负数，Cache-Control值为no-cache，整数，值为对应的整数</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142240383.png" alt="image-20211213100531204"></p></li></ul></li></ul> <h4 id="add-header指令"><a href="#add-header指令" class="header-anchor">#</a> add_header指令</h4> <ul><li>指定响应头和响应值
<ol><li>must-revalidate：可缓存但必须向服务器进行确认</li> <li>no-cache：缓存前确认有效性</li> <li>==no-store==：不缓存任何</li> <li>no-transform：不可更改</li> <li>public：任意都缓存</li> <li>private：指定用户缓存</li> <li>proxy-revalidate：中间服务器对响应再进行确认</li> <li>max-age=&lt;秒&gt;：响应最大Age值</li> <li>s-maxage=&lt;秒&gt;：公共缓存服务器响应的最大Age值</li></ol></li></ul> <h2 id="nginx的跨域问题解决"><a href="#nginx的跨域问题解决" class="header-anchor">#</a> Nginx的跨域问题解决</h2> <div class="language- extra-class"><pre class="language-text"><code>什么情况下出现跨域问题？
实例演示跨域问题
具体的解决方案是什么？
</code></pre></div><h3 id="同源策略"><a href="#同源策略" class="header-anchor">#</a> 同源策略</h3> <p>:happy:浏览器的一种约定，最核心最基本的安全功能，同源：==协议、域名（IP）、端口相同==即为同源</p> <ul><li>http和https：不</li> <li>192.168.164.129和192.168.164.128：不</li> <li>192.168.164.129和192.168.164.128:8080：不。不写默认是80端口，80和8080端口不一样</li> <li>192.168.164.129和192.168.164.128:80：是</li></ul> <h3 id="跨域问题"><a href="#跨域问题" class="header-anchor">#</a> 跨域问题</h3> <p>:happy:简单描述：两台服务器A、B，==服务器A的页面发送异步请求服务器B的数据==，如果A和B不满足同源策略，则出现跨域问题</p> <h3 id="跨域问题的案例演示"><a href="#跨域问题的案例演示" class="header-anchor">#</a> 跨域问题的案例演示</h3> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142253813.png" alt="image-20211214225327393"></p> <ol><li><p>nginx的html目录下创建a.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>跨域问题演示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
         //这里可能要改
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.164.129:8080/getUser'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>获取数据<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></li> <li><p>nginx.conf配置</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">{</span>
        listen  <span class="token number">8080</span><span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        location <span class="token operator">/</span>getUser<span class="token punctuation">{</span>
                default_type application<span class="token operator">/</span>json<span class="token punctuation">;</span>
                <span class="token comment">//属性一定要加双引号</span>
                <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'{&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18}'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>浏览器访问测试</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142302487.png" alt="image-20211214230240507"></p></li></ol> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h3> <p>✔️使用add_header指令添加一些头信息</p> <ul><li><p>解决跨域问题的两个头信息</p> <ul><li>==Access-Control-Allow-Origin==：允许跨域，多个逗号分隔，使用*代表所有源</li> <li>==Access-Control-Allow-Methods==：允许跨域访问的请求方式，值为POST(增)、DELETE(删)、PUT(改)、GET(查)</li></ul></li> <li><p>具体配置</p> <div class="language-js extra-class"><pre class="language-js"><code>location <span class="token operator">/</span>getUser<span class="token punctuation">{</span>
    add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin <span class="token operator">*</span><span class="token punctuation">;</span>
    add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Methods <span class="token constant">GET</span><span class="token punctuation">,</span><span class="token constant">POST</span><span class="token punctuation">,</span><span class="token constant">PUT</span><span class="token punctuation">,</span><span class="token constant">DELETE</span><span class="token punctuation">;</span>
    default_type application<span class="token operator">/</span>json<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'{&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18}'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="静态资源防盗链"><a href="#静态资源防盗链" class="header-anchor">#</a> 静态资源防盗链</h2> <h3 id="什么是资源盗链"><a href="#什么是资源盗链" class="header-anchor">#</a> 什么是资源盗链</h3> <blockquote><p>资源盗链指内容不在自己服务器上，盗取大网站空间和流量，==用别人的东西成就自己的网站==</p></blockquote> <p>从下图可知：百度防止盗链，而京东没有</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142310403.png" alt="image-20211214231002999"></p> <h3 id="nginx防盗链的实现原理"><a href="#nginx防盗链的实现原理" class="header-anchor">#</a> Nginx防盗链的实现原理</h3> <p>✔️HTTP的头信息Referer，告诉浏览器该网页从哪个页面链接过来的</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142311478.png" alt="image-20211214231134043"></p> <p>:happy:如果是自己==信任的网站地址，放行，否则返回403（服务器拒绝访问）==的状态信息</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112142313493.png" alt="image-20211214231310122"></p> <ul><li><p>防盗链的具体实现：</p> <ul><li><p>valid_referers：查看referer和自己定义的内容是否匹配，匹配到==valid-referers值置为0，否则为1==</p></li> <li><p>none：referer为空，允许访问</p></li> <li><p>blocked：不带http://、https://等协议允许访问</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181724209.png" alt="image-20211218172409194"></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181724772.png" alt="image-20211218172426750"></p></li></ul></li></ul> <h3 id="针对目录进行防盗链"><a href="#针对目录进行防盗链" class="header-anchor">#</a> 针对目录进行防盗链</h3> <p>✔️配置如下</p> <div class="language-js extra-class"><pre class="language-js"><code>        #防盗链问题
        location <span class="token operator">/</span>images <span class="token punctuation">{</span>
                valid_referers none blocked www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> $invalid_referer <span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                root html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>✔️问题：</p> <ul><li>referer的限制比较粗鲁</li> <li>解决方法，使用nginx的第三方模块==ngx_http_accesskey_module==</li></ul> <h2 id="rewrite功能配置"><a href="#rewrite功能配置" class="header-anchor">#</a> Rewrite功能配置</h2> <blockquote><p>实现URL的重写</p> <p>注意：rewrite功能依赖于==PCRE==的支持，nginx使用==ngx_http_rewrite_module==模块来解析和处理Rewrite功能的相关配置</p></blockquote> <h3 id="地址重写-与-地址转发"><a href="#地址重写-与-地址转发" class="header-anchor">#</a> “地址重写”与“地址转发”</h3> <ol><li><p>重写==地址==会发生变化，转发不会</p></li> <li><p>重写产生==两次==请求，而转发一次请求</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181732331.png" alt="image-20211218173251412"></p></li> <li><p>重写的页面必须是一个==完整的路径==，而转发不需要</p></li> <li><p>重写request范围内属性==不能传递给新页面，==而转发可以传递值</p></li> <li><p>转发==速度==快于重写</p></li></ol> <h3 id="rewrite规则"><a href="#rewrite规则" class="header-anchor">#</a> Rewrite规则</h3> <h3 id="set指令"><a href="#set指令" class="header-anchor">#</a> set指令</h3> <blockquote><p>设置一个新的变量</p></blockquote> <ul><li>例：==set $name zhangsan==;</li></ul> <h3 id="rewrite常用全局变量"><a href="#rewrite常用全局变量" class="header-anchor">#</a> Rewrite常用全局变量</h3> <p>✔️前面都加$</p> <table><thead><tr><th style="text-align:center;">变量</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">$==args==</td> <td style="text-align:center;">存放请求路径的参数，192.168.164.129:8081/server?a1=2&amp;a2=3，其中的a1=2&amp;a2=3</td></tr> <tr><td style="text-align:center;">http_user_agent</td> <td style="text-align:center;">记录浏览器的相关版本信息</td></tr> <tr><td style="text-align:center;">==host==</td> <td style="text-align:center;">服务器的server_name</td></tr> <tr><td style="text-align:center;">document_uri</td> <td style="text-align:center;">URI地址</td></tr> <tr><td style="text-align:center;">document_root</td> <td style="text-align:center;">对应location的root值，未设置，默认是nginx自带的html位置</td></tr> <tr><td style="text-align:center;">content_length</td> <td style="text-align:center;">请求头中的content_length</td></tr> <tr><td style="text-align:center;">http_cookie</td> <td style="text-align:center;">客户端的cookie信息</td></tr> <tr><td style="text-align:center;">limit_rate</td> <td style="text-align:center;">服务器对网络连接速率的限制，默认0，不限制</td></tr> <tr><td style="text-align:center;">remote_addr</td> <td style="text-align:center;">客户端的IP地址</td></tr> <tr><td style="text-align:center;">remote_port</td> <td style="text-align:center;">客户端与服务器端连接的端口号</td></tr> <tr><td style="text-align:center;">remote_user</td> <td style="text-align:center;">客户端的用户名</td></tr> <tr><td style="text-align:center;">scheme</td> <td style="text-align:center;">访问协议</td></tr> <tr><td style="text-align:center;">server_addr</td> <td style="text-align:center;">服务端地址</td></tr> <tr><td style="text-align:center;">server_name</td> <td style="text-align:center;">服务器的名称</td></tr> <tr><td style="text-align:center;">server_port</td> <td style="text-align:center;">服务器的端口号</td></tr> <tr><td style="text-align:center;">server_protocol</td> <td style="text-align:center;">版本，例”HTTP/1.1“</td></tr> <tr><td style="text-align:center;">request_body_file</td> <td style="text-align:center;">本地文件资源的名称</td></tr> <tr><td style="text-align:center;">==request_method==</td> <td style="text-align:center;">客户端的请求方式，比如：GET、POST等</td></tr> <tr><td style="text-align:center;">request_filename</td> <td style="text-align:center;">当前请求资源文件的路径名</td></tr> <tr><td style="text-align:center;">==request_uri==</td> <td style="text-align:center;">当前请求的URI，即全部路径192.168.164.129:8081/server?a1=2&amp;a2=3</td></tr></tbody></table> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181754705.png" alt="image-20211218175430634"></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181754247.png" alt="image-20211218175439240"></p> <h3 id="if指令"><a href="#if指令" class="header-anchor">#</a> if指令</h3> <ol><li><p>变量名，值为空或者是0为false，其它为true</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>$args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">200</span> success<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>===和!===比较变量和字符串是否相等，满足条件为true，不满足为false，注意字符串不需要引号</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token preprocessor property">#<span class="token directive keyword">if</span>语句括号和if之间有空格</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$request_method <span class="token operator">=</span> POST<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token number">405</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <ul><li><p>使用cmd发送post请求：==curl -X POST 地址==</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112181910095.png" alt="image-20211212213135963"></p></li></ul> <ol><li><p>使用正则表达式对变量进行匹配，用&quot;~&quot;,&quot;~ * &quot;,&quot;!~&quot;,&quot;!~*&quot;</p> <ul><li><p>~：区分大小写</p></li> <li><p>~*：不区分大小写</p></li> <li><p>!~，!~*：取反</p> <div class="language- extra-class"><pre class="language-text"><code>    #加*不区分大小写
    if ($http_user_agent ~* safari){
    	return 200 Chrome;
    }
</code></pre></div></li></ul></li> <li><p>判断请求的==文件==是否存在：-f和!-f</p> <div class="language-js extra-class"><pre class="language-js"><code>    location <span class="token operator">/</span> <span class="token punctuation">{</span>
        root html<span class="token punctuation">;</span>
        default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
        #查找是否存在这个文件，找目录是<span class="token operator">-</span>d
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>f $request_filename<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt; file not found&lt;/h1&gt;'</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>判断==目录==是否存在：-d和!-d</p></li> <li><p>判断==目录或者文件==是否存在：-e和!-e</p></li> <li><p>判断文件是否可执行：-x和!-x</p></li></ol> <h3 id="break指令"><a href="#break指令" class="header-anchor">#</a> break指令</h3> <blockquote><p>中断指令，位于他前面的生效，后面不生效</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>        #测试<span class="token keyword">break</span>
        location <span class="token operator">/</span>testbreak <span class="token punctuation">{</span>
                root html<span class="token punctuation">;</span>
                <span class="token keyword">set</span> $username <span class="token string">'luo'</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>$username<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">set</span> $username <span class="token string">'zhangsan'</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">set</span> $username <span class="token string">'lisi'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                add_header username $username<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre></div><h3 id="return指令"><a href="#return指令" class="header-anchor">#</a> return指令</h3> <blockquote><p>完成对请求的处理，直接向客户端返回响应的状态代码</p></blockquote> <ul><li>code：状态码0-999</li> <li>text：内容</li> <li>URL：地址</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>        #测试<span class="token keyword">return</span>
        location <span class="token operator">/</span>testreturn <span class="token punctuation">{</span>
                root html<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">302</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h3 id="rewrite指令"><a href="#rewrite指令" class="header-anchor">#</a> rewrite指令</h3> <p>✔️URL和URI的区别：</p> <ul><li>URI：统一资源标识符identifier</li> <li>URL：统一资源定位符location</li></ul> <p>✔️语法：</p> <ul><li>rewrite regex replacement [flag]
<ul><li>regex：匹配URI的正则表达式</li> <li>replacement ：替换URI中的字符串，如果该字符串是==以http或https开头的，直接返回该字符串==，下面不管</li></ul></li></ul> <p>✔️flag：</p> <ol><li>last：和正常请求一样</li> <li>break：中断</li> <li>redirect：==重定向，地址发送变化，两次请求==</li> <li>permanent：永久重定向</li></ol> <p>✔️状态码：</p> <ul><li><p>301：永久重定向</p></li> <li><p>302：临时重定向</p> <p><img src="/learn-vuepress/assets/img/image-20211216214902553.d1c88135.png" alt="image-20211216214902553"></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>        #测试rewrite
        location <span class="token operator">/</span>rewrite <span class="token punctuation">{</span>
                #开启重写日志的记录
                rewrite_log on<span class="token punctuation">;</span>
                error_log logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log notice<span class="token punctuation">;</span>
                #地址重写，永久重写<span class="token number">301</span>，临时重写<span class="token number">302</span>
                rewrite <span class="token operator">^</span><span class="token operator">/</span>rewrite<span class="token operator">/</span>url\w<span class="token operator">*</span>$ https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
                rewrite <span class="token operator">^</span><span class="token operator">/</span>rewrite<span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ <span class="token operator">/</span>$1 permanent<span class="token punctuation">;</span>
                rewrite <span class="token operator">^</span><span class="token operator">/</span>rewrite<span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ <span class="token operator">/</span>$1 permanent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>test <span class="token punctuation">{</span>
                default_type text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'test success'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>demo <span class="token punctuation">{</span>
                default_type text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'demo success'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h3 id="rewrite-log指令"><a href="#rewrite-log指令" class="header-anchor">#</a> rewrite_log指令</h3> <blockquote><p>是否开启URL重写==日志的输出功能==，开启后，相关日志将以==notice==级别输出</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>    #开启重写日志的记录
    rewrite_log on<span class="token punctuation">;</span>
    error_log logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log notice<span class="token punctuation">;</span>
</code></pre></div><h2 id="rewrite的案例"><a href="#rewrite的案例" class="header-anchor">#</a> Rewrite的案例</h2> <h3 id="域名跳转和域名镜像"><a href="#域名跳转和域名镜像" class="header-anchor">#</a> 域名跳转和域名镜像</h3> <p>例www.jd.com，www.360buy.com两个都能访问京东网站</p> <ol><li><p>准备两个域名</p> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/hosts
127.0.0.1 www.luo.com
127.0.0.1 www.luomu.com
</code></pre></div></li> <li><p>配置如下：两个server，==监听端口号一样==</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>    server <span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name www<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
                default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt;welcome to luo&lt;/h1&gt;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    server <span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name www<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>cn www<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        #不携带<span class="token constant">URI</span>
        #rewrite <span class="token operator">^</span><span class="token operator">/</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">www.itcast.cn</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        #携带<span class="token constant">URI</span>
        #rewrite <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>cn<span class="token operator">/</span>$1<span class="token punctuation">;</span>
        #镜像，即只提供user模块跳转
        location <span class="token operator">/</span>user <span class="token punctuation">{</span>
                #域名跳转
                rewrite <span class="token operator">^</span><span class="token operator">/</span>user<span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>cn<span class="token operator">/</span>$1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>emp <span class="token punctuation">{</span>
                default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt;employee success&lt;/h1&gt;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="独立域名"><a href="#独立域名" class="header-anchor">#</a> 独立域名</h3> <p>✔️独立域名和镜像区分：==镜像是某个功能模块==，只允许某个功能访问，而==独立域名==是每个功能都有自己的地址，端口号也是80，和后面http://www.itcast.cn保持一致</p> <div class="language-js extra-class"><pre class="language-js"><code>    #独立域名
    server<span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name search<span class="token punctuation">.</span>luo<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        rewrite <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>cn<span class="token operator">/</span>search$1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="目录自动添加"><a href="#目录自动添加" class="header-anchor">#</a> 目录自动添加”/“</h3> <p>:happy:问题描述：</p> <p>直接访问：http://192.168.164成功，没有目录，和/无关</p> <div class="language-scala extra-class"><pre class="language-scala"><code>server <span class="token punctuation">{</span>
	listen	<span class="token number">80</span><span class="token punctuation">;</span>
	server_name localhost<span class="token punctuation">;</span>
	location <span class="token operator">/</span> <span class="token punctuation">{</span>
		root html<span class="token punctuation">;</span>
		index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改如下配置：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>server <span class="token punctuation">{</span>
	listen	<span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token class-name">server_name</span> localhost<span class="token punctuation">;</span>
	location <span class="token operator">/</span>luo <span class="token punctuation">{</span>
		<span class="token class-name">root</span> html<span class="token punctuation">;</span>
		index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问http://192.168.164/luo失败，因为没有加/，访问成localhost，不是192.168.164.129，==加/会做301==永久重定向，访问成功</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112182257216.png" alt="image-20211218215007222"></p> <p>✔️==server_name_in_redirect==：控制是否自动加/，nginx0.8.48之前版本默认没自动加，即on，之后版本改为off，自动加</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>    server <span class="token punctuation">{</span>
        listen 8083<span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token comment">#开启不自动末尾加/</span>
        server_name_in_redirect on<span class="token punctuation">;</span>
        location <span class="token operator">/</span>luo<span class="token punctuation">{</span>
                root html<span class="token punctuation">;</span>
                index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
                <span class="token comment">#配置让他自动加/</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span>d <span class="token variable">$request_filename</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">#每一个参数后面想使用，得加()，加([^/])是因为后面没有/才加，有就匹配失败</span>
                        rewrite ^<span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>^<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">)</span>$ http:<span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span>:<span class="token variable">$server_port</span><span class="token operator">/</span><span class="token variable">$1</span><span class="token variable">$2</span><span class="token operator">/</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="合并目录"><a href="#合并目录" class="header-anchor">#</a> 合并目录</h3> <p>✔️快速创建index.html</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202112182256017.png" alt="image-20211218215002294"></p> <p>访问http://192.168.164.129/server/11/22/33/44/20.html，太长，不利于SEO搜索引擎优化</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>    <span class="token comment">#合并目录</span>
    server <span class="token punctuation">{</span>
        listen 8085<span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        location <span class="token operator">/</span>server<span class="token punctuation">{</span>
                root html<span class="token punctuation">;</span>
                index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
                <span class="token comment">#\.html中的\.是转义.</span>
                rewrite ^<span class="token operator">/</span>server-<span class="token punctuation">(</span><span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">.</span>html$ <span class="token operator">/</span>server/<span class="token variable">$1</span><span class="token operator">/</span><span class="token variable">$2</span><span class="token operator">/</span><span class="token variable">$3</span><span class="token operator">/</span><span class="token variable">$4</span><span class="token operator">/</span><span class="token variable">$5</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>优化可以直接访问http://192.168.164.129/server/11-22-33-44-20.html</p> <h3 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h3> <blockquote><p>使用rewrite给个图片友好提示</p></blockquote> <p>✔️注意：==一般rewrite后面地址开头要加/==，除非是http://开头</p> <p><img src="/learn-vuepress/assets/img/image-20211218214957203.6c510aa4.png" alt="image-20211218214957203"></p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>        <span class="token comment">#防盗链问题</span>
        location <span class="token operator">/</span>images <span class="token punctuation">{</span>
                valid_referers none blocked www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">#return 403;</span>
                        <span class="token comment">#友好提示跳转</span>
                        rewrite ^<span class="token operator">/</span> <span class="token operator">/</span>images/daotu<span class="token punctuation">.</span>jpg <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                root html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h1 id="nginx反向代理"><a href="#nginx反向代理" class="header-anchor">#</a> nginx反向代理</h1> <h2 id="nginx反向代理概述"><a href="#nginx反向代理概述" class="header-anchor">#</a> nginx反向代理概述</h2> <blockquote><p>反向代理：服务端</p> <p>正向代理：客户端（保护客户）</p></blockquote> <p>✔️正向代理案例：</p> <ul><li><p>代理服务器设置：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>server <span class="token punctuation">{</span>
        listen  82<span class="token punctuation">;</span>
        resolver 8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8<span class="token punctuation">;</span>
        location <span class="token operator">/</span><span class="token punctuation">{</span>
                proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252141033.png" alt="image-20220125213023782"></p></li> <li><p>客户端配置代理服务器</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252139807.png" alt="image-20220125213944225"></p></li></ul> <h2 id="nginx反向代理的配置语法"><a href="#nginx反向代理的配置语法" class="header-anchor">#</a> nginx反向代理的配置语法</h2> <blockquote><p>ngx_http_proxy_module，安装nginx自动装好</p></blockquote> <h3 id="proxy-pass"><a href="#proxy-pass" class="header-anchor">#</a> proxy_pass</h3> <blockquote><p>设置代理服务器地址，位置location</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201252201039.png" alt="image-20220125212957953"></p> <h3 id="proxy-set-header"><a href="#proxy-set-header" class="header-anchor">#</a> proxy_set_header</h3> <blockquote><p>更改服务器接收到客户端请求的请求头信息，代理将客户的头信息修改后再给服务器</p></blockquote> <h3 id="proxy-redirect"><a href="#proxy-redirect" class="header-anchor">#</a> proxy_redirect</h3> <blockquote><p>重置头信息中的location和refresh</p></blockquote> <h2 id="nginx反向代理实战"><a href="#nginx反向代理实战" class="header-anchor">#</a> Nginx反向代理实战</h2> <ul><li>服务器存在两种情况
<ul><li>内容不一样
<ul><li>根据用户请求分发到不同服务器</li></ul></li> <li>内容一样
<ul><li>SSL</li></ul></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201260858890.png" alt="image-20220126085803214"></p> <div class="language-SAS extra-class"><pre class="language-sas"><code>代理服务器
server <span class="token punctuation">{</span>
        listen          <span class="token number">8082</span><span class="token punctuation">;</span>
        server_name     localhost<span class="token punctuation">;</span>
        location <span class="token operator">/</span>server1 <span class="token punctuation">{</span>
                proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">200.146</span>:<span class="token number">9001</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>server2 <span class="token punctuation">{</span>
                proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">200.146</span>:<span class="token number">9002</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span>server3 <span class="token punctuation">{</span>
                proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">200.146</span>:<span class="token number">9003</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

服务端
server1
server <span class="token punctuation">{</span>
        listen          <span class="token number">9001</span><span class="token punctuation">;</span>
        server_name     localhost<span class="token punctuation">;</span>
        default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;'</span>
<span class="token punctuation">}</span>
server2
server <span class="token punctuation">{</span>
        listen          <span class="token number">9002</span><span class="token punctuation">;</span>
        server_name     localhost<span class="token punctuation">;</span>
        default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;'</span>
<span class="token punctuation">}</span>
server3
server <span class="token punctuation">{</span>
        listen          <span class="token number">9003</span><span class="token punctuation">;</span>
        server_name     localhost<span class="token punctuation">;</span>
        default_type text<span class="token operator">/</span>html<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx的安全控制"><a href="#nginx的安全控制" class="header-anchor">#</a> Nginx的安全控制</h2> <blockquote><p>安全隔离：设置防火墙，仅留一个入口给代理服务器</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201260919113.png" alt="image-20220126091925076"></p> <h3 id="如何使用ssl对流量进行加密"><a href="#如何使用ssl对流量进行加密" class="header-anchor">#</a> 如何使用SSL对流量进行加密</h3> <blockquote><p>https：有SSL外壳的http</p></blockquote> <ul><li><p>原理：</p> <ul><li>经由HTTP进行通信</li> <li>利用SSL/TLS建立全通信
<ul><li>SSL：安全套接层</li> <li>TLS：传输层安全</li></ul></li></ul></li> <li><p>总结：</p> <blockquote><p>https：加密传输，相当于http+ssl，防止流量劫持</p></blockquote></li></ul> <h4 id="nginx添加ssl的支持"><a href="#nginx添加ssl的支持" class="header-anchor">#</a> nginx添加SSL的支持</h4> <blockquote><p>nginx使用条件：--with-http-ssl_module+OpenSSL</p></blockquote> <p>添加模块</p> <ol><li>将/sbin/nginx备份</li> <li>==nginx -V==：获取nginx的配置信息</li> <li>在nginx的安装源码目录下进行：==./configure 获取到的信息 --with-http_ssl_module==</li> <li>==make==：编译</li> <li>拷贝objs的nginx到/usr/local/nginx/sbin</li> <li>==make upgrade==：平滑升级，不停机</li></ol> <h4 id="nginx的ssl相关指令"><a href="#nginx的ssl相关指令" class="header-anchor">#</a> nginx的SSL相关指令</h4> <ol><li>listen ：443 ssl，默认占用443端口</li> <li>ssl_certificate：PEM格式的证书路径</li> <li>ssl_certificate_key：PEM secret key路径</li> <li>ssl_sesion_cache：SSL会话的缓存
<ul><li>off：禁用</li> <li>none：禁用</li> <li>builtin：仅在一个工作进程使用</li> <li>shared：所有工作进程共享缓存</li></ul></li> <li>ssl_session_timeout：缓存时间</li> <li>ssl_ciphers：密码格式要求</li> <li>ssl_prefer_server_ciphers：服务器密码是否优先客户端密码</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201261418247.png" alt="image-20220126141839863"></p> <h4 id="生成证书"><a href="#生成证书" class="header-anchor">#</a> 生成证书</h4> <p>✔️方法一：阿里云/腾讯云等第三方服务购买</p> <p>✔️方法二：openssl生成证书</p> <ol><li>查看是否安装openssl：==openssl version==</li> <li>mkdir /root/cert</li> <li>cd /root/cert</li> <li>openssl genrsa -des3 -out server.key 1024</li> <li>openssl req -new -key server.key -out server.csr</li> <li>cp server.key server.key.org</li> <li>openssl rsa -in server.key.org -out server.key</li> <li>openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201261736205.png" alt="image-20220126144043244"></p> <h4 id="开启ssl实例"><a href="#开启ssl实例" class="header-anchor">#</a> 开启SSL实例</h4> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">server</span> <span class="token punctuation">{</span>
    listen       443 ssl<span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    ssl_certificate      <span class="token operator">/</span>root<span class="token operator">/</span>cert<span class="token operator">/</span>server.crt<span class="token punctuation">;</span>
    ssl_certificate_key  <span class="token operator">/</span>root<span class="token operator">/</span>cert<span class="token operator">/</span>server.key<span class="token punctuation">;</span>

    ssl_session_cache    <span class="token property">shared</span><span class="token punctuation">:</span><span class="token property">SSL</span><span class="token punctuation">:</span>1m<span class="token punctuation">;</span>
    ssl_session_timeout  5m<span class="token punctuation">;</span>

    ssl_ciphers  <span class="token property">HIGH</span><span class="token punctuation">:</span>!<span class="token property">aNULL</span><span class="token punctuation">:</span>!MD5<span class="token punctuation">;</span>
    ssl_prefer_server_ciphers  on<span class="token punctuation">;</span>

    <span class="token selector">location /</span> <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="反向代理系统调优"><a href="#反向代理系统调优" class="header-anchor">#</a> 反向代理系统调优</h2> <blockquote><p>缓冲和缓存</p></blockquote> <ul><li>相同点：
<ul><li>IO吞吐效率，提升nginx代理的性能</li></ul></li> <li>不同点：
<ul><li>缓冲：解决不同设备之间==数据传递==速度导致性能问题</li> <li>缓存：备份，客户端获取相同数据，从代理服务器获取，效率高</li></ul></li></ul> <p>✔️相关指令：</p> <ul><li>proxy_buffering：开启或者关闭代理服务器的缓冲区</li> <li>proxy_buffers：==缓存区==的个数和大小</li> <li>proxy_buffer_size：保持和proxy_buffers中的size一致即可</li> <li>proxy_busy_buffers_size：处于BUSY状态的缓冲总大小</li> <li>proxy_temp_path：缓冲区满，临时存放在磁盘文件上</li> <li>proxy_temp_file_write_size：磁盘缓冲文件的大小</li></ul> <p>✔️通用网站的配置</p> <div class="language- extra-class"><pre class="language-text"><code>proxy_buffering on;
proxy_buffer_size 4 32k;
proxy_busy_buffers_size 64k;
proxy_temp_file_write_size 64k;
</code></pre></div><h1 id="nginx负载均衡"><a href="#nginx负载均衡" class="header-anchor">#</a> nginx负载均衡</h1> <h2 id="负载均衡概述"><a href="#负载均衡概述" class="header-anchor">#</a> 负载均衡概述</h2> <blockquote><p>将客户请求均衡发给服务器</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262154272.png" alt="image-20220126215401228"></p> <h2 id="负载均衡的原理及处理流程"><a href="#负载均衡的原理及处理流程" class="header-anchor">#</a> 负载均衡的原理及处理流程</h2> <blockquote><p>纵向扩展：硬件能力</p> <p>横向扩展：添加服务器</p></blockquote> <p>✔️两个角色：</p> <ul><li>应用集群：同一应用部署多台机器</li> <li>负载均衡器：通过算法，分发到集群中的一个服务器（机器）</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262158968.png" alt="image-20220126215821538"></p> <h3 id="负载均衡的作用"><a href="#负载均衡的作用" class="header-anchor">#</a> 负载均衡的作用</h3> <ol><li>高并发性</li> <li>高可用性，故障转移</li> <li>可扩展性，添加服务器</li> <li>安全性，负载均衡器上进行过滤</li></ol> <h2 id="负载均衡常用的处理方式"><a href="#负载均衡常用的处理方式" class="header-anchor">#</a> 负载均衡常用的处理方式</h2> <h3 id="方式一-用户手动选择"><a href="#方式一-用户手动选择" class="header-anchor">#</a> 方式一：用户手动选择</h3> <blockquote><p>网站提供不同线路、不同服务器链接方式，用户选择</p></blockquote> <p><img src="/learn-vuepress/assets/img/image-20220126220723859.a618ae66.png" alt="image-20220126220723859"></p> <h3 id="方式二-dns轮询方式"><a href="#方式二-dns轮询方式" class="header-anchor">#</a> 方式二：DNS轮询方式</h3> <blockquote><p>域名和IP</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201262214122.png" alt="image-20220126221408993"></p> <ul><li>清除本地的dns缓存：ipconfig/flushdns</li> <li>缺点：
<ul><li>可靠性低</li> <li>负载均衡不均衡（轮询）</li></ul></li></ul> <h3 id="方式三-四-七层负载均衡"><a href="#方式三-四-七层负载均衡" class="header-anchor">#</a> 方式三：四/七层负载均衡</h3> <blockquote><p>OSI（open system interconnection）：开放式系统互联模型，网络体系结构</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201272007397.png" alt="image-20220127200737911"></p> <ol><li>应用层：提供网络给应用</li> <li>表示层：数据格式化、编码、加密、压缩等</li> <li>会话层：会话连接</li> <li>传输层：端到端连接，例TCP/UDP</li> <li>网络层：IP寻址和路由选择</li> <li>数据链路层：控制网络层和物理层的通信</li> <li>物理层：比特流传输</li></ol> <p>✔️四层负载：OSI中的传输层，基于IP+PROT（port）的负载均衡</p> <ul><li>硬件：F5（十几w）、BIG-IP、Radware等</li> <li>软件：LVS、Nginx、Hayproxy等</li></ul> <p>✔️七层负载：OSI中的应用层，基于虚拟的URL或主机IP的负载均衡</p> <ul><li>软件：nignx、Hayproxy等</li></ul> <p>✔️区别：</p> <ul><li>数据：四层底层分（效率高），七层最顶端分发</li> <li>域名：七层识别域名，四层不识别</li></ul> <p>✔️实际使用：四层负载（LVS）+七层负载（Nginx）</p> <h2 id="nginx七层负载均衡"><a href="#nginx七层负载均衡" class="header-anchor">#</a> nginx七层负载均衡</h2> <blockquote><p>模块：proxy_pass</p></blockquote> <h3 id="nginx七层负载均衡的指令"><a href="#nginx七层负载均衡的指令" class="header-anchor">#</a> nginx七层负载均衡的指令</h3> <h4 id="upstream指令"><a href="#upstream指令" class="header-anchor">#</a> upstream指令</h4> <blockquote><p>定义一组服务器，监听不同服务器（TCP、Unix socket等）</p></blockquote> <h4 id="server指令"><a href="#server指令" class="header-anchor">#</a> server指令</h4> <blockquote><p>指定服务器的名称</p> <ul><li>域名、IP、端口或者unix socket</li></ul></blockquote> <h3 id="nginx七层负载均衡的实现流程"><a href="#nginx七层负载均衡的实现流程" class="header-anchor">#</a> nginx七层负载均衡的实现流程</h3> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280823433.png" alt="image-20220128082356409"></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>    upstream backend<span class="token punctuation">{</span>
        <span class="token comment">#登录后，访问的还是需要登录的服务器</span>
        <span class="token comment">#ip_hash;</span>
        <span class="token comment">#请求给连接次数较少的服务器</span>
        <span class="token comment">#least_conn;</span>
        <span class="token comment">#请求资源，有缓存的服务器</span>
        <span class="token comment">#hash $request_uri;</span>
        <span class="token comment">#fair：智能化把请求给需要的服务器</span>
        fair;
        server 192.168.164.129<span class="token punctuation">:</span>9001;
        server 192.168.164.129<span class="token punctuation">:</span>9002;
        server 192.168.164.129<span class="token punctuation">:</span>9003;
    <span class="token punctuation">}</span>

    server<span class="token punctuation">{</span>
        listen 8083;
        server_name localhost;
        location /<span class="token punctuation">{</span>
        	proxy_pass http<span class="token punctuation">:</span>//backend;
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="负载均衡状态"><a href="#负载均衡状态" class="header-anchor">#</a> 负载均衡状态</h3> <table><thead><tr><th>状态</th> <th>概述</th></tr></thead> <tbody><tr><td>down</td> <td>不参与</td></tr> <tr><td>backup</td> <td>备份</td></tr> <tr><td>max_fails</td> <td>请求失败的次数</td></tr> <tr><td>fail_timeouts</td> <td>最大失败次数后，服务暂停时间</td></tr> <tr><td>max_conns</td> <td>最大连接数</td></tr></tbody></table> <h4 id="down"><a href="#down" class="header-anchor">#</a> down</h4> <blockquote><p>服务器不可用，停机维护</p></blockquote> <h4 id="backup"><a href="#backup" class="header-anchor">#</a> backup</h4> <blockquote><p>主服务器不可用</p></blockquote> <h4 id="max-conns"><a href="#max-conns" class="header-anchor">#</a> max_conns</h4> <blockquote><p>最大请求数，防止服务器压跨</p></blockquote> <h4 id="max-fails和fail-timeout"><a href="#max-fails和fail-timeout" class="header-anchor">#</a> max_fails和fail_timeout</h4> <blockquote><p>请求失败次数，次数后服务暂停时间</p></blockquote> <h3 id="负载均衡策略"><a href="#负载均衡策略" class="header-anchor">#</a> 负载均衡策略</h3> <table><thead><tr><th style="text-align:left;">算法</th> <th>说明</th></tr></thead> <tbody><tr><td style="text-align:left;">轮询</td> <td>默认</td></tr> <tr><td style="text-align:left;">weight</td> <td>权重</td></tr> <tr><td style="text-align:left;">ip_hash</td> <td>ip</td></tr> <tr><td style="text-align:left;">least_conn</td> <td>最少连接</td></tr> <tr><td style="text-align:left;">url_hash</td> <td>URL</td></tr> <tr><td style="text-align:left;">fair</td> <td>响应时间</td></tr></tbody></table> <h4 id="轮询"><a href="#轮询" class="header-anchor">#</a> 轮询</h4> <blockquote><p>平均分配请求，概率一样</p></blockquote> <h4 id="weight【加权轮询】"><a href="#weight【加权轮询】" class="header-anchor">#</a> weight【加权轮询】</h4> <blockquote><p>有比例分配请求，概率不一样</p></blockquote> <h4 id="ip-hash"><a href="#ip-hash" class="header-anchor">#</a> ip_hash</h4> <blockquote><p>用户登录，保证下次登录还是在同一个服务器，因为登录信息在该服务器</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280837147.png" alt="image-20220126205513751"></p> <h4 id="least-conn"><a href="#least-conn" class="header-anchor">#</a> least_conn</h4> <blockquote><p>把请求给连接少的</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280839751.png" alt="image-20220128083902712"></p> <h4 id="url-hash"><a href="#url-hash" class="header-anchor">#</a> url_hash</h4> <blockquote><p>请求资源，资源缓存在服务器，下次请求相同资源，保证去同一个服务器，因为服务器有资源的缓存</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201280839544.png" alt="image-20220128083945142"></p> <h4 id="fair"><a href="#fair" class="header-anchor">#</a> fair</h4> <blockquote><p>根据页码大小、加载时间长短</p> <p>添加nginx-upstream-fair模块</p></blockquote> <ol><li><p>下载地址：https://github.com/gnosek/nginx-upstream-fair</p></li> <li><p>unzip nginx-upstream-fair-master.zip</p></li> <li><p>./configure --add-module=/root/fair</p></li> <li><p>make</p> <ul><li><p>报错：因为ngx_http_upstream_srv_conf缺少default_port</p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281130763.png" alt="image-20220128113037964"></p></li> <li><p>解决方案：</p> <ul><li>nginx源码src目录下：vim src/htttp/ngx_http_upstream.h</li> <li>找：ngx_http_upstream_srv_conf_s
<img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281133352.png" alt="image-20220128113321820"></li></ul></li></ul></li> <li><p>make upgrade</p></li></ol> <h3 id="负载均衡案例"><a href="#负载均衡案例" class="header-anchor">#</a> 负载均衡案例</h3> <h4 id="实现带有url重写的负载均衡"><a href="#实现带有url重写的负载均衡" class="header-anchor">#</a> 实现带有URL重写的负载均衡</h4> <div class="language-scss extra-class"><pre class="language-scss"><code>    <span class="token selector">#具有rewrite的负载均衡
    server</span><span class="token punctuation">{</span>
        listen 8084<span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token selector">location /file/</span><span class="token punctuation">{</span>
            #重写到/server地址
            rewrite ^<span class="token punctuation">(</span>/file/.*<span class="token punctuation">)</span> /server/<span class="token variable">$1</span> last<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">#/server地址
        location /server/</span><span class="token punctuation">{</span>
            proxy_pass <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//backend;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx四层负载均衡"><a href="#nginx四层负载均衡" class="header-anchor">#</a> nginx四层负载均衡</h2> <blockquote><p>四层负载均衡：stream=&gt;upstream=&gt;server</p> <p>upstream添加多个后端服务</p></blockquote> <h3 id="添加stream模块的支持"><a href="#添加stream模块的支持" class="header-anchor">#</a> 添加stream模块的支持</h3> <blockquote><p>添加模块stream：./configure 之前的配置 --with-stream</p></blockquote> <h3 id="nginx四层负载均衡的指令"><a href="#nginx四层负载均衡的指令" class="header-anchor">#</a> nginx四层负载均衡的指令</h3> <h4 id="stream指令"><a href="#stream指令" class="header-anchor">#</a> stream指令</h4> <blockquote><p>和http指令同级</p></blockquote> <h4 id="upstream指令-2"><a href="#upstream指令-2" class="header-anchor">#</a> upstream指令</h4> <blockquote><p>和http里的upstream类似</p></blockquote> <h3 id="四层负载均衡的案例"><a href="#四层负载均衡的案例" class="header-anchor">#</a> 四层负载均衡的案例</h3> <h4 id="需求分析"><a href="#需求分析" class="header-anchor">#</a> 需求分析</h4> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281140392.png" alt="image-20220128114039062"></p> <p>实现步骤</p> <p>✔️Redis服务器</p> <ol><li><p>准备redis服务器，端口6379（默认），6378</p></li> <li><p>tar -zxf redis-4.0.14.tar.gz</p></li> <li><p>make PREFIX=/usr/local/redis/redis01 install</p> <ul><li>编译和安装</li></ul></li> <li><p>cp redis.conf /usr/local/redis/redis01/bin</p></li> <li><p>修改redis.conf配置文件</p> <ul><li><p>/搜索，n下一个</p></li> <li><p>port 6379</p></li> <li><p>daemonize yes</p></li></ul></li> <li><p>复制redis01为redis02</p> <ul><li>cd  /usr/local/redis</li> <li>==cp -r redis01 redis02==</li></ul></li> <li><p>启动：</p> <ul><li>切换到bin：cd bin</li> <li>./redis-server ../redis.conf</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281147898.png" alt="image-20220128111647702"></p></li></ol> <p>✔️tomcat服务器</p> <ol><li>tar -zxf apache-tomcat-8.5.56.tar.gz</li> <li>cd apache-tomcat-8.5.56/bin</li> <li>./startup</li></ol> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">#四层负载均衡：stream===&gt;upstream===&gt;server
stream</span><span class="token punctuation">{</span>
    <span class="token selector">upstream redisbackend</span><span class="token punctuation">{</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>6379<span class="token punctuation">;</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>6378<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">upstream tomcatbackend</span><span class="token punctuation">{</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8080<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">#redis四层负载均衡
    server</span><span class="token punctuation">{</span>
        listen 81<span class="token punctuation">;</span>
        proxy_pass redisbackend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">#tomcat的四层负载均衡
    server</span><span class="token punctuation">{</span>
        listen 82<span class="token punctuation">;</span>
        proxy_pass tomcatbackend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="nginx缓存集成"><a href="#nginx缓存集成" class="header-anchor">#</a> nginx缓存集成</h1> <h2 id="缓存的概念"><a href="#缓存的概念" class="header-anchor">#</a> 缓存的概念</h2> <blockquote><p>把没有的数据缓存，下次访问速度提高</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281649326.png" alt="image-20220128164941392"></p> <table><thead><tr><th style="text-align:left;">场景</th> <th>作用</th></tr></thead> <tbody><tr><td style="text-align:left;">磁盘缓存</td> <td>减少磁盘操作</td></tr> <tr><td style="text-align:left;">数据库缓存</td> <td>减少文件系统IO操作</td></tr> <tr><td style="text-align:left;">应用程序缓存</td> <td>减少对数据库查询</td></tr> <tr><td style="text-align:left;">web服务器缓存</td> <td>减少请求次数</td></tr> <tr><td style="text-align:left;">浏览器缓存</td> <td>减少后台交互次数</td></tr></tbody></table> <p>✔️优点：</p> <ul><li>减少数据传输，加快响应，提升体验</li> <li>减轻服务器压力</li></ul> <p>✔️缺点：</p> <ul><li>数据不同步</li> <li>增加成本</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281656975.png" alt="image-20220128165634184"></p> <p>nginx作为web缓存服务器，提高访问的响应速度</p> <h2 id="nginx的web缓存服务"><a href="#nginx的web缓存服务" class="header-anchor">#</a> nginx的web缓存服务</h2> <blockquote><p>原理：把‘URL及相关组合为key，MD5加key得到目录路径，把缓存内存保存在目录</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281658842.png" alt="image-20220128165841163"></p> <h2 id="nginx缓存设置的相关指令"><a href="#nginx缓存设置的相关指令" class="header-anchor">#</a> nginx缓存设置的相关指令</h2> <blockquote><p>模块：ngx_http_proxy_module</p></blockquote> <h3 id="proxy-cache-path"><a href="#proxy-cache-path" class="header-anchor">#</a> proxy_cache_path</h3> <blockquote><p>设置存放缓存的地址</p></blockquote> <p>✔️参数</p> <ul><li>path：缓存地址</li> <li>levels：目录层级</li> <li>keys_zone：目录名称和大小</li> <li>inactive：多久缓存没有被访问将删除</li> <li>max_size：最大缓存空间</li></ul> <h3 id="proxy-cache"><a href="#proxy-cache" class="header-anchor">#</a> proxy_cache</h3> <blockquote><p>开启或关闭缓存</p></blockquote> <h3 id="proxy-cache-key"><a href="#proxy-cache-key" class="header-anchor">#</a> proxy_cache_key</h3> <blockquote><p>设置web缓存的key值</p></blockquote> <h3 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="header-anchor">#</a> proxy_cache_valid</h3> <blockquote><p>设置状态码的缓存时间</p></blockquote> <h3 id="proxy-cache-min-uses"><a href="#proxy-cache-min-uses" class="header-anchor">#</a> proxy_cache_min_uses</h3> <blockquote><p>设置资源被访问多少次后开始缓存</p></blockquote> <h3 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="header-anchor">#</a> proxy_cache_methods</h3> <blockquote><p>设置缓存哪些HTTP方法</p></blockquote> <h2 id="nginx缓存设置案例"><a href="#nginx缓存设置案例" class="header-anchor">#</a> nginx缓存设置案例</h2> <h3 id="需求分析-2"><a href="#需求分析-2" class="header-anchor">#</a> 需求分析</h3> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201281952888.png" alt=" "></p> <h3 id="步骤实现"><a href="#步骤实现" class="header-anchor">#</a> 步骤实现</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code>        #缓存路径，目录，名称
        proxy_cache_path <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>proxy_cache levels<span class="token operator">=</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">1</span> keys_zone<span class="token operator">=</span>luo<span class="token operator">:</span>200m inactive<span class="token operator">=</span>1d max_size<span class="token operator">=</span>20g<span class="token punctuation">;</span>
        upstream backend<span class="token punctuation">{</span>
                server <span class="token number">192.168</span><span class="token number">.164</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        server <span class="token punctuation">{</span>
                listen <span class="token number">8081</span><span class="token punctuation">;</span>
                server_name localhost<span class="token punctuation">;</span>
                location <span class="token operator">/</span><span class="token punctuation">{</span>
                        proxy_cache luo<span class="token punctuation">;</span>
                        #缓存的MD5key
                        proxy_cache_key luomu<span class="token punctuation">;</span>
                        #<span class="token number">200</span>状态码缓存时间
                        proxy_cache_valid <span class="token number">200</span> 5d<span class="token punctuation">;</span>
                        #<span class="token number">404</span>缓存时间
                        proxy_cache_valid <span class="token number">404</span> 30s<span class="token punctuation">;</span>
                        #其它状态码缓存时间
                        proxy_cache_valid <span class="token builtin">any</span> 1m<span class="token punctuation">;</span>
                        #最小开始缓存次数
                        proxy_cache_min_uses <span class="token number">5</span><span class="token punctuation">;</span>
                        #查看缓存信息
                        add_header nginx<span class="token operator">-</span>cache <span class="token string">&quot;$upstream_cache_status&quot;</span><span class="token punctuation">;</span>
                        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token operator">/</span>js<span class="token operator">/</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201290928605.png" alt="image-20220128135201983"></p> <h2 id="nginx缓存清除"><a href="#nginx缓存清除" class="header-anchor">#</a> nginx缓存清除</h2> <h3 id="方式一-删除缓存目录"><a href="#方式一-删除缓存目录" class="header-anchor">#</a> 方式一：删除缓存目录</h3> <blockquote><p>rm -rf /usr/local/proxy_cache</p></blockquote> <h3 id="方式二-第三方扩展模块"><a href="#方式二-第三方扩展模块" class="header-anchor">#</a> 方式二：第三方扩展模块</h3> <h4 id="ngx-cache-purge"><a href="#ngx-cache-purge" class="header-anchor">#</a> ngx_cache_purge</h4> <ol><li>tar -zxf ngx_cache_purge-2.3.tar.gz</li> <li>./configure --add-module=/root/nginx/module/purge</li> <li>make</li> <li>make upgrade</li></ol> <div class="language-scss extra-class"><pre class="language-scss"><code>    location ~ /<span class="token function">purge</span><span class="token punctuation">(</span>/.*<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        #清除缓存
        proxy_cache_purge luo luomu<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx设置资源不缓存"><a href="#nginx设置资源不缓存" class="header-anchor">#</a> nginx设置资源不缓存</h2> <p>✔️proxy_no_cache</p> <blockquote><p>不将数据缓存的条件（没缓存过）</p> <p>配置实例：proxy_no_cache $cookie_mocache $arg_nocache $arg_comment</p></blockquote> <p>✔️proxy_cache_bypass</p> <blockquote><p>设置不从缓存中获取数据的条件（已经缓存过）</p> <p>配置实例：proxy_cache_bypass $cookie_nocache $arg_nocache $arg_comment</p></blockquote> <p>注意：条件有一个不为0就生效</p> <h3 id="cookie-nocache、-arg-nocache、-arg-comment"><a href="#cookie-nocache、-arg-nocache、-arg-comment" class="header-anchor">#</a> $cookie_nocache、$arg_nocache、$arg_comment</h3> <ul><li>cookie_nocache：==键==nocache对应的值</li> <li>arg_nocache和arg_comment：==参数==的名为nocache和comment对应的值</li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code>    #演示设置不缓存
    log_format params <span class="token variable">$cookie_nocache</span> | <span class="token variable">$arg_nocache</span> | <span class="token variable">$arg_comment</span><span class="token punctuation">;</span>
    <span class="token selector">server</span><span class="token punctuation">{</span>
        listen  8083<span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token selector">location /</span><span class="token punctuation">{</span>
            access_log logs/access_params.log params<span class="token punctuation">;</span>
            #add_header Set-Cookie <span class="token string">'nocache=999'</span><span class="token punctuation">;</span>
            root html<span class="token punctuation">;</span>
            index index.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h3> <blockquote><p>常见的设置资源不缓存方案</p></blockquote> <div class="language-scss extra-class"><pre class="language-scss"><code>    <span class="token selector">#设置不缓存两种方法结合（流行）
    server</span><span class="token punctuation">{</span>
        listen 8084<span class="token punctuation">;</span>
        server_name localhost<span class="token punctuation">;</span>
        <span class="token selector">location /</span><span class="token punctuation">{</span>
            if <span class="token punctuation">(</span><span class="token variable">$request_uri</span> ~ /.*.\js$<span class="token punctuation">)</span><span class="token punctuation">{</span>
                set <span class="token variable">$nocache</span> 1<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            proxy_cache_bypass <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span> <span class="token variable">$arg_comment</span> <span class="token variable">$nocache</span><span class="token punctuation">;</span>
            proxy_no_cache <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span> <span class="token variable">$arg_comment</span> <span class="token variable">$nocache</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h1 id="nginx实现服务器端集群搭建"><a href="#nginx实现服务器端集群搭建" class="header-anchor">#</a> nginx实现服务器端集群搭建</h1> <h2 id="nginx与tomcat部署"><a href="#nginx与tomcat部署" class="header-anchor">#</a> nginx与tomcat部署</h2> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201300839130.png" alt="image-20220130083948128"></p> <h3 id="环境准备tomcat"><a href="#环境准备tomcat" class="header-anchor">#</a> 环境准备tomcat</h3> <ol><li>安装tomcat</li> <li>将项目打war放到webapps下</li></ol> <h3 id="环境准备nginx"><a href="#环境准备nginx" class="header-anchor">#</a> 环境准备nginx</h3> <blockquote><p>反向代理将请求发送给tomcat</p></blockquote> <div class="language-scss extra-class"><pre class="language-scss"><code>    <span class="token selector">#tomcat的集群
    upstream myWeb</span><span class="token punctuation">{</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8080 weight=10<span class="token punctuation">;</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8180 weight=10<span class="token punctuation">;</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8280 weight=10<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">server </span><span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        <span class="token selector">location / </span><span class="token punctuation">{</span>
            root   html/web<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">#动态资源
        location /demo</span><span class="token punctuation">{</span>
                proxy_pass <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//myWeb;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx实现动静分离"><a href="#nginx实现动静分离" class="header-anchor">#</a> nginx实现动静分离</h2> <blockquote><p>动静分离：静态资源相关的内容交给nginx</p></blockquote> <p>✔️为什么需要动静分离：</p> <ul><li>nginx处理静态资源效率高</li> <li>减轻tomcat服务器压力</li> <li>提高静态资源的访问速度</li> <li>动态资源宕机不影响静态资源</li></ul> <p>动：部署tomcat、weblogic或者websphere</p> <p>静：部署到CDN、nginx等</p> <h3 id="需求分析-3"><a href="#需求分析-3" class="header-anchor">#</a> 需求分析</h3> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301524216.png" alt="image-20220130152448591"></p> <h3 id="动静分离实现步骤"><a href="#动静分离实现步骤" class="header-anchor">#</a> 动静分离实现步骤</h3> <ul><li>首页</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.164.129/demo/getAddress'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Nginx如何将请求转发到后端服务器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/mv.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>nginx的配置</li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code>    <span class="token selector">#tomcat的集群
    upstream myWeb</span><span class="token punctuation">{</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8080 weight=10<span class="token punctuation">;</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8180 weight=10<span class="token punctuation">;</span>
        server 192.168.164.<span class="token property">129</span><span class="token punctuation">:</span>8280 weight=10<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">server </span><span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        <span class="token selector">location / </span><span class="token punctuation">{</span>
            root   html/web<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">#动态资源
        location /demo</span><span class="token punctuation">{</span>
                proxy_pass <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//myWeb;</span>
        <span class="token punctuation">}</span>
        #静态资源
        location ~/.*\.<span class="token punctuation">(</span>js|png|jpg|gif<span class="token punctuation">)</span><span class="token punctuation">{</span>
                root html/web<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301535657.png" alt="image-20220129180704547"></p> <h2 id="nginx实现tomcat集群搭建"><a href="#nginx实现tomcat集群搭建" class="header-anchor">#</a> nginx实现tomcat集群搭建</h2> <blockquote><p>如果tomcat宕机了，部署多台tomcat，提高可用性</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301535294.png" alt="image-20220130153538496"></p> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301536887.png" alt="image-20220129180701896"></p> <h2 id="nginx高可用解决方案"><a href="#nginx高可用解决方案" class="header-anchor">#</a> nginx高可用解决方案</h2> <blockquote><p>nginx宕机？两个nginx，用户访问哪个？</p></blockquote> <h3 id="keepalived"><a href="#keepalived" class="header-anchor">#</a> keepalived</h3> <blockquote><p>通告VRRP协议实现高可用功能</p></blockquote> <h3 id="vrrp介绍"><a href="#vrrp介绍" class="header-anchor">#</a> VRRP介绍</h3> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301539003.png" alt="image-20220130153950716"></p> <p>✔️VRRP（virtual route redundancy protocol），虚拟路由冗余协议</p> <blockquote><p>将两台或多台路由器虚拟成一个设备，对外提高虚拟路由器IP，master（MASTER)对接IP</p></blockquote> <p>作用：</p> <ol><li>选择协议
<ul><li>路由之间竞选master，剩下的就是backup</li></ul></li> <li>路由容错协议
<ul><li>master路由宕机后，由backup替代成为新的master</li></ul></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/luomu888/cloudimg@master/img/202201301551336.png" alt="image-20220130155141302"></p> <h3 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h3> <ol><li>官网下载版本：https://keepalived.org/</li> <li>安装keepalived</li> <li>cd keepalived/keepalived-2.0.20</li> <li>./configure --sysconf=/etc --prefix=/usr/local</li> <li>make &amp;&amp; make install</li></ol> <blockquote><p>安装后：</p> <ul><li>系统配置文件：/etc/keepalived/keepalived.conf</li> <li>启动和关闭keepalived：/usr/local/sbin</li></ul></blockquote> <h3 id="keepalived配置文件介绍"><a href="#keepalived配置文件介绍" class="header-anchor">#</a> keepalived配置文件介绍</h3> <p>✔️keepalived.conf配置文件</p> <ul><li>global全局配置</li> <li>vrrp相关配置</li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">! Configuration File for keepalived
#全局模块
global_defs </span><span class="token punctuation">{</span>
   <span class="token selector">#切换通知目的地邮箱
   notification_email </span><span class="token punctuation">{</span>
        tom<span class="token atrule"><span class="token rule">@qq</span>.com
        jack<span class="token rule">@qq</span>.com
   <span class="token punctuation">}</span>
   #发件人邮箱
   notification_email_from wangwu<span class="token rule">@qq</span>.com
   #邮箱服务地址
   smtp_server 192.168.200.1
   #服务连接超时时间
   smtp_connect_timeout 30
   #标识
   router_id LVS_DEVEL
   #检查地址
   vrrp_skip_check_adv_addr
   #遵守vrrp协议
   vrrp_strict
   #延迟
   vrrp_garp_interval 0
   #网卡延迟
   vrrp_gna_interval 0
<span class="token punctuation">}</span>

<span class="token selector">#控制keepalived什么时候关闭的脚本vrrp_script
vrrp_script ck_nginx</span><span class="token punctuation">{</span>
        #脚本位置
        script <span class="token string">'usr/local/sbin/ck_nginx.sh'</span>
        #执行时间间隔
        interval 3
        #权重，即优先级
        weight -20
<span class="token punctuation">}</span>

#实例，VI_1实例名称
vrrp_instance VI_1</span> <span class="token punctuation">{</span>
    <span class="token selector">#MASTER或BACKUP master主 backup备
    state BACKUP
    #网卡名称
    interface ens33
    #实例ID，范围0~255
    virtual_router_id 51
    #优先级
    priority 100
    #发送vrrp通告间隔时间
    advert_int 1
    #通信认证模块
    authentication </span><span class="token punctuation">{</span>
        #密码认证
        auth_type PASS
        #具体密码
        auth_pass 1111
    <span class="token punctuation">}</span>
    <span class="token selector">#虚拟IP地址
    virtual_ipaddress </span><span class="token punctuation">{</span>
        192.168.164.129
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="访问测试"><a href="#访问测试" class="header-anchor">#</a> 访问测试</h3> <blockquote><p>ip a：查看IP</p></blockquote> <p>存在的问题：</p> <ul><li>想让master切换，需把对应的服务器上的keepalived关闭（手动）</li></ul> <h3 id="keepalived之vrrp-script"><a href="#keepalived之vrrp-script" class="header-anchor">#</a> keepalived之vrrp_script</h3> <blockquote><p>解决需手动关闭keepalived</p></blockquote> <p>✔️实现步骤</p> <ul><li>配置文件中添加对应的配置像</li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">#控制keepalived什么时候关闭的脚本vrrp_script
vrrp_script ck_nginx</span><span class="token punctuation">{</span>
        #脚本位置
        script <span class="token string">'usr/local/sbin/ck_nginx.sh'</span>
        #执行时间间隔
        interval 3
        #权重，即优先级
        weight -20
<span class="token punctuation">}</span>
</code></pre></div><ul><li>脚本
<ul><li>-C：指定命令的所有进程</li> <li>--no-header：排除标题</li></ul></li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code>#!/bin/bash
nginx开启的个数
num=`ps -C nginx --no-header | wc -l`
if [ <span class="token variable">$num</span> -eq 0 ]<span class="token punctuation">;</span>then
 /usr/local/nginx/sbin/nginx
 sleep 2
 if [ `ps -C nginx --no-header | wc -l` -eq 0 ]<span class="token punctuation">;</span> then
	如果nginx为0，关闭keepalived
  killall keepalived
 fi
fi
</code></pre></div><ul><li>注意：设置master和backup状态时，都设为backup，可通过优先级（priority）竞争</li></ul> <h2 id="nginx制作下载站点"><a href="#nginx制作下载站点" class="header-anchor">#</a> nginx制作下载站点</h2> <blockquote><p>模块：ngx_http_autoindex_module</p></blockquote> <p>例：</p> <p><img src="/learn-vuepress/assets/img/image-20220130161744226.5e54fd26.png" alt="image-20220130161744226"></p> <div class="language-scss extra-class"><pre class="language-scss"><code>    <span class="token selector">location /download</span><span class="token punctuation">{</span>
        root /usr/local<span class="token punctuation">;</span>
        #开启资源列表
        autoindex on<span class="token punctuation">;</span>
        #资源大小详细信息
        autoindex_exact_size off<span class="token punctuation">;</span>
        #资源展示的格式
        autoindex_format html<span class="token punctuation">;</span>
        #目录的资源展示时间
        autoindex_localtime off<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx的用户认证模块"><a href="#nginx的用户认证模块" class="header-anchor">#</a> nginx的用户认证模块</h2> <blockquote><p>设置资源允许谁访问</p></blockquote> <p>✌️auth_basic string|off：开启后，提示用户需要用户名和密码验证</p> <p>✌️auth_basic_user_file：用户名和密码路径，可以使用工具<code>htpasswd</code>生产</p> <ul><li>yum install -y httpd-tools</li></ul> <div class="language- extra-class"><pre class="language-text"><code>htpasswd -c /usr/local/nginx/conf/htpasswd username //创建一个新文件记录用户名和密码
htpasswd -b /usr/local/nginx/conf/htpasswd username password //在指定文件新增一个用户名和密码
htpasswd -D /usr/local/nginx/conf/htpasswd username //从指定文件删除一个用户信息
htpasswd -v /usr/local/nginx/conf/htpasswd username //验证用户名和密码是否正确
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>location /download{
    root /usr/local;
    autoindex on;
    autoindex_exact_size on;
    autoindex_format html;
    autoindex_localtime on;
    auth_basic 'please input your auth';
    auth_basic_user_file htpasswd;
}
</code></pre></div><h1 id="nginx的扩展模块"><a href="#nginx的扩展模块" class="header-anchor">#</a> nginx的扩展模块</h1> <h2 id="lua"><a href="#lua" class="header-anchor">#</a> Lua</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <blockquote><p>脚本语言，灵活扩展和定制功能</p></blockquote> <h3 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h3> <ol><li>轻量级：方便嵌入</li> <li>可扩展</li> <li>支持面向过程和函数式编程</li></ol> <h3 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h3> <blockquote><p>游戏开发、web脚本、独立应用脚本等</p></blockquote> <h3 id="lua的安装"><a href="#lua的安装" class="header-anchor">#</a> Lua的安装</h3> <ul><li>官网：https://www.lua.org</li></ul> <ol><li>wget https://www.lua.org/ftp/lua-5.4.1.tar.gz</li> <li>cd lua-5.4.1</li> <li>make linux test</li> <li>make install</li></ol> <h3 id="第一个lua程序"><a href="#第一个lua程序" class="header-anchor">#</a> 第一个Lua程序</h3> <ol><li>lua</li> <li>print('hello world')</li></ol> <h3 id="注释"><a href="#注释" class="header-anchor">#</a> 注释</h3> <ul><li>单行注释：--</li> <li>多行注释：--[[        注释内容      --]]</li></ul> <h3 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h3> <p>✌️运算符：</p> <ol><li>^：幂</li> <li>~=：不等</li> <li>..：连接两个字符串
<ul><li>例：&quot;hello&quot;..&quot;world&quot;===&gt;helloworld</li></ul></li> <li>井号：返回字符串或表的长度</li></ol> <p>✌️变量</p> <ol><li>默认变量为全局，局部定义前面加local</li></ol> <p>✌️数据类型</p> <ol><li>nil：空</li> <li>number：数值</li> <li>table：表
<ul><li>例：arr={&quot;java&quot;,&quot;lisi&quot;,&quot;wangwu&quot;}</li></ul></li> <li>userdata：用户数据</li></ol> <p>》例：print(type(12))===&gt;number</p> <p>✌️控制结构</p> <ol><li>if elseif else
<ul><li>例：if (5&gt;3) then elseif (4&gt;3) then else  end</li> <li>注意：else后面没有then，其他都有</li></ul></li> <li>whille 条件 do 循环 end</li> <li>for k,v in ipairs(x) do end
<ul><li>x：表（Java中的数据）</li></ul></li></ol> <h2 id="ngx-lua模块"><a href="#ngx-lua模块" class="header-anchor">#</a> ngx_lua模块</h2> <h3 id="openresty"><a href="#openresty" class="header-anchor">#</a> OpenResty</h3> <blockquote><p>基于nginx与Lua（集成两者）的高性能web平台</p></blockquote> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <ol><li>wget https://openresty.org/download/openresty-1.15.8.2.tar.gz</li> <li>tar -zxf openresty-1.15.8.2.tar.gz</li> <li>cd openresty-1.15.8.2</li> <li>./configure</li> <li>make &amp;&amp; make install</li> <li>cd /usr/local/openresty/nginx/</li></ol> <h2 id="ngx-lua的使用"><a href="#ngx-lua的使用" class="header-anchor">#</a> ngx_lua的使用</h2> <p>✔️指令执行顺序</p> <p><img src="/learn-vuepress/assets/img/image-20220204221208361.1f027455.png" alt="image-20220204221208361"></p> <div class="language- extra-class"><pre class="language-text"><code>*（xxx_by_lua）：表示指令
*（xxx_by_lua_block）：表示文件
</code></pre></div><ol><li>==init_by_lua==*：初始化的全局配置</li> <li>init_worker_by_lua*：定时任务</li> <li>==set_by_lua*==：给变量赋值</li> <li>rewrite_by_lua*：重写</li> <li>access_by_lua*：访问控制</li> <li>==content_by_lua*==（常用）：这个阶段大部分任务完成，其他阶段是准备</li> <li>header_fiter_by_lua*：设置头部信息</li> <li>body_filter_by_lua&amp;：对响应数据过滤</li></ol> <h3 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h3> <div class="language- extra-class"><pre class="language-text"><code>http://192.168.111.130?name=zhangsan&amp;gender=1
gender：1输出名字加先生，0输出女士
</code></pre></div><p>✌️代码</p> <div class="language-scss extra-class"><pre class="language-scss"><code>	<span class="token selector">#地址参数，gender（1是先生，0是女士），name
	location /getGender</span><span class="token punctuation">{</span>
		default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>
		set_by_lua <span class="token variable">$name</span> &quot;
			local msg=ngx.req.get_uri_<span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			gender = msg[<span class="token string">'gender'</span>]
			name = msg[<span class="token string">'name'</span>]
			<span class="token function">if</span><span class="token punctuation">(</span>gender==<span class="token string">'1'</span><span class="token punctuation">)</span> then
				return name..<span class="token string">'先生'</span>
			<span class="token function">elseif</span><span class="token punctuation">(</span>gender==<span class="token string">'0'</span><span class="token punctuation">)</span> then
				return name..<span class="token string">'女士'</span>
			else
				return name
			end
		&quot;<span class="token punctuation">;</span>
		return 200 <span class="token variable">$name</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><img src="/learn-vuepress/assets/img/image-20220204123425989.efcd60a4.png" alt="image-20220204123425989"></p> <h2 id="ngx-lua操作redis"><a href="#ngx-lua操作redis" class="header-anchor">#</a> ngx_lua操作redis</h2> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">location / </span><span class="token punctuation">{</span>
    default_type <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">;</span>
    <span class="token selector">content_by_lua_block</span><span class="token punctuation">{</span>
        local redis = require <span class="token string">&quot;resty.redis&quot;</span> -- 引入Redis
        local redisObj = <span class="token property">redis</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  --创建Redis对象
        <span class="token property">redisObj</span><span class="token punctuation">:</span>set_<span class="token function">timeout</span><span class="token punctuation">(</span>1000<span class="token punctuation">)</span> --设置超时数据为1s
        local ok<span class="token punctuation">,</span>err = <span class="token property">redisObj</span><span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.200.1&quot;</span><span class="token punctuation">,</span>6379<span class="token punctuation">)</span> --设置redis连接信息
        if <span class="token operator">not</span> ok then --判断是否连接成功
         ngx.<span class="token function">say</span><span class="token punctuation">(</span><span class="token string">&quot;failed to connection redis&quot;</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
         return
        end
        ok<span class="token punctuation">,</span>err = <span class="token property">redisObj</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TOM&quot;</span><span class="token punctuation">)</span>--存入数据
        if <span class="token operator">not</span> ok then --判断是否存入成功
         ngx.<span class="token function">say</span><span class="token punctuation">(</span><span class="token string">&quot;failed to set username&quot;</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
         return
        end
        local res<span class="token punctuation">,</span>err = <span class="token property">redisObj</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> --从redis中获取数据
        ngx.<span class="token function">say</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>	--将数据写会消息体中
        <span class="token property">redisObj</span><span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ngx-lua操作mysql"><a href="#ngx-lua操作mysql" class="header-anchor">#</a> ngx_lua操作mysql</h2> <blockquote><p>注意：注释是--，不是#</p></blockquote> <p>连接不到本地数据库原因</p> <ul><li><p>IP问题：关闭防火墙，或者给对应IP防火墙放行add-port</p></li> <li><p>数据库问题：mysql没有对你登录的用户开启远程登录的权限。</p> <div class="language-mysql extra-class"><pre class="language-text"><code>mysql -u root -p 密码
use mysql
update user set host = '%' where user='root'
</code></pre></div></li></ul> <div class="language-scss extra-class"><pre class="language-scss"><code>	<span class="token selector">init_by_lua_block</span><span class="token punctuation">{</span>
	    redis = require <span class="token string">&quot;resty.redis&quot;</span>
	    mysql = require <span class="token string">&quot;resty.mysql&quot;</span>
	    cjson = require <span class="token string">&quot;cjson&quot;</span>
	<span class="token punctuation">}</span>
    <span class="token selector">server </span><span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        #charset koi8-r<span class="token punctuation">;</span>
        #access_log  logs/host.access.log  main<span class="token punctuation">;</span>
        
	<span class="token selector">location /</span><span class="token punctuation">{</span>
	default_type <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">;</span>
    	<span class="token selector">content_by_lua_block</span><span class="token punctuation">{</span>
        --创建数据库对象
        local db = <span class="token property">mysql</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token selector">local ok,err = db:connect</span><span class="token punctuation">{</span>
        host=<span class="token string">&quot;192.168.111.1&quot;</span><span class="token punctuation">,</span>
        port=3306<span class="token punctuation">,</span>
        user=<span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
        password=<span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
        database=<span class="token string">&quot;nginx_db&quot;</span><span class="token punctuation">,</span>
        max_packet_size=1024<span class="token punctuation">,</span>
        compact_arrays=<span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        --输出错误信息
	    ngx.<span class="token function">say</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token property">db</span><span class="token punctuation">:</span>set_<span class="token function">timeout</span><span class="token punctuation">(</span>1000<span class="token punctuation">)</span>
        --删除
        local res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate = <span class="token property">db</span><span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;delete from users where id=3&quot;</span><span class="token punctuation">)</span>
        --local sql=<span class="token string">&quot;update users set username='lisi' where id = 3&quot;</span><span class="token punctuation">;</span>
		--local res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate=<span class="token property">db</span><span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        --数据转换为json格式
		ngx.<span class="token function">say</span><span class="token punctuation">(</span>cjson.<span class="token function">encode</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token property">db</span><span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/learn-vuepress/frame/MySQL.html" class="prev">
            数据库
          </a></span> <span class="next"><a href="/learn-vuepress/frame/Redis.html">
            Redis
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#背景介绍" class="sidebar-link reco-side-背景介绍" data-v-cb1513f6>背景介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#名词解释" class="sidebar-link reco-side-名词解释" data-v-cb1513f6>名词解释</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#常见服务器对比" class="sidebar-link reco-side-常见服务器对比" data-v-cb1513f6>常见服务器对比</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#iis" class="sidebar-link reco-side-iis" data-v-cb1513f6>IIS</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#tomcat" class="sidebar-link reco-side-tomcat" data-v-cb1513f6>tomcat</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#apache" class="sidebar-link reco-side-apache" data-v-cb1513f6>apache</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#lighttpd" class="sidebar-link reco-side-lighttpd" data-v-cb1513f6>lighttpd</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#其它的服务器" class="sidebar-link reco-side-其它的服务器" data-v-cb1513f6>其它的服务器</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的优点" class="sidebar-link reco-side-nginx的优点" data-v-cb1513f6>nginx的优点</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的功能特性及常用功能" class="sidebar-link reco-side-nginx的功能特性及常用功能" data-v-cb1513f6>nginx的功能特性及常用功能</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#基本http服务" class="sidebar-link reco-side-基本http服务" data-v-cb1513f6>基本HTTP服务</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#高级http服务" class="sidebar-link reco-side-高级http服务" data-v-cb1513f6>高级HTTP服务</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#邮件服务" class="sidebar-link reco-side-邮件服务" data-v-cb1513f6>邮件服务</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx常用的功能模块" class="sidebar-link reco-side-nginx常用的功能模块" data-v-cb1513f6>nginx常用的功能模块</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx版本介绍" class="sidebar-link reco-side-nginx版本介绍" data-v-cb1513f6>nginx版本介绍</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#获取nginx源码" class="sidebar-link reco-side-获取nginx源码" data-v-cb1513f6>获取nginx源码</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#准备服务器系统" class="sidebar-link reco-side-准备服务器系统" data-v-cb1513f6>准备服务器系统</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx安装方式介绍" class="sidebar-link reco-side-nginx安装方式介绍" data-v-cb1513f6>nginx安装方式介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#源码安装条件" class="sidebar-link reco-side-源码安装条件" data-v-cb1513f6>源码安装条件</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方案一-源码简单安装" class="sidebar-link reco-side-方案一-源码简单安装" data-v-cb1513f6>方案一：源码简单安装</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方案二-yum安装" class="sidebar-link reco-side-方案二-yum安装" data-v-cb1513f6>方案二：yum安装</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#源码简单安装和yum安装的差异" class="sidebar-link reco-side-源码简单安装和yum安装的差异" data-v-cb1513f6>源码简单安装和yum安装的差异</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方案三-nginx的源码复杂安装" class="sidebar-link reco-side-方案三-nginx的源码复杂安装" data-v-cb1513f6>方案三：Nginx的源码复杂安装</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#卸载nginx" class="sidebar-link reco-side-卸载nginx" data-v-cb1513f6>卸载nginx</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx目录结构分析" class="sidebar-link reco-side-nginx目录结构分析" data-v-cb1513f6>nginx目录结构分析</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx服务器启停命令" class="sidebar-link reco-side-nginx服务器启停命令" data-v-cb1513f6>nginx服务器启停命令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式一-nginx服务的信号控制" class="sidebar-link reco-side-方式一-nginx服务的信号控制" data-v-cb1513f6>方式一：Nginx服务的信号控制</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式二-nginx的命令行控制" class="sidebar-link reco-side-方式二-nginx的命令行控制" data-v-cb1513f6>方式二：Nginx的命令行控制</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx服务器版本升级和新增模块" class="sidebar-link reco-side-nginx服务器版本升级和新增模块" data-v-cb1513f6>nginx服务器版本升级和新增模块</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#环境准备" class="sidebar-link reco-side-环境准备" data-v-cb1513f6>环境准备</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方案一-使用nginx服务信号进行升级" class="sidebar-link reco-side-方案一-使用nginx服务信号进行升级" data-v-cb1513f6>方案一：使用nginx服务信号进行升级</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方案二-使用nginx安装目录的make命令完成升级" class="sidebar-link reco-side-方案二-使用nginx安装目录的make命令完成升级" data-v-cb1513f6>方案二：使用nginx安装目录的make命令完成升级</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#全局块" class="sidebar-link reco-side-全局块" data-v-cb1513f6>全局块</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#user指令" class="sidebar-link reco-side-user指令" data-v-cb1513f6>user指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#work-process-指令" class="sidebar-link reco-side-work-process-指令" data-v-cb1513f6>work process 指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#其它指令" class="sidebar-link reco-side-其它指令" data-v-cb1513f6>其它指令</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#events块" class="sidebar-link reco-side-events块" data-v-cb1513f6>events块</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#events指令配置实例" class="sidebar-link reco-side-events指令配置实例" data-v-cb1513f6>events指令配置实例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#http块" class="sidebar-link reco-side-http块" data-v-cb1513f6>http块</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#定义mime-type" class="sidebar-link reco-side-定义mime-type" data-v-cb1513f6>定义MIME-Type</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#自定义服务日志" class="sidebar-link reco-side-自定义服务日志" data-v-cb1513f6>自定义服务日志</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#其它配置指令" class="sidebar-link reco-side-其它配置指令" data-v-cb1513f6>其它配置指令</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#server和location块" class="sidebar-link reco-side-server和location块" data-v-cb1513f6>server和location块</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx服务器基础配置实例" class="sidebar-link reco-side-nginx服务器基础配置实例" data-v-cb1513f6>nginx服务器基础配置实例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx服务操作的问题" class="sidebar-link reco-side-nginx服务操作的问题" data-v-cb1513f6>nginx服务操作的问题</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx配置成系统服务" class="sidebar-link reco-side-nginx配置成系统服务" data-v-cb1513f6>nginx配置成系统服务</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx命令配置到系统环境" class="sidebar-link reco-side-nginx命令配置到系统环境" data-v-cb1513f6>nginx命令配置到系统环境</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx静态资源部署" class="sidebar-link reco-side-nginx静态资源部署" data-v-cb1513f6>nginx静态资源部署</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx静态资源概述" class="sidebar-link reco-side-nginx静态资源概述" data-v-cb1513f6>nginx静态资源概述</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx静态资源的配置指令" class="sidebar-link reco-side-nginx静态资源的配置指令" data-v-cb1513f6>nginx静态资源的配置指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#静态资源优化配置语法" class="sidebar-link reco-side-静态资源优化配置语法" data-v-cb1513f6>静态资源优化配置语法</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx静态资源压缩实战" class="sidebar-link reco-side-nginx静态资源压缩实战" data-v-cb1513f6>nginx静态资源压缩实战</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#静态资源的缓存处理" class="sidebar-link reco-side-静态资源的缓存处理" data-v-cb1513f6>静态资源的缓存处理</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#什么是缓存" class="sidebar-link reco-side-什么是缓存" data-v-cb1513f6>什么是缓存</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#什么是web缓存" class="sidebar-link reco-side-什么是web缓存" data-v-cb1513f6>什么是web缓存</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#web缓存的种类" class="sidebar-link reco-side-web缓存的种类" data-v-cb1513f6>web缓存的种类</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#为什么要用浏览器缓存" class="sidebar-link reco-side-为什么要用浏览器缓存" data-v-cb1513f6>为什么要用浏览器缓存</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#浏览器缓存的执行流程" class="sidebar-link reco-side-浏览器缓存的执行流程" data-v-cb1513f6>浏览器缓存的执行流程</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#浏览器缓存相关指令" class="sidebar-link reco-side-浏览器缓存相关指令" data-v-cb1513f6>浏览器缓存相关指令</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的跨域问题解决" class="sidebar-link reco-side-nginx的跨域问题解决" data-v-cb1513f6>Nginx的跨域问题解决</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#同源策略" class="sidebar-link reco-side-同源策略" data-v-cb1513f6>同源策略</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#跨域问题" class="sidebar-link reco-side-跨域问题" data-v-cb1513f6>跨域问题</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#跨域问题的案例演示" class="sidebar-link reco-side-跨域问题的案例演示" data-v-cb1513f6>跨域问题的案例演示</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#解决方案" class="sidebar-link reco-side-解决方案" data-v-cb1513f6>解决方案</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#静态资源防盗链" class="sidebar-link reco-side-静态资源防盗链" data-v-cb1513f6>静态资源防盗链</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#什么是资源盗链" class="sidebar-link reco-side-什么是资源盗链" data-v-cb1513f6>什么是资源盗链</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx防盗链的实现原理" class="sidebar-link reco-side-nginx防盗链的实现原理" data-v-cb1513f6>Nginx防盗链的实现原理</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#针对目录进行防盗链" class="sidebar-link reco-side-针对目录进行防盗链" data-v-cb1513f6>针对目录进行防盗链</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite功能配置" class="sidebar-link reco-side-rewrite功能配置" data-v-cb1513f6>Rewrite功能配置</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#地址重写-与-地址转发" class="sidebar-link reco-side-地址重写-与-地址转发" data-v-cb1513f6>“地址重写”与“地址转发”</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite规则" class="sidebar-link reco-side-rewrite规则" data-v-cb1513f6>Rewrite规则</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#set指令" class="sidebar-link reco-side-set指令" data-v-cb1513f6>set指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite常用全局变量" class="sidebar-link reco-side-rewrite常用全局变量" data-v-cb1513f6>Rewrite常用全局变量</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#if指令" class="sidebar-link reco-side-if指令" data-v-cb1513f6>if指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#break指令" class="sidebar-link reco-side-break指令" data-v-cb1513f6>break指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#return指令" class="sidebar-link reco-side-return指令" data-v-cb1513f6>return指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite指令" class="sidebar-link reco-side-rewrite指令" data-v-cb1513f6>rewrite指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite-log指令" class="sidebar-link reco-side-rewrite-log指令" data-v-cb1513f6>rewrite_log指令</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#rewrite的案例" class="sidebar-link reco-side-rewrite的案例" data-v-cb1513f6>Rewrite的案例</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#域名跳转和域名镜像" class="sidebar-link reco-side-域名跳转和域名镜像" data-v-cb1513f6>域名跳转和域名镜像</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#独立域名" class="sidebar-link reco-side-独立域名" data-v-cb1513f6>独立域名</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#目录自动添加" class="sidebar-link reco-side-目录自动添加" data-v-cb1513f6>目录自动添加”/“</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#合并目录" class="sidebar-link reco-side-合并目录" data-v-cb1513f6>合并目录</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#防盗链" class="sidebar-link reco-side-防盗链" data-v-cb1513f6>防盗链</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx反向代理概述" class="sidebar-link reco-side-nginx反向代理概述" data-v-cb1513f6>nginx反向代理概述</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx反向代理的配置语法" class="sidebar-link reco-side-nginx反向代理的配置语法" data-v-cb1513f6>nginx反向代理的配置语法</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-pass" class="sidebar-link reco-side-proxy-pass" data-v-cb1513f6>proxy_pass</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-set-header" class="sidebar-link reco-side-proxy-set-header" data-v-cb1513f6>proxysetheader</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-redirect" class="sidebar-link reco-side-proxy-redirect" data-v-cb1513f6>proxy_redirect</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx反向代理实战" class="sidebar-link reco-side-nginx反向代理实战" data-v-cb1513f6>Nginx反向代理实战</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的安全控制" class="sidebar-link reco-side-nginx的安全控制" data-v-cb1513f6>Nginx的安全控制</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#如何使用ssl对流量进行加密" class="sidebar-link reco-side-如何使用ssl对流量进行加密" data-v-cb1513f6>如何使用SSL对流量进行加密</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#反向代理系统调优" class="sidebar-link reco-side-反向代理系统调优" data-v-cb1513f6>反向代理系统调优</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡概述" class="sidebar-link reco-side-负载均衡概述" data-v-cb1513f6>负载均衡概述</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡的原理及处理流程" class="sidebar-link reco-side-负载均衡的原理及处理流程" data-v-cb1513f6>负载均衡的原理及处理流程</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡的作用" class="sidebar-link reco-side-负载均衡的作用" data-v-cb1513f6>负载均衡的作用</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡常用的处理方式" class="sidebar-link reco-side-负载均衡常用的处理方式" data-v-cb1513f6>负载均衡常用的处理方式</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式一-用户手动选择" class="sidebar-link reco-side-方式一-用户手动选择" data-v-cb1513f6>方式一：用户手动选择</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式二-dns轮询方式" class="sidebar-link reco-side-方式二-dns轮询方式" data-v-cb1513f6>方式二：DNS轮询方式</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式三-四-七层负载均衡" class="sidebar-link reco-side-方式三-四-七层负载均衡" data-v-cb1513f6>方式三：四/七层负载均衡</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx七层负载均衡" class="sidebar-link reco-side-nginx七层负载均衡" data-v-cb1513f6>nginx七层负载均衡</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx七层负载均衡的指令" class="sidebar-link reco-side-nginx七层负载均衡的指令" data-v-cb1513f6>nginx七层负载均衡的指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx七层负载均衡的实现流程" class="sidebar-link reco-side-nginx七层负载均衡的实现流程" data-v-cb1513f6>nginx七层负载均衡的实现流程</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡状态" class="sidebar-link reco-side-负载均衡状态" data-v-cb1513f6>负载均衡状态</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡策略" class="sidebar-link reco-side-负载均衡策略" data-v-cb1513f6>负载均衡策略</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#负载均衡案例" class="sidebar-link reco-side-负载均衡案例" data-v-cb1513f6>负载均衡案例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx四层负载均衡" class="sidebar-link reco-side-nginx四层负载均衡" data-v-cb1513f6>nginx四层负载均衡</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#添加stream模块的支持" class="sidebar-link reco-side-添加stream模块的支持" data-v-cb1513f6>添加stream模块的支持</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx四层负载均衡的指令" class="sidebar-link reco-side-nginx四层负载均衡的指令" data-v-cb1513f6>nginx四层负载均衡的指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#四层负载均衡的案例" class="sidebar-link reco-side-四层负载均衡的案例" data-v-cb1513f6>四层负载均衡的案例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#缓存的概念" class="sidebar-link reco-side-缓存的概念" data-v-cb1513f6>缓存的概念</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的web缓存服务" class="sidebar-link reco-side-nginx的web缓存服务" data-v-cb1513f6>nginx的web缓存服务</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx缓存设置的相关指令" class="sidebar-link reco-side-nginx缓存设置的相关指令" data-v-cb1513f6>nginx缓存设置的相关指令</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache-path" class="sidebar-link reco-side-proxy-cache-path" data-v-cb1513f6>proxycachepath</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache" class="sidebar-link reco-side-proxy-cache" data-v-cb1513f6>proxy_cache</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache-key" class="sidebar-link reco-side-proxy-cache-key" data-v-cb1513f6>proxycachekey</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache-valid" class="sidebar-link reco-side-proxy-cache-valid" data-v-cb1513f6>proxycachevalid</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache-min-uses" class="sidebar-link reco-side-proxy-cache-min-uses" data-v-cb1513f6>proxycachemin_uses</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#proxy-cache-methods" class="sidebar-link reco-side-proxy-cache-methods" data-v-cb1513f6>proxycachemethods</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx缓存设置案例" class="sidebar-link reco-side-nginx缓存设置案例" data-v-cb1513f6>nginx缓存设置案例</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#需求分析-2" class="sidebar-link reco-side-需求分析-2" data-v-cb1513f6>需求分析</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#步骤实现" class="sidebar-link reco-side-步骤实现" data-v-cb1513f6>步骤实现</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx缓存清除" class="sidebar-link reco-side-nginx缓存清除" data-v-cb1513f6>nginx缓存清除</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式一-删除缓存目录" class="sidebar-link reco-side-方式一-删除缓存目录" data-v-cb1513f6>方式一：删除缓存目录</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#方式二-第三方扩展模块" class="sidebar-link reco-side-方式二-第三方扩展模块" data-v-cb1513f6>方式二：第三方扩展模块</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx设置资源不缓存" class="sidebar-link reco-side-nginx设置资源不缓存" data-v-cb1513f6>nginx设置资源不缓存</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#cookie-nocache、-arg-nocache、-arg-comment" class="sidebar-link reco-side-cookie-nocache、-arg-nocache、-arg-comment" data-v-cb1513f6>$cookienocache、$argnocache、$arg_comment</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#案例" class="sidebar-link reco-side-案例" data-v-cb1513f6>案例</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx与tomcat部署" class="sidebar-link reco-side-nginx与tomcat部署" data-v-cb1513f6>nginx与tomcat部署</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#环境准备tomcat" class="sidebar-link reco-side-环境准备tomcat" data-v-cb1513f6>环境准备tomcat</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#环境准备nginx" class="sidebar-link reco-side-环境准备nginx" data-v-cb1513f6>环境准备nginx</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx实现动静分离" class="sidebar-link reco-side-nginx实现动静分离" data-v-cb1513f6>nginx实现动静分离</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#需求分析-3" class="sidebar-link reco-side-需求分析-3" data-v-cb1513f6>需求分析</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#动静分离实现步骤" class="sidebar-link reco-side-动静分离实现步骤" data-v-cb1513f6>动静分离实现步骤</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx实现tomcat集群搭建" class="sidebar-link reco-side-nginx实现tomcat集群搭建" data-v-cb1513f6>nginx实现tomcat集群搭建</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx高可用解决方案" class="sidebar-link reco-side-nginx高可用解决方案" data-v-cb1513f6>nginx高可用解决方案</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#keepalived" class="sidebar-link reco-side-keepalived" data-v-cb1513f6>keepalived</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#vrrp介绍" class="sidebar-link reco-side-vrrp介绍" data-v-cb1513f6>VRRP介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#环境搭建" class="sidebar-link reco-side-环境搭建" data-v-cb1513f6>环境搭建</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#keepalived配置文件介绍" class="sidebar-link reco-side-keepalived配置文件介绍" data-v-cb1513f6>keepalived配置文件介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#访问测试" class="sidebar-link reco-side-访问测试" data-v-cb1513f6>访问测试</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#keepalived之vrrp-script" class="sidebar-link reco-side-keepalived之vrrp-script" data-v-cb1513f6>keepalived之vrrp_script</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx制作下载站点" class="sidebar-link reco-side-nginx制作下载站点" data-v-cb1513f6>nginx制作下载站点</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#nginx的用户认证模块" class="sidebar-link reco-side-nginx的用户认证模块" data-v-cb1513f6>nginx的用户认证模块</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#lua" class="sidebar-link reco-side-lua" data-v-cb1513f6>Lua</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#概念" class="sidebar-link reco-side-概念" data-v-cb1513f6>概念</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#特性" class="sidebar-link reco-side-特性" data-v-cb1513f6>特性</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#应用场景" class="sidebar-link reco-side-应用场景" data-v-cb1513f6>应用场景</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#lua的安装" class="sidebar-link reco-side-lua的安装" data-v-cb1513f6>Lua的安装</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#第一个lua程序" class="sidebar-link reco-side-第一个lua程序" data-v-cb1513f6>第一个Lua程序</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#注释" class="sidebar-link reco-side-注释" data-v-cb1513f6>注释</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#语法" class="sidebar-link reco-side-语法" data-v-cb1513f6>语法</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#ngx-lua模块" class="sidebar-link reco-side-ngx-lua模块" data-v-cb1513f6>ngx_lua模块</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#openresty" class="sidebar-link reco-side-openresty" data-v-cb1513f6>OpenResty</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#安装" class="sidebar-link reco-side-安装" data-v-cb1513f6>安装</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#ngx-lua的使用" class="sidebar-link reco-side-ngx-lua的使用" data-v-cb1513f6>ngx_lua的使用</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#需求" class="sidebar-link reco-side-需求" data-v-cb1513f6>需求</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#ngx-lua操作redis" class="sidebar-link reco-side-ngx-lua操作redis" data-v-cb1513f6>ngx_lua操作redis</a></li><li class="level-2" data-v-cb1513f6><a href="/learn-vuepress/frame/nginx.html#ngx-lua操作mysql" class="sidebar-link reco-side-ngx-lua操作mysql" data-v-cb1513f6>ngx_lua操作mysql</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/learn-vuepress/assets/js/app.057a2b8d.js" defer></script><script src="/learn-vuepress/assets/js/7.4fee6b00.js" defer></script><script src="/learn-vuepress/assets/js/1.a3f35cab.js" defer></script><script src="/learn-vuepress/assets/js/12.2bac5d18.js" defer></script>
  </body>
</html>
